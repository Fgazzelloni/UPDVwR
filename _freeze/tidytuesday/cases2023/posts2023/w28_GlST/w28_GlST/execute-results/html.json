{
  "hash": "09f3347c803466ca722e40b4d22cd487",
  "result": {
    "markdown": "---\ntitle: \"GIST\"\nauthor: \"Federica Gazzelloni\"\nexecute:  \n  comments: \"\"\n  eval: true\n  echo: true\n  warning: false\n  message: false\n---\n\n\n> To cite Federica's work, please use: Gazzelloni F., 2023 Data Visualization GIST\n\nSource of original design: <https://earthobservatory.nasa.gov/world-of-change/global-temperatures#:~:text=According%20to%20an%20ongoing%20temperature,1.9%C2%B0%20Fahrenheit)%20since%201880.>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ntuesdata <- tidytuesdayR::tt_load(2023, week = 28)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tDownloading file 1 of 4: `global_temps.csv`\n\tDownloading file 2 of 4: `nh_temps.csv`\n\tDownloading file 3 of 4: `sh_temps.csv`\n\tDownloading file 4 of 4: `zonann_temps.csv`\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata$global_temps%>%head\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 19\n   Year   Jan   Feb   Mar   Apr   May   Jun   Jul   Aug   Sep   Oct   Nov   Dec\n  <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n1  1880 -0.19 -0.25 -0.09 -0.17 -0.1  -0.21 -0.18 -0.11 -0.15 -0.24 -0.22 -0.18\n2  1881 -0.2  -0.15  0.03  0.05  0.05 -0.19  0    -0.04 -0.16 -0.22 -0.19 -0.08\n3  1882  0.16  0.13  0.04 -0.16 -0.14 -0.22 -0.17 -0.08 -0.15 -0.24 -0.17 -0.36\n4  1883 -0.3  -0.37 -0.13 -0.19 -0.18 -0.08 -0.08 -0.14 -0.23 -0.12 -0.24 -0.11\n5  1884 -0.13 -0.09 -0.37 -0.4  -0.34 -0.35 -0.31 -0.28 -0.28 -0.25 -0.34 -0.31\n6  1885 -0.59 -0.34 -0.27 -0.42 -0.45 -0.44 -0.34 -0.32 -0.29 -0.24 -0.24 -0.11\n# ℹ 6 more variables: `J-D` <dbl>, `D-N` <dbl>, DJF <dbl>, MAM <dbl>,\n#   JJA <dbl>, SON <dbl>\n```\n:::\n:::\n\n\n### Global Temperature Anomalies\n\nAnomalies are calculated with respect to the 1951-1980 climatology. \n\nGlobal Temperatures are in C° degrees, what we see here is the difference in temperature as a result of an application of a model to estimate the mean difference in temperatures with respect to 1951-1980 time-frame. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_temps <- tuesdata$global_temps\nglobal_temps%>%select(1:13)%>%summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      Year           Jan                Feb               Mar          \n Min.   :1880   Min.   :-0.81000   Min.   :-0.6300   Min.   :-0.63000  \n 1st Qu.:1916   1st Qu.:-0.24000   1st Qu.:-0.2400   1st Qu.:-0.22250  \n Median :1952   Median :-0.01500   Median :-0.0400   Median : 0.01500  \n Mean   :1952   Mean   : 0.06333   Mean   : 0.0709   Mean   : 0.08889  \n 3rd Qu.:1987   3rd Qu.: 0.31000   3rd Qu.: 0.3825   3rd Qu.: 0.32250  \n Max.   :2023   Max.   : 1.18000   Max.   : 1.3700   Max.   : 1.36000  \n                                                                       \n      Apr                May                Jun                Jul          \n Min.   :-0.58000   Min.   :-0.55000   Min.   :-0.52000   Min.   :-0.51000  \n 1st Qu.:-0.25000   1st Qu.:-0.24000   1st Qu.:-0.25000   1st Qu.:-0.19000  \n Median :-0.02500   Median :-0.04000   Median :-0.05000   Median :-0.03000  \n Mean   : 0.06368   Mean   : 0.05292   Mean   : 0.03315   Mean   : 0.05587  \n 3rd Qu.: 0.28250   3rd Qu.: 0.27250   3rd Qu.: 0.24000   3rd Qu.: 0.23500  \n Max.   : 1.13000   Max.   : 1.02000   Max.   : 0.93000   Max.   : 0.94000  \n                                       NA's   :1          NA's   :1         \n      Aug                Sep                Oct               Nov          \n Min.   :-0.55000   Min.   :-0.58000   Min.   :-0.5800   Min.   :-0.55000  \n 1st Qu.:-0.22000   1st Qu.:-0.19000   1st Qu.:-0.2000   1st Qu.:-0.17500  \n Median :-0.05000   Median :-0.06000   Median : 0.0100   Median : 0.02000  \n Mean   : 0.05441   Mean   : 0.05818   Mean   : 0.0842   Mean   : 0.07776  \n 3rd Qu.: 0.23500   3rd Qu.: 0.24000   3rd Qu.: 0.2450   3rd Qu.: 0.23000  \n Max.   : 1.02000   Max.   : 0.99000   Max.   : 1.0900   Max.   : 1.11000  \n NA's   :1          NA's   :1          NA's   :1         NA's   :1         \n      Dec          \n Min.   :-0.82000  \n 1st Qu.:-0.22000  \n Median :-0.04000  \n Mean   : 0.05182  \n 3rd Qu.: 0.30500  \n Max.   : 1.16000  \n NA's   :1         \n```\n:::\n:::\n\n\n\n\n\n> Historical spatial variations in surface temperature anomalies are derived from historical weather station data and ocean data from ships, buoys, and other sensors. Uncertainties arise from measurement uncertainty, changes in spatial coverage of the station record, and systematic biases due to technology shifts and land cover changes.[^1]\n\n[^1]: Source: https://pubs.giss.nasa.gov/abs/le05800h.html\n\nThe differencing applied to the estimated mean values are used to calculate the yearly rate of change in percentage value.\n\n$$\\text{rate of change}=\\frac{y_2-y_1}{x_2-x_1}$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiff <- global_temps %>%\n  select(1:13) %>% # count(Year) 1880 - 2023\n  pivot_longer(cols = -Year)%>%\n  mutate(color=ifelse(value>0,\"up\",\"down\"))%>%\n  # grouping by Year, data are reframed to obtain a new vector\n  group_by(Year)%>%\n  # with the average values of the anomalies estimations\n  reframe(avg_val=mean(value))%>%\n  # the yearly rate of change in temperature anomalies\n  mutate(diff=c(0,diff(avg_val))*100)\n\ndiff%>%summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      Year         avg_val              diff         \n Min.   :1880   Min.   :-0.48333   Min.   :-25.4167  \n 1st Qu.:1916   1st Qu.:-0.19833   1st Qu.: -7.2917  \n Median :1952   Median :-0.05750   Median :  2.0000  \n Mean   :1952   Mean   : 0.06021   Mean   :  0.7494  \n 3rd Qu.:1987   3rd Qu.: 0.26583   3rd Qu.:  8.6667  \n Max.   :2023   Max.   : 1.02083   Max.   : 27.5000  \n                NA's   :1          NA's   :1         \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(diff$avg_val)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's \n-0.48333 -0.19833 -0.05750  0.06021  0.26583  1.02083        1 \n```\n:::\n:::\n\n\nHere we see the application:\n\n$$\\text{rate ratio}=\\frac{y_{t+1}}{y_{t}}$$\n\n::: {.cell}\n\n```{.r .cell-code}\nrates_df <- diff%>%\n  mutate(abs_lag=abs(lag(avg_val)),\n         rate_change=diff/abs_lag,\n         rr= avg_val/lag(avg_val))\n\nrates_df%>%head\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 6\n   Year avg_val   diff abs_lag rate_change     rr\n  <dbl>   <dbl>  <dbl>   <dbl>       <dbl>  <dbl>\n1  1880 -0.174    0    NA             NA   NA    \n2  1881 -0.0917   8.25  0.174         47.4  0.526\n3  1882 -0.113   -2.17  0.0917       -23.6  1.24 \n4  1883 -0.181   -6.75  0.113        -59.6  1.60 \n5  1884 -0.288  -10.7   0.181        -59.0  1.59 \n6  1885 -0.338   -5     0.288        -17.4  1.17 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrates_df%>%\n  ggplot(aes(x=Year,y=avg_val))+\n  geom_rect(xmin=1938,xmax=1980,ymin=-Inf,ymax=Inf,alpha=0.1,fill=\"grey\")+\n  geom_rect(xmin=1951,xmax=1980,ymin=-Inf,ymax=Inf,alpha=0.1,fill=\"grey60\")+\n  geom_line()+\n  geom_line(aes(y=rr/100),\n            color=\"darkred\",\n            inherit.aes = T)+\n  scale_x_continuous(n.breaks = 10)\n```\n\n::: {.cell-output-display}\n![](w28_GlST_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrates_df%>%\n  filter(Year>= 1980)%>%\n  select(rr)%>%\n  map_dbl(\\(rr) mean(rr,na.rm = T))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      rr \n1.093974 \n```\n:::\n:::\n\n\n\n\nConsidering all temperatures anomalies from 1978 to 2023, on average the steady increase is about 1.6% percent rate.\n\n::: {.cell}\n\n```{.r .cell-code}\ndiff%>%\n  drop_na()%>%\n  filter(Year> 1977)%>%\n  select(diff)%>%\n  map_dbl(\\(diff) mean(diff))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ndiff \n 1.6 \n```\n:::\n:::\n\n\n\n\nThe line plot shows yearly temperature anomalies from 1880 to 2023. \n\nEstimate of temperature change that could be compared with predictions of global climate change in response to atmospheric carbon dioxide, aerosols, and changes in solar activity. \n\nThese in situ measurements are analyzed using an **algorithm** that considers the *varied spacing of temperature stations* around the globe and urban heat island effects.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_temps %>%\n  select(1:13) %>% # count(Year) 1880 - 2023\n  pivot_longer(cols = -Year) %>%\n  mutate(color=ifelse(value>0,\"up\",\"down\")) %>%\n  # group_by(Year)%>%\n  # reframe(avg_val=mean(value))%>%\n  ggplot(aes(x=Year,y=value,group=name,color=name))+\n  geom_line(linewidth=0.3)+\n  geom_smooth(se=F,linewidth=0.1)+\n  scale_x_continuous(n.breaks = 10)+\n  scale_color_manual(values = RColorBrewer::brewer.pal(12,\"Paired\"))+\n  labs(color=\"Time(Month)\")+\n  ggthemes::theme_fivethirtyeight()\n```\n\n::: {.cell-output-display}\n![](w28_GlST_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndiff %>%\nggplot(aes(x=Year,y=diff))+\n  geom_line(color=\"darkred\",\n            linewidth=0.5)+\n  geom_hline(yintercept = 0)\n```\n\n::: {.cell-output-display}\n![](w28_GlST_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_temps2 <- global_temps %>%\n  select(1:13) %>% # count(Year) 1880 - 2023\n  pivot_longer(cols = -Year) %>%\n  mutate(color=ifelse(value>0,\"up\",\"down\")) \n\nglobal_temps2 %>% head\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n   Year name  value color\n  <dbl> <chr> <dbl> <chr>\n1  1880 Jan   -0.19 down \n2  1880 Feb   -0.25 down \n3  1880 Mar   -0.09 down \n4  1880 Apr   -0.17 down \n5  1880 May   -0.1  down \n6  1880 Jun   -0.21 down \n```\n:::\n:::\n\n\n\n\nAn approximate explanation:\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\ntrain_id <-  sample_frac(tibble(id=row_number(global_temps2)),0.8)\ntraining <- global_temps2[pull(train_id),]\ntesting <-  global_temps2%>%anti_join(training)\n\n\nfit<- lm(value ~ Year, data=training)\nsummary(fit, show.intercept= FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = value ~ Year, data = training)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.51002 -0.14967 -0.01338  0.14390  0.79641 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -1.544e+01  2.623e-01  -58.86   <2e-16 ***\nYear         7.942e-03  1.344e-04   59.09   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.2062 on 1374 degrees of freedom\n  (6 observations deleted due to missingness)\nMultiple R-squared:  0.7176,\tAdjusted R-squared:  0.7174 \nF-statistic:  3492 on 1 and 1374 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbroom::augment(fit)%>%head\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 9\n  .rownames value  Year .fitted  .resid     .hat .sigma    .cooksd .std.resid\n  <chr>     <dbl> <dbl>   <dbl>   <dbl>    <dbl>  <dbl>      <dbl>      <dbl>\n1 1          0.52  1988  0.351   0.169  0.00130   0.206 0.000438        0.819\n2 2         -0.21  1964  0.161  -0.371  0.000797  0.206 0.00129        -1.80 \n3 3         -0.07  1973  0.232  -0.302  0.000930  0.206 0.00100        -1.47 \n4 4          0.18  1963  0.153   0.0273 0.000787  0.206 0.00000693      0.133\n5 5          0.05  1931 -0.101   0.151  0.000899  0.206 0.000243        0.735\n6 6         -0.11  1955  0.0891 -0.199  0.000733  0.206 0.000342       -0.966\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbroom::augment(fit)%>%\n  left_join(global_temps2,by=c(\"Year\",\"value\"))%>%\n  ggplot(aes(x=Year,value,group=name))+\n  geom_line(color=\"steelblue\",linewidth=0.5)+\n  geom_line(aes(y=.fitted),inherit.aes = T)\n```\n\n::: {.cell-output-display}\n![](w28_GlST_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npredict(fit,newdata = tibble(Year=c(2024,2025,2026)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        1         2         3 \n0.6371218 0.6450638 0.6530059 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprediction<- tibble(Year=c(2024,2025,2026),\n                    pred=predict(fit,\n                                 newdata = tibble(Year=c(2024,2025,2026))))\n\nbroom::augment(fit)%>%\n  left_join(global_temps2,by=c(\"Year\",\"value\"))%>%\n  ggplot(aes(x=Year,value))+\n  geom_line(aes(group=name),color=\"steelblue\",linewidth=0.5)+\n  geom_line(aes(y=.fitted),inherit.aes = T)+\n  geom_line(data=prediction, mapping=aes(x=Year,y=pred),color=\"darkred\")\n```\n\n::: {.cell-output-display}\n![](w28_GlST_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntag<-tibble(tag_history= c(\"The basic GISS temperature analysis scheme was defined in the late 1970s by James Hansen when a method of estimating global temperature change was needed for comparison with one-dimensional global climate models.\"),\n            tag_stats = c(\"According to an ongoing temperature analysis led by scientists at NASA's Goddard Institute for Space Studies (GISS), the average global temperature on Earth has increased by at least 1.1° Celsius (1.9° Fahrenheit) since 1880.\"),\n            tag_reading =c(\"How to read this graph: The dashed-line depicts the average Global temperature with a one-year lag. The bars represent temperature anomalies estimated with respect to the 1951-1980 climatology.\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(grid)\n\nglobal_temps2 %>%\n  ggplot(aes(x=Year,y=value))+\n  geom_line(data=diff,\n            mapping=aes(x=Year,y=diff),\n            inherit.aes = F,\n            linetype=\"dashed\",\n            color=\"red\",\n            linewidth=0.05)+\n  geom_rect(xmin=1951,xmax=1980,\n                ymin=-4,ymax=4,\n            #fill=\"grey70\",\n            alpha=0.8)+\n  geom_col(aes(fill=color))+\n  ggthemes::theme_fivethirtyeight()\n```\n\n::: {.cell-output-display}\n![](w28_GlST_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_temps2 %>%\n  ggplot(aes(x=Year,y=value))+\n  geom_line(data=diff,\n            mapping=aes(x=Year,y=diff),\n            inherit.aes = F,\n            linetype=\"dashed\",\n            color=\"grey80\",\n            linewidth=0.1)+\n  geom_rect(xmin=1951,xmax=1980,\n                ymin=-4,ymax=4,\n            alpha=0.8)+\n  geom_col(aes(fill=color))+\n  geom_segment(aes(x=min(Year)-1,xend=min(Year)-1,\n                   y=0,yend=-10),\n               color=\"grey70\",\n               linewidth=1.5,\n               lineend=\"butt\",\n               arrow=arrow(length = unit(0.1, \"inches\")))+\n  geom_segment(aes(x=max(Year)+1,xend=max(Year)+1,\n                   y=0,yend=10),\n               color=\"grey70\",\n               linewidth=1.5,\n               lineend=\"butt\",\n               arrow=arrow(length = unit(0.1, \"inches\")))+\n  geom_segment(aes(x=1940,xend=1940,\n                 y=0,yend=10),\n               color=\"grey70\",\n               linewidth=0.5,\n               lineend=\"butt\",\n               arrow=arrow(length = unit(0.1, \"inches\")))+\n  geom_segment(aes(x=1957,xend=1957,\n               y=0,yend=10),\n             color=\"grey70\",\n             linewidth=0.5,\n             lineend=\"butt\",\n             arrow=arrow(length = unit(0.1, \"inches\")))+\n   geom_segment(aes(x=1979,xend=1979,\n              y=0,yend=-10),\n             color=\"grey70\",\n             linewidth=0.5,\n             lineend=\"butt\")+\n  ggtext::geom_textbox(data = tag,aes(x=1979,y=-15,label = tag_stats),\n                     size = 3, \n                     family=\"Roboto Condensed\",\n                     width = unit(20, \"line\"), \n                     alpha = 0.9,\n                     color=\"grey70\",\n                     fill=\"grey4\",\n                     box.colour = \"grey70\") +\n  ggtext::geom_textbox(data = tag,aes(x=1920,y=-25,label = tag_reading),\n                     size = 3, \n                     family=\"Roboto Condensed\",\n                     width = unit(20, \"line\"), \n                     alpha = 0.9,\n                     color=\"grey70\",\n                     fill=\"grey4\",\n                     box.colour = \"grey4\") +\n  geom_hline(yintercept = 0,linewidth=2,color=\"grey70\")+\n  geom_vline(xintercept = 1951,color=\"red\",alpha=0.2)+\n  geom_vline(xintercept = 1980,color=\"red\",alpha=0.2)+\n  scale_x_continuous(n.breaks = 10)+\n  scale_y_continuous()+\n  annotate(geom = \"text\",\n         family=\"Roboto Condensed\",\n         fontface=\"bold\",\n         label=\"Global Surface\\nTemperatures Anomalies\\n1880 - 2023\",\n         size=12,\n         color=\"grey70\",\n         hjust=0,\n         x = 1880 ,y =c(21) )+\n  annotate(geom = \"text\",\n         family=\"Roboto Condensed\",\n         fontface=\"bold\",\n         label=\"First rise\\nto previous year in 1940 \",\n         size=3,\n         color=\"grey70\",\n         hjust=0,\n         x = 1941 ,y =c(13) )+\n  annotate(geom = \"text\",\n        family=\"Roboto Condensed\",\n        fontface=\"bold\",\n        label=\"Second big rise\\nto previous year in 1957\",\n        size=3,\n        color=\"grey70\",\n        hjust=0,\n        x = 1959 ,y =c(7) )+\n  annotate(geom = \"text\",\n      family=\"Roboto Condensed\",\n      fontface=\"bold\",\n      label=\"Steady average rise of 1.09°C\\nsince 1979\",\n      size=3,\n      color=\"grey70\",\n      hjust=0,\n      x = 1980 ,y =c(-7) )+\n  annotation_custom(grob = grid::circleGrob(x=0,y=0.1,gp=gpar(col=\"grey70\",fill=NA)),\n                    xmin = 1940,\n                    xmax = 1950,\n                    ymin = 0,ymax = 10)+\n  ggthemes::scale_fill_fivethirtyeight()+\n  labs(title=\"\",\n       caption = \"\\nDataSource: NASA GISS Surface Temperature Analysis (GISTEMP v4)\\nDataViz: #TidyTuesday 2023 - week 28 by Federica Gazzelloni\\n\",\n       fill=\"Temperature\",\n       y=\"Monthly Means\")+\n  theme_void()+\n  theme(text=element_text(color=\"grey70\",family=\"Roboto Condensed\"),\n        plot.caption = element_text(hjust = 0.5,lineheight = 1),\n        axis.text.x = element_text(color=\"grey70\"),\n        plot.background = element_rect(color=\"grey4\",\n                                       fill=\"grey4\"),\n        legend.position = \"bottom\",\n        legend.title = element_text(color=\"black\"),\n        legend.text = element_text(color=\"black\"),\n        legend.background = element_rect(color=\"grey70\",fill=\"grey70\"))\n```\n\n::: {.cell-output-display}\n![](w28_GlST_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"w28_GIST.png\")\n```\n:::\n",
    "supporting": [
      "w28_GlST_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}