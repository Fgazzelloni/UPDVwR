{
  "hash": "3f06b324bfaee23931605de39e26aa09",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Global Surface Temperatures'\nsubtitle: 'Welcome to TidyTuesday 2023 week 28'\ndate: '2023-07-11'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/TidyTuesday/main/data/2023/w28_GlST/w28_GIST.png'\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n> To cite Federica's work, please use: Gazzelloni F., 2023 Data Visualization GIST\n\nSource of original design: <https://earthobservatory.nasa.gov/world-of-change/global-temperatures#:~:text=According%20to%20an%20ongoing%20temperature,1.9%C2%B0%20Fahrenheit)%20since%201880.>\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ntuesdata <- tidytuesdayR::tt_load(2023, week = 28)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata$global_temps%>%head\n```\n:::\n\n\n\n### Global Temperature Anomalies\n\nAnomalies are calculated with respect to the 1951-1980 climatology. \n\nGlobal Temperatures are in C째 degrees, what we see here is the difference in temperature as a result of an application of a model to estimate the mean difference in temperatures with respect to 1951-1980 time-frame. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_temps <- tuesdata$global_temps\nglobal_temps%>%select(1:13)%>%summary()\n```\n:::\n\n\n\n\n\n\n> Historical spatial variations in surface temperature anomalies are derived from historical weather station data and ocean data from ships, buoys, and other sensors. Uncertainties arise from measurement uncertainty, changes in spatial coverage of the station record, and systematic biases due to technology shifts and land cover changes.[^1]\n\n[^1]: Source: https://pubs.giss.nasa.gov/abs/le05800h.html\n\nThe differencing applied to the estimated mean values are used to calculate the yearly rate of change in percentage value.\n\n$$\\text{rate of change}=\\frac{y_2-y_1}{x_2-x_1}$$\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiff <- global_temps %>%\n  select(1:13) %>% # count(Year) 1880 - 2023\n  pivot_longer(cols = -Year)%>%\n  mutate(color=ifelse(value>0,\"up\",\"down\"))%>%\n  # grouping by Year, data are reframed to obtain a new vector\n  group_by(Year)%>%\n  # with the average values of the anomalies estimations\n  reframe(avg_val=mean(value))%>%\n  # the yearly rate of change in temperature anomalies\n  mutate(diff=c(0,diff(avg_val))*100)\n\ndiff%>%summary()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(diff$avg_val)\n```\n:::\n\n\n\nHere we see the application:\n\n$$\\text{rate ratio}=\\frac{y_{t+1}}{y_{t}}$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates_df <- diff%>%\n  mutate(abs_lag=abs(lag(avg_val)),\n         rate_change=diff/abs_lag,\n         rr= avg_val/lag(avg_val))\n\nrates_df%>%head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrates_df%>%\n  ggplot(aes(x=Year,y=avg_val))+\n  geom_rect(xmin=1938,xmax=1980,ymin=-Inf,ymax=Inf,alpha=0.1,fill=\"grey\")+\n  geom_rect(xmin=1951,xmax=1980,ymin=-Inf,ymax=Inf,alpha=0.1,fill=\"grey60\")+\n  geom_line()+\n  geom_line(aes(y=rr/100),\n            color=\"darkred\",\n            inherit.aes = T)+\n  scale_x_continuous(n.breaks = 10)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrates_df%>%\n  filter(Year>= 1980)%>%\n  select(rr)%>%\n  map_dbl(\\(rr) mean(rr,na.rm = T))\n```\n:::\n\n\n\n\n\nConsidering all temperatures anomalies from 1978 to 2023, on average the steady increase is about 1.6% percent rate.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiff%>%\n  drop_na()%>%\n  filter(Year> 1977)%>%\n  select(diff)%>%\n  map_dbl(\\(diff) mean(diff))\n```\n:::\n\n\n\n\n\nThe line plot shows yearly temperature anomalies from 1880 to 2023. \n\nEstimate of temperature change that could be compared with predictions of global climate change in response to atmospheric carbon dioxide, aerosols, and changes in solar activity. \n\nThese in situ measurements are analyzed using an **algorithm** that considers the *varied spacing of temperature stations* around the globe and urban heat island effects.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_temps %>%\n  select(1:13) %>% # count(Year) 1880 - 2023\n  pivot_longer(cols = -Year) %>%\n  mutate(color=ifelse(value>0,\"up\",\"down\")) %>%\n  # group_by(Year)%>%\n  # reframe(avg_val=mean(value))%>%\n  ggplot(aes(x=Year,y=value,group=name,color=name))+\n  geom_line(linewidth=0.3)+\n  geom_smooth(se=F,linewidth=0.1)+\n  scale_x_continuous(n.breaks = 10)+\n  scale_color_manual(values = RColorBrewer::brewer.pal(12,\"Paired\"))+\n  labs(color=\"Time(Month)\")+\n  ggthemes::theme_fivethirtyeight()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndiff %>%\nggplot(aes(x=Year,y=diff))+\n  geom_line(color=\"darkred\",\n            linewidth=0.5)+\n  geom_hline(yintercept = 0)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_temps2 <- global_temps %>%\n  select(1:13) %>% # count(Year) 1880 - 2023\n  pivot_longer(cols = -Year) %>%\n  mutate(color=ifelse(value>0,\"up\",\"down\")) \n\nglobal_temps2 %>% head\n```\n:::\n\n\n\n\n\nAn approximate explanation:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\ntrain_id <-  sample_frac(tibble(id=row_number(global_temps2)),0.8)\ntraining <- global_temps2[pull(train_id),]\ntesting <-  global_temps2%>%anti_join(training)\n\n\nfit<- lm(value ~ Year, data=training)\nsummary(fit, show.intercept= FALSE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbroom::augment(fit)%>%head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbroom::augment(fit)%>%\n  left_join(global_temps2,by=c(\"Year\",\"value\"))%>%\n  ggplot(aes(x=Year,value,group=name))+\n  geom_line(color=\"steelblue\",linewidth=0.5)+\n  geom_line(aes(y=.fitted),inherit.aes = T)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npredict(fit,newdata = tibble(Year=c(2024,2025,2026)))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprediction<- tibble(Year=c(2024,2025,2026),\n                    pred=predict(fit,\n                                 newdata = tibble(Year=c(2024,2025,2026))))\n\nbroom::augment(fit)%>%\n  left_join(global_temps2,by=c(\"Year\",\"value\"))%>%\n  ggplot(aes(x=Year,value))+\n  geom_line(aes(group=name),color=\"steelblue\",linewidth=0.5)+\n  geom_line(aes(y=.fitted),inherit.aes = T)+\n  geom_line(data=prediction, mapping=aes(x=Year,y=pred),color=\"darkred\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntag<-tibble(tag_history= c(\"The basic GISS temperature analysis scheme was defined in the late 1970s by James Hansen when a method of estimating global temperature change was needed for comparison with one-dimensional global climate models.\"),\n            tag_stats = c(\"According to an ongoing temperature analysis led by scientists at NASA's Goddard Institute for Space Studies (GISS), the average global temperature on Earth has increased by at least 1.1째 Celsius (1.9째 Fahrenheit) since 1880.\"),\n            tag_reading =c(\"How to read this graph: The dashed-line depicts the average Global temperature with a one-year lag. The bars represent temperature anomalies estimated with respect to the 1951-1980 climatology.\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(grid)\n\nglobal_temps2 %>%\n  ggplot(aes(x=Year,y=value))+\n  geom_line(data=diff,\n            mapping=aes(x=Year,y=diff),\n            inherit.aes = F,\n            linetype=\"dashed\",\n            color=\"red\",\n            linewidth=0.05)+\n  geom_rect(xmin=1951,xmax=1980,\n                ymin=-4,ymax=4,\n            #fill=\"grey70\",\n            alpha=0.8)+\n  geom_col(aes(fill=color))+\n  ggthemes::theme_fivethirtyeight()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_temps2 %>%\n  ggplot(aes(x=Year,y=value))+\n  geom_line(data=diff,\n            mapping=aes(x=Year,y=diff),\n            inherit.aes = F,\n            linetype=\"dashed\",\n            color=\"grey80\",\n            linewidth=0.1)+\n  geom_rect(xmin=1951,xmax=1980,\n                ymin=-4,ymax=4,\n            alpha=0.8)+\n  geom_col(aes(fill=color))+\n  geom_segment(aes(x=min(Year)-1,xend=min(Year)-1,\n                   y=0,yend=-10),\n               color=\"grey70\",\n               linewidth=1.5,\n               lineend=\"butt\",\n               arrow=arrow(length = unit(0.1, \"inches\")))+\n  geom_segment(aes(x=max(Year)+1,xend=max(Year)+1,\n                   y=0,yend=10),\n               color=\"grey70\",\n               linewidth=1.5,\n               lineend=\"butt\",\n               arrow=arrow(length = unit(0.1, \"inches\")))+\n  geom_segment(aes(x=1940,xend=1940,\n                 y=0,yend=10),\n               color=\"grey70\",\n               linewidth=0.5,\n               lineend=\"butt\",\n               arrow=arrow(length = unit(0.1, \"inches\")))+\n  geom_segment(aes(x=1957,xend=1957,\n               y=0,yend=10),\n             color=\"grey70\",\n             linewidth=0.5,\n             lineend=\"butt\",\n             arrow=arrow(length = unit(0.1, \"inches\")))+\n   geom_segment(aes(x=1979,xend=1979,\n              y=0,yend=-10),\n             color=\"grey70\",\n             linewidth=0.5,\n             lineend=\"butt\")+\n  ggtext::geom_textbox(data = tag,aes(x=1979,y=-15,label = tag_stats),\n                     size = 3, \n                     family=\"Roboto Condensed\",\n                     width = unit(20, \"line\"), \n                     alpha = 0.9,\n                     color=\"grey70\",\n                     fill=\"grey4\",\n                     box.colour = \"grey70\") +\n  ggtext::geom_textbox(data = tag,aes(x=1920,y=-25,label = tag_reading),\n                     size = 3, \n                     family=\"Roboto Condensed\",\n                     width = unit(20, \"line\"), \n                     alpha = 0.9,\n                     color=\"grey70\",\n                     fill=\"grey4\",\n                     box.colour = \"grey4\") +\n  geom_hline(yintercept = 0,linewidth=2,color=\"grey70\")+\n  geom_vline(xintercept = 1951,color=\"red\",alpha=0.2)+\n  geom_vline(xintercept = 1980,color=\"red\",alpha=0.2)+\n  scale_x_continuous(n.breaks = 10)+\n  scale_y_continuous()+\n  annotate(geom = \"text\",\n         family=\"Roboto Condensed\",\n         fontface=\"bold\",\n         label=\"Global Surface\\nTemperatures Anomalies\\n1880 - 2023\",\n         size=12,\n         color=\"grey70\",\n         hjust=0,\n         x = 1880 ,y =c(21) )+\n  annotate(geom = \"text\",\n         family=\"Roboto Condensed\",\n         fontface=\"bold\",\n         label=\"First rise\\nto previous year in 1940 \",\n         size=3,\n         color=\"grey70\",\n         hjust=0,\n         x = 1941 ,y =c(13) )+\n  annotate(geom = \"text\",\n        family=\"Roboto Condensed\",\n        fontface=\"bold\",\n        label=\"Second big rise\\nto previous year in 1957\",\n        size=3,\n        color=\"grey70\",\n        hjust=0,\n        x = 1959 ,y =c(7) )+\n  annotate(geom = \"text\",\n      family=\"Roboto Condensed\",\n      fontface=\"bold\",\n      label=\"Steady average rise of 1.09째C\\nsince 1979\",\n      size=3,\n      color=\"grey70\",\n      hjust=0,\n      x = 1980 ,y =c(-7) )+\n  annotation_custom(grob = grid::circleGrob(x=0,y=0.1,gp=gpar(col=\"grey70\",fill=NA)),\n                    xmin = 1940,\n                    xmax = 1950,\n                    ymin = 0,ymax = 10)+\n  ggthemes::scale_fill_fivethirtyeight()+\n  labs(title=\"\",\n       caption = \"\\nDataSource: NASA GISS Surface Temperature Analysis (GISTEMP v4)\\nDataViz: #TidyTuesday 2023 - week 28 by Federica Gazzelloni\\n\",\n       fill=\"Temperature\",\n       y=\"Monthly Means\")+\n  theme_void()+\n  theme(text=element_text(color=\"grey70\",family=\"Roboto Condensed\"),\n        plot.caption = element_text(hjust = 0.5,lineheight = 1),\n        axis.text.x = element_text(color=\"grey70\"),\n        plot.background = element_rect(color=\"grey4\",\n                                       fill=\"grey4\"),\n        legend.position = \"bottom\",\n        legend.title = element_text(color=\"black\"),\n        legend.text = element_text(color=\"black\"),\n        legend.background = element_rect(color=\"grey70\",fill=\"grey70\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"w28_GIST.png\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}