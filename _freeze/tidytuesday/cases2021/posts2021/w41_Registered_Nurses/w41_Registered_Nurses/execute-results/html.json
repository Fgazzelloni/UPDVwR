{
  "hash": "b6575f9be3c089cd27e956a7884c03cf",
  "result": {
    "markdown": "---\ntitle: 'Registered Nurses'\nsubtitle: 'Welcome to TidyTuesday 2021 week 41'\ndate: '2021-10-05'\nimage: 'w41_nurses.png'\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n# TidyTuesday week 41 Nurses\n\n::: {.cell}\n\n```{.r .cell-code}\n# load libraries\nlibrary(ggExtra)\nlibrary(xkcd)\nlibrary(ggstatsplot)\nlibrary(extrafont)\nlibrary(extrafont)\nfonts()\n\noptions(scipen = 999)\nlibrary(tidyverse)\n\n\nnurses <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-05/nurses.csv')\n\n\ndf <- nurses %>%\n  janitor::clean_names() %>%\n  filter(!is.na(employed_standard_error_percent),!is.na(wage_salary_standard_error_percent))\n\nmy_df <- df %>%\n  mutate(salary_level = case_when(annual_salary_median < 35000 ~ \"low\",\n                                 annual_salary_median >= 35000 & annual_salary_median < 55000 ~ \"medium\",\n                                 annual_salary_median >= 55000 & annual_salary_median <= 80000 ~ \"high\",\n                                 TRUE ~ \"top high\"),\n         .after = year) %>%\n  mutate(salary_level_class = case_when(annual_salary_median < 35000 ~ \"<35\",\n                                       annual_salary_median >= 35000 & annual_salary_median < 55000 ~ \"35 to 55\",\n                                       annual_salary_median >= 55000 & annual_salary_median <= 80000 ~ \"56 to 80\",\n                                       TRUE ~ \"<80\"),\n         .after = salary_level) %>%\n  mutate(salary_leg = paste(salary_level,\"-\",salary_level_class),\n         .after = salary_level,\n         salary_leg = as.factor(salary_leg))\n\nunique(my_df$salary_leg)\nlegend_ord <- levels(with(my_df, reorder(annual_salary_median,year)))\nmy_df$salary_level <- factor(my_df$salary_level, # Relevel group factor\n                             levels = c(\"low\",\"medium\",\"high\",\"top high\"))\n\n\ntheme_nurses <- xkcd::theme_xkcd() +\n  theme(text = element_text(color = \"grey80\",family = \"Comic Sans MS\"),\n        plot.title = element_text(hjust = 0.5,size = 24,face = \"bold\"),\n        plot.title.position = \"plot\",\n        plot.caption = element_text(family = \"Comic Sans MS\"),\n        plot.subtitle = element_text(hjust = 0.5),\n        plot.caption.position = \"plot\",\n        legend.background = element_blank(),\n        legend.box.background = element_blank(),\n        legend.key = element_blank(),\n        legend.title = element_text(size = 11,family = \"Comic Sans MS\",face = \"bold\"),\n        legend.text = element_text(size = 9,family = \"Comic Sans MS\"),\n        axis.ticks = element_line(size = 2,color = \"orange\"),\n        axis.line.x = element_line(color = \"grey80\"),\n        axis.title.x = element_text(size = 12,face = \"bold\"),\n        axis.title.y = element_text(size = 12,face = \"bold\"),\n        axis.text.y = element_text(color = \"grey80\"),\n        axis.text.x = element_text(color = \"grey80\"),\n        panel.grid.major.y = element_line(color = \"grey80\"),\n        panel.background = element_rect(color = \"grey40\",fill = \"grey40\"),\n        plot.background = element_rect(color = \"grey40\",fill = \"grey40\"))\n\n\nstair_sal <- my_df %>%\n  ggplot(aes(factor(year), y = annual_salary_median, group = salary_level, fill = salary_level)) +\n  geom_col(width = 1) +\n  labs(fill = \"Salary level\",\n       x = \"Years\",y = \"Cumulate annual median salaries by salary level\",\n       title = \"How much should salary increase per year?\",\n       subtitle = \"Nurses' annual median salary values by 4 levels\n        \") +\n  scale_x_discrete(breaks = seq(1998,2020,3)) +\n  scale_y_continuous(labels = scales::number_format(scale = 1/1000000,suffix = \"M\",accuracy = 1)) +\n  scale_fill_manual(limits = c(\"low\", \"medium\",\"high\",\"top high\"),\n                    labels = c(\"high\" = \"high from 56,000 to 80,000\",\n                             \"low\" = \"low less than 35,000\",\n                             \"medium\" = \"medium from 35,000 to 55,000\",\n                             \"top high\" = \"top high greater than 80,000\"),\n                    values = RColorBrewer::brewer.pal(4,\"Spectral\")) +\n  guides(fill = guide_legend(ncol = 4,title.position = \"left\")) +\n  theme_nurses +\n  theme(legend.position = c(0.5,0.99)) +\n  annotate(\"text\", x = 5, y = 1100000,label = \"Medium Salary from 35,000 to 60,000\",family = \"xkcd\" ) +\n  annotate(\"text\", x = 20, y = 300000,label = \"Top High up to 118,500\",family = \"xkcd\" ) +\n  annotate(\"text\", x = 20, y = 160000,label = \"started in 2008\",family = \"xkcd\" ) +\n  annotate(\"text\", x = 16, y = 2000000,label = \"High Salaries between 56,000 and 80,000\",family = \"xkcd\" ) +\n  annotate(\"curve\", x = 3, xend = 5, y = 3600000, yend = 2600000,color = \"grey85\", curvature = 0.5,\n           arrow = arrow(angle = 30, length = unit(0.2, \"inches\"),ends = \"last\", type = \"open\")) +\n  annotate(\"text\", x = 4, y = 3700000,label = \"Low salaries below 30,000\",family = \"xkcd\" ,color = \"red\") +\n  annotate(\"text\", x = 8, y = 3500000,label = \"stopped in 2011\\nto reach 35,000\",family = \"xkcd\",color = \"red\" ) +\n  annotate(\"curve\", x = 9, xend = 13, y = 3500000, yend = 3400000,color = \"grey85\", curvature = -0.5,\n         arrow = arrow(angle = 30, length = unit(0.2, \"inches\"),ends = \"last\", type = \"open\"))\n\n\n\nsalaries_by_year <- my_df %>%\n  group_by(year,salary_level) %>%\n  summarize(total = sum(annual_salary_median),.groups = \"drop\") %>%\n  pivot_wider(names_from = year,values_from = total,values_fill = 0)\n\nfacet_sal <- salaries_by_year %>%\n  pivot_longer(cols = \"1998\":\"2020\",names_to = \"years\",values_to = \"tot salary by level\") %>%\n  ggplot(aes(`tot salary by level`,salary_level,group = years)) +\n  geom_col(aes(fill = salary_level)) +\n  labs(x = \"Total amount of annual median salaries by level\",\n       y = \"Salary levels - $10thous.\",\n       fill = \"Salary level\",\n       caption = \"(values are in $,10thous.,M = millions of $)\\nDataSource: Registered Nurses,DataWorld,BLS\\nTidyTuesday Week41 DataViz: Federica Gazzelloni\") +\n  scale_x_continuous(labels = scales::number_format(scale = 1/100000,accuracy = 1)) +\n  scale_fill_manual(limits = c(\"low\", \"medium\",\"high\",\"top high\"),\n                    labels = c(\"high\" = \"high from 56,000 to 80,000\",\n                             \"low\" = \"low less than 35,000\",\n                             \"medium\" = \"medium from 35,000 to 55,000\",\n                             \"top high\" = \"top high greater than 80,000\"),\n                    values = RColorBrewer::brewer.pal(4,\"Spectral\")) +\n  guides(fill = guide_legend(ncol = 2,title.position = \"top\", title.hjust = 0.5)) +\n  facet_wrap(~years,scale = \"free_x\") +\n  theme_nurses +\n  theme(legend.position = c(0.80,0.07),\n        strip.background = element_rect(color = \"grey40\",fill = \"grey40\"),\n        strip.text = element_text(color = \"grey80\",face = \"bold\"))\n\n\nimg_nurse <- image_read(here::here(\"/Users/federica/Documents/R/R_general_resourses/TidyTuesday/TidyTuesday/w41/nurse.png\"))\nimg_dataworld <- image_read(here::here(\"/Users/federica/Documents/R/R_general_resourses/TidyTuesday/TidyTuesday/w41/dataworld.png\"))\nimg_bls <- image_read(here::here(\"/Users/federica/Documents/R/R_general_resourses/TidyTuesday/TidyTuesday/w41/bls.png\"))\ntidy_logo <- image_read(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/static/plot_logo.png\") %>%\n  image_resize(\"300x300\")\n\nlibrary(cowplot)\nfinal <- ggdraw() +\n  draw_plot(stair_sal/facet_sal) +\n  draw_image(img_nurse, x = 0.1, y = 0.45,width = 0.08) +\n  draw_image(img_dataworld, x = 0.13, y = -0.46,width = 0.05) +\n  draw_image(img_bls, x = 0.18, y = -0.46,width = 0.05) +\n  draw_image(tidy_logo, x = 0.04, y = -0.46,width = 0.09) \n\n\n# save final plot\nragg::agg_png(here::here(\"/Users/federica/Documents/R/R_general_resourses/TidyTuesday/TidyTuesday/w41/w41_nurses.png\"),\n              res = 320, width = 12, height = 14, units = \"in\")\n#stair_sal/facet_sal\nfinal\ndev.off()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}