{
  "hash": "b3ae91cec879668773ad9166b54ba475",
  "result": {
    "markdown": "---\ntitle: \"Bird Baths\"\nsubtitle: \"Welcome to TidyTuesday 2021 week 36\"\ndate: \"2021-08-31\"\nimage: \"w36_bird_baths.png\"\nimage-alt: \"\"\ndescription: \"Networks\"\noutput: html_document\nexecute: \n  eval: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggdendro)\nlibrary(dendextend)\nlibrary(ggraph)\nlibrary(tidygraph)\nlibrary(purrr)\nlibrary(rlang)\n\n\ntuesdata <- tidytuesdayR::tt_load(2021, week = 36)\nbird_baths <- tuesdata$bird_baths\n\nbird_baths <- bird_baths %>%\n  drop_na() %>%\n  filter(bird_count>0)  # %>% count(bird_type,sort=TRUE) %>% View()\n\nsurvey_year_id <- bird_baths %>% count(survey_year) %>%\n  mutate(survey_year_id = row_number()) %>% select(-n)\nurban_rural_id <- bird_baths %>% count(urban_rural) %>%\n  mutate(urb_rul_id = row_number()) %>% select(-n)\nbioregions_id <- bird_baths %>% count(bioregions) %>% \n  mutate(bioregions_id = row_number()) %>% select(-n)\nbird_type_id <- bird_baths %>% count(bird_type) %>% \n  mutate(bird_type_id = row_number()) %>% select(-n)\n\n\nbird_baths_numeric <- bird_baths %>%\n  inner_join(survey_year_id,\n             by=\"survey_year\") %>%\n  inner_join(urban_rural_id,\n             by=\"urban_rural\") %>%\n  inner_join(bioregions_id,\n             by=\"bioregions\") %>%\n  inner_join(bird_type_id,\n             by=\"bird_type\") %>%\n  count(survey_year_id,urb_rul_id,bioregions_id,bird_type_id) %>%\n  arrange(survey_year_id,urb_rul_id,bioregions_id,bird_type_id) \n\n\nbird_baths_half_numeric <- bird_baths %>%\n  inner_join(survey_year_id,\n             by=\"survey_year\") %>%\n  inner_join(urban_rural_id,\n             by=\"urban_rural\") %>%\n  inner_join(bioregions_id,\n             by=\"bioregions\") %>%\n  inner_join(bird_type_id,\n             by=\"bird_type\") %>%\n  count(survey_year,survey_year_id,\n        urban_rural,urb_rul_id,\n        bioregions,bioregions_id,\n        bird_type,bird_type_id) %>%\n  arrange(survey_year) \n\nbird_baths_numeric_short <- bird_baths %>%\n  inner_join(survey_year_id,\n             by=\"survey_year\") %>%\n  inner_join(urban_rural_id,\n             by=\"urban_rural\") %>%\n  inner_join(bioregions_id,\n             by=\"bioregions\") %>%\n  inner_join(bird_type_id,\n             by=\"bird_type\") %>%\n  count(survey_year_id,urb_rul_id,bioregions_id,bird_type_id) %>% #View()\n  filter(n<=20)\n\n\nbird_baths_half_numeric_short <- bird_baths %>%\n  inner_join(survey_year_id,\n             by=\"survey_year\") %>%\n  inner_join(urban_rural_id,\n             by=\"urban_rural\") %>%\n  inner_join(bioregions_id,\n             by=\"bioregions\") %>%\n  inner_join(bird_type_id,\n             by=\"bird_type\") %>%\n  count(survey_year,survey_year_id,\n        urban_rural,urb_rul_id,\n        bioregions,bioregions_id,\n        bird_type,bird_type_id) %>% #View()\n  filter(n<=20)\n\n\n\n#-------- data to use\n\n\nbb_piv_w <- bird_baths_half_numeric %>%\n  count(survey_year,bird_type,urban_rural,bioregions) %>%\n  pivot_wider(names_from=c(survey_year,urban_rural,bioregions),values_from=n,values_fill = 0)\n\n\n# https://cran.r-project.org/web/packages/dendextend/vignettes/Cluster_Analysis.html#the-3-clusters-from-the-complete-method-vs-the-real-species-category\nbirds <- column_to_rownames(bb_piv_w,var = \"bird_type\")\n\n\n\n# View(birds)\n\n# build a dendrogram\n\ndend_r <- birds %>%\n  dist(method = \"man\") %>%\n  hclust(method = \"ward.D2\") %>%\n  as.dendrogram %>%\n  ladderize %>%\n  color_branches(k=4)\n\ndend_c <- t(birds) %>%\n  dist(method = \"man\") %>%\n  hclust(method = \"com\") %>%\n  as.dendrogram %>%\n  ladderize%>%\n  color_branches(k=3)\n\n# set the colors\nsome_col_func <- function(n) (\n  colorspace::diverge_hcl(n, h = c(246, 40), c = 96, l = c(65, 90)))\n\n\n# plot the heatmap with the dendrograms\npar(mar = c(5,5,5,5))\n\nlibrary(gplots)\nset_graph_style(plot_margin = margin(1,1,1,1))\n\nplot <- gplots::heatmap.2(as.matrix(birds),\n                          main = \"Bird types concentration\",\n                          srtCol = 35,\n                          Rowv = dend_r,\n                          Colv = dend_c,\n                          trace=\"row\", hline = NA, tracecol = \"darkgrey\",\n                          margins =c(11,8),\n                          key.xlab = \"spotted/unspotted\",\n                          denscol = \"grey\",\n                          density.info = \"density\",\n                          col = some_col_func\n)\n\n## Save the plot as an image ----\n\nragg::agg_png(here::here(\"w36/heat_map.png\"),\n              res = 320, width = 15, height = 8, units = \"in\")\nfinal\n\ndev.off()\n\n#------------finish touches\n\nlibrary(ggimage)\nlibrary(magick)\nlibrary(cowplot)\n\nheat_map <- image_read(here::here(\"w36/heat_map.png\"))\n\nplot <- ggdraw() +\n  draw_image(heat_map)\n\nlibrary(ggpubr)\ngraphics <- ggarrange(plot)\n\nfinal_plot <- annotate_figure(graphics,\n                              top = text_grob(\"\",\n                                              color = c(\"#8a5d24\"), face = \"bold\", size = 24,\n                                              family = \"xkcd\"),\n                              bottom = text_grob(\"Infographics Federica Gazzelloni DataSource: Cleary et al, 2016 TidyTuesday week36\",\n                                                 color = \"black\",family = \"xkcd\",\n                                                 hjust = 0.5, x = 0.5, face = \"bold.italic\", size = 10),\n                              left = text_grob(\"\", color = c(\"#778899\"), rot = 90,size = 10),\n                              right = text_grob(bquote(\"\"), color = c(\"#778899\"),rot = 90,size = 10),\n                              fig.lab = \"TidyTuesday week36\", fig.lab.face = \"bold.italic\",fig.lab.size = 8,\n                              fig.lab.pos = \"bottom.right\"\n)\n\nfinal_plot <-\n  final_plot +\n\n  annotate(geom = \"text\", label = \"While wild bird feeding is recognised as one of\nthe most popular forms of\nhuman-wildlife interaction, almost nothing is known\n           about the use of bird baths.\",\n           x = 0.15, y = 0.25,colour = \"black\",size = 3,family = \"xkcd\") +\n\n  annotate(geom = \"text\", label = \"\",\n           x = 0.15, y = 0.65,colour = \"black\",size = 3,family = \"xkcd\") +\n\n  annotate(geom = \"text\", label = \"Urbanisation is one of the leading causes of species extinction\n           due to extensive habitat alteration\",\n           x = 0.82, y = 0.04,colour = \"black\",size = 3,family = \"xkcd\") +\n\n  annotate(geom = \"text\", label = \"Bioregions\",x = 0.85, y = 0.88, colour = \"#FF7F00\", size = 5,family = \"xkcd\") +\n  annotate(geom = \"text\", label = \"Rural\",x = 0.73, y = 0.58, colour = \"white\", size = 5,family = \"xkcd\") +\n  annotate(geom = \"text\", label = \"Urban\",x = 0.1, y = 0.5, colour = \"#FF7F00\", size = 5,family = \"xkcd\") +\n  annotate(geom = \"curve\", x = 0.82, xend = 0.76, y = 0.88, yend = 0.72, colour = \"#FF7F00\", curvature = .3, arrow = arrow(length = unit(2, \"mm\")),family = \"xkcd\") +\n  annotate(geom = \"curve\", x = 0.72, xend = 0.68, y = 0.6, yend = 0.65, colour = \"#FF7F00\", curvature = .3, arrow = arrow(length = unit(2, \"mm\")),family = \"xkcd\") +\n  annotate(geom = \"curve\", x = 0.12, xend = 0.2, y = 0.5, yend = 0.43, colour = \"#FF7F00\", curvature = -.3, arrow = arrow(length = unit(2, \"mm\")),family = \"xkcd\") +\n\n  annotate(geom = \"text\", label = \"Comparing Bird types' while enjoing a bird bath\",\n           x = 0.4, y = 0.84,colour = \"#FF7F00\",size = 3,family = \"xkcd\") +\n  annotate(geom = \"text\", label = \"Avian assemblages at urban and rural bird baths\n           differed between bioregions with aggressive\n           nectar-eating species\",\n           x = 0.67, y = 0.38,colour = \"black\",size = 3,family = \"xkcd\")\n\n\n\nrainbow_lorikeet_img <- image_read(here::here(\"w36/parrot2.png\"))\n\nfinal <- ggdraw() +\n  draw_plot(final_plot) +\n  draw_image(rainbow_lorikeet_img, x = 0.89, y = 0.4,width = 0.12)\n\n\nfinal\n\n\n## Save final plot ----\n\nragg::agg_png(here::here(\"w36/w36_bird_baths.png\"),\n              res = 320, width = 15, height = 8, units = \"in\")\nfinal\n\ndev.off()\n\n\n\n# read the image, attach the Tidytuesday logo and save it --------------------------\n\n\ntidy_logo <- image_read(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/static/plot_logo.png\") %>%\n  image_resize(\"300x300\")\n\nimg <- image_read(\"image.png\")\n\n\ntidy_final <- image_read(\"w35_lemurs.png\")\nattached_logo <- image_composite(tidy_final, tidy_logo,\n                                 operator = \"atop\",\n                                 gravity = \"southwest\")\n\nimage_write(attached_logo, path = \"w35_lemurs.png\", format = \"png\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}