{
  "hash": "427720425ada25d201d41a54f6fa0406",
  "result": {
    "markdown": "---\ntitle: \"US Public Parks\"\nsubtitle: \"Welcome to TidyTuesday 2021 week 26\"\ndate: \"2021-06-22\"\nimage: \"w26_public_park_access.png\"\nimage-alt: \"\"\ndescription: \"Networks\"\noutput: html_document\nexecute: \n  eval: false\n---\n\n\n# Week 26 Public Parks\n\n# points for 14 measures across five categories: acreage, investment, amenities, access, and equity.\n# OUTLIERS\n# PARK INCLUSION CRITERIA\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load libraries --------------\nlibrary(tidytuesdayR)\nlibrary(tidyverse)\nlibrary(tidymodels)\ntidymodels_prefer()\n\nlibrary(forcats)\n\nlibrary(DataExplorer)\nlibrary(ggthemes)\nlibrary(hrbrthemes)\nlibrary(viridis)\nlibrary(extrafont)\n\nlibrary(showtext)\n#font_families_google()\nfont_add_google(\"Montserrat\",\"Montserrat\")\nshowtext.auto(enable = TRUE)\n\nlibrary(RColorBrewer)\nlibrary(ggwordcloud)\n\nlibrary(patchwork)\nlibrary(cowplot)\n\n\n# load data ------------------\ntuesdata <- tidytuesdayR::tt_load(2021, week = 26)\n\nparks <- tuesdata$parks\n\n\nhead(parks)\n\n# questions ------------\n\n# - how parks evolved within the years\n# - how many parks have a playground/sports amenities/dogpark/splashgrounds/general amenities/restrooms/benches\n# - has the parks size changed within the years\n# - how has the residents spending evolved\n# - what is the rank by cities\n\n\n# check of the data and tidy manipilation --------------------\nnames(parks)\nstr(parks)\n\nplyr::count(parks$year)\n\n# selecting the columns iwth just points as a measure to have omogeneous data, some of them are\n# on a 50 max scale and other on a 100 max scale, so if I want to used them all I would need to rescale\n# one of the two\n\n  \nminneapolis<-parks%>%\n  filter(city==\"Minneapolis\")\n\nmissing<-profile_missing(minneapolis)\n#View(missing)\nkableExtra::kable(skimr::skim(minneapolis)) %>% kableExtra::scroll_box(width = '100%')\n\nstr(minneapolis)\n\nminneapolis_long<-minneapolis%>%\n  pivot_longer(cols=c(6,8,10),names_to=\"data\",values_to=\"percent\")\n\nminneapolis_long$data2 = factor(minneapolis_long$data, \n                           levels=c(\"spend_per_resident_data\",\"park_pct_city_data\",\"pct_near_park_data\"))\n\nnew_labels=c(\"spend_per_resident_data\"=\"Spending\",\"park_pct_city_data\"=\"Park points\",\"pct_near_park_data\"=\"Neighborhood\")\n\n# first plot ----------------------------\nfirst<-ggplot(data=minneapolis_long,aes(x=year,y=percent,group=data2,colour=data2))+\n  geom_point(aes(size=total_pct))+\n  geom_line()+\n  geom_text(aes(label=percent),stat=\"identity\",vjust=-1.5,show.legend = F,size=2)+\n  guides(colour = FALSE, size = FALSE)+\n  scale_color_viridis(discrete=TRUE)+\n  labs(title=\"\\nPark spending, points, neighborhood\\n\",\n       # subtitle=\"\\n2012 - 2020\\n\",\n       caption=\"\",\n       colour=\"\",\n       # tag=\"The \\nTrust \\nfor \\nPublic \\nLand\",\n       x=seq(2012,2020,1), y=\"\")+\n  facet_wrap(~data2,labeller = labeller(data2=new_labels))+\n  theme_fivethirtyeight()+\n  theme(axis.text.x = element_text(angle=90,family=\"Montserrat\"),\n        axis.text.y = element_blank(),\n        axis.ticks.y = element_blank(),\n        strip.background = element_blank(),\n        strip.text = element_text(color=\"black\",family=\"Montserrat\"),\n        plot.title = element_text(family=\"Montserrat\",hjust = 0.5,size=12),\n        plot.subtitle = element_text(family=\"Montserrat\",hjust = 0.1),\n        # plot.tag = element_text(family=\"Montserrat\",size=10),\n        # plot.tag.position = c(0.05, 0.9),\n        #panel.grid = element_blank(),\n        #panel.grid.major = element_blank(),\n        #panel.grid.minor = element_blank(),\n        plot.background = element_rect(color=\"#a1d99b\",fill=\"#a1d99b\"),\n        panel.background = element_rect(color=\"#a1d99b\",fill=\"#a1d99b\"),\n        strip.text.y  = element_text(family=\"Montserrat\"),\n        plot.margin = margin(0,0,0,0,unit=\"pt\"))\n\n\n#####################\n\nsub_minneapolis <- minneapolis%>%\n  filter(year==c(2020,2019,2018))%>%\n  select(city,matches(c(\"year\",\"rank\",\"points\")),-total_points)%>%\n  mutate(med_park_size_points=med_park_size_points/50*100,\n         park_pct_city_points=park_pct_city_points/50*100)%>%\n    group_by(year,rank,amenities_points)%>%\n   mutate(total= rowMeans(across(where(is.numeric))))%>%\n    ungroup()%>%\n  rename(c(\"Basketball\"=\"basketball_points\",\"Dogpark\"=\"dogpark_points\",\n           \"Playground\"=\"playground_points\",\"Recreation and senior centers\"=\"rec_sr_points\",\n           \"Splashground\"=\"splashground_points\",\"Restroom\"=\"restroom_points\"))\n  \n######################  \nmin=1\nmax=100\n\namenities_per_year <-minneapolis%>%\n  filter(year==c(2020,2019,2018))%>%\n  select(city,matches(c(\"year\",\"rank\",\"points\")),-total_points)%>%\n  rename(c(\"Basketball\"=\"basketball_points\",\"Dogpark\"=\"dogpark_points\",\n           \"Playground\"=\"playground_points\",\"Recreation and senior centers\"=\"rec_sr_points\",\n           \"Splashground\"=\"splashground_points\",\"Restroom\"=\"restroom_points\"))%>%\n    janitor::clean_names()%>%\n  mutate(basketball=basketball/10000*10000,\n         dogpark=dogpark/100000*10000,\n         playground=playground/10000*10000,\n         recreation_and_senior_centers=recreation_and_senior_centers/20000*10000,\n         restroom=restroom/100000*10000,\n         splashground=splashground/100000*10000)%>%\n    #select(8:13)%>%\n  pivot_longer(cols=c(8:13),names_to=\"data_points\",values_to=\"points\")%>%\n  select(year,data_points,points,amenities_points)%>%\n  group_by(data_points)%>%\n  mutate(#normalized = ((points-min(points))/(max(points)-min(points)))*100,\n         normalized100 = ((points-min)/(max-min)))%>%ungroup()\n\n\nnormalized_per_year_plot <- ggplot(data=amenities_per_year) +\n  geom_col(aes(x=data_points,y=normalized100,fill=factor(year),color=factor(year))) + \n  scale_color_viridis(discrete=TRUE,option=\"G\")  +\n    guides(color=FALSE)+\n    scale_fill_viridis(discrete=TRUE,option=\"G\") +\n  scale_x_discrete(label=c(\"Basketball\",\"Dogpark\",\"Playground\",\"Recreation\",\"Splashground\",\"Restroom\"))+\n    #annotate(\"text\",label=\"improvements\",x=2019.5,y=700,family=\"Montserrat\")+\n    labs(title=\"Amenities points Normalized100\",\n         #subtitle=\" 2018 - 2020 \",\n         caption=\"\",\n         fill=\"\",\n         color=\"\",\n         tag=\"\")+\n    theme_fivethirtyeight()+\n    theme(axis.ticks.x = element_line(size=2,color=\"red\"),\n          axis.text.x = element_text(family=\"Montserrat\",angle=20,size=5),\n          axis.text.y = element_text(family=\"Montserrat\"),\n          axis.ticks.y = element_blank(),\n          plot.title = element_text(family=\"Montserrat\",size=8),\n          plot.subtitle = element_text(family=\"Montserrat\",vjust=-0.5,hjust=0.3,size=10),\n          plot.caption = element_text(family=\"Montserrat\"),\n          plot.tag = element_text(family=\"Montserrat\",size=10),\n          plot.tag.position = c(0.08, 0.9),\n          plot.background = element_rect(color=\"#a1d99b\",fill=\"#a1d99b\"),\n          panel.background = element_rect(color=\"#a1d99b\",fill=\"#a1d99b\"),\n          legend.title = element_text(family=\"Montserrat\",hjust=0),\n          legend.background = element_blank(),\n          legend.position = \"top\",\n          legend.key.size = unit(0.3, 'cm'),\n          legend.text = element_text(family=\"Montserrat\",size=8),\n          plot.margin = margin(30,30,30,30,unit=\"pt\"))\n\n##########################   \n\n# sub_minneapolis%>%pivot_longer(cols=c(8:13),names_to=\"data_points\",values_to=\"points\")\n  \n# Level of Minneapolis park feautures  \namenities_per_year_plot <- ggplot(data=amenities_per_year,aes(x=year,y=points)) +\n  geom_col(aes(color=data_points,fill=data_points)) +\n  geom_smooth(aes(y = amenities_points),color=\"red\",method=\"lm\",formula = y ~ splines::bs(x, 5)) +\n  scale_color_viridis(discrete=TRUE)  +\n  guides(color=FALSE)+\n  scale_fill_viridis(discrete=TRUE,label=c(\"Basketball\",\"Dogpark\",\"Playground\",\"Recreation\",\"Splashground\",\"Restroom\")) +\n  labs(title=\"Amenities points by year\",\n       #subtitle=\"three years of points increase\",\n       caption=\"Viz @fgazzelloni DataSource: TidyTuesday week26 Public Park Access,TPL,CityLab\",\n       fill=\"\",\n       color=\"\"\n       #tag=\"Amenities points 2018-2020\"\n       )+\n  theme_fivethirtyeight() +\n  theme(axis.ticks.x = element_line(size=2,color=\"red\"),\n        axis.text.x = element_text(family=\"Montserrat\"),\n        axis.text.y = element_text(family=\"Montserrat\"),\n        axis.ticks.y = element_blank(),\n        plot.title = element_text(family=\"Montserrat\",size=8),\n        plot.subtitle = element_text(family=\"Montserrat\",vjust=-0.5,hjust=0.3,size=10),\n        plot.caption = element_text(family=\"Montserrat\",face=\"bold\"),\n        plot.tag = element_text(family=\"Montserrat\",size=10),\n        plot.tag.position = c(0.08, 0.9),\n        plot.background = element_rect(color=\"#a1d99b\",fill=\"#a1d99b\"),\n        panel.background = element_rect(color=\"#a1d99b\",fill=\"#a1d99b\"),\n        legend.title = element_text(family=\"Montserrat\",hjust=0),\n        legend.background = element_blank(),\n        legend.text = element_text(family=\"Montserrat\",size=8),\n        legend.key.size = unit(0.3, 'cm'),\n        legend.position = \"top\",\n        plot.margin = margin(30,30,30,30,unit=\"pt\"))\n  \nsecond <- normalized_per_year_plot | amenities_per_year_plot\n\n\nthird<- ggplot()+\n  geom_blank() +\n  labs(title=\"Minneapolis\")+\n  theme_fivethirtyeight()+\n  theme(plot.background = element_rect(color=\"#a1d99b\",fill=\"#a1d99b\"),\n        panel.background = element_rect(color=\"#a1d99b\",fill=\"#a1d99b\"),\n        plot.title = element_text(family=\"Montserrat\",color=\"yellow\"))\n\nfourth <- parks%>%\n  filter(rank<=10)%>%\n  mutate(city=case_when(city==\"Washington, DC\"~\"Washington, D.C.\",\n                                 TRUE~city))%>%\n  count(city)%>%\n  ggplot(aes(label=city,color=city))+\ngeom_text_wordcloud(family=\"Montserrat\") +\n  labs(title=\"Minneapolis ranked the first best 7 times between 2012 - 2020\",\n       tag=\"The \\nTrust \\nfor \\nPublic \\nLand\")+\n  theme_fivethirtyeight()+\n  theme(plot.background = element_rect(color=\"#a1d99b\",fill=\"#a1d99b\"),\n        panel.background = element_rect(color=\"#a1d99b\",fill=\"#a1d99b\"),\n        plot.title = element_text(family=\"Montserrat\",size=12,hjust=0.5),\n        plot.tag = element_text(family=\"Montserrat\",size=10,color=\"white\"),\n        plot.tag.position = c(0.04, 0.9))\n \nlibrary(magick)\nlibrary(ggimage)\n\n\n\nimg = \"minneapolis_park.png\"\nthird<-ggbackground(third, img,alpha=.9)\n\none <-third/first \n\ntwo<-fourth/second\n\nfinal <-one|two\n\nbck_color <- \"#a1d99b\"\n\nfinal <- final + plot_annotation(\n  title = \"\\nMinneapolis Park improvment racing\\n\",\n  subtitle=\"'The Trust for Public Land creates parks and protects land for people, ensuring healthy, livable communities for generations to come' \",\n  theme = theme(\n    plot.margin = margin(10,10,10,10),\n    plot.background = element_rect(fill = bck_color, color = NA),\n    panel.background = element_rect(color=\"#a1d99b\",fill=\"#a1d99b\"),\n    plot.title = element_text(family = \"Montserrat\",vjust=-0.5,face=\"bold\"),\n    plot.subtitle = element_text(family = \"Montserrat\"),\n    plot.caption = element_text(family = \"Montserrat\", size = 9, color = bck_color, \n                                margin = margin(15,0,0,0), hjust = 0.95)\n  )\n)\n\nfinal_plot <- stamp(final,label=\"#TidyTuesday week 26\",color=\"red\",alpha = 1,\n      vjust = 1.8,\n      hjust = 1.2,\n      size = 14,\n      family = \"Montserrat\",\n      fontface = \"bold\",\n      clip = \"on\")\n\n\n\n###################### SAVING ############################\n\n\nragg::agg_png(here::here(\"w26\",\"w26_parks.png\"),\n              res = 320, width = 14, height = 8, units = \"in\")\nfinal_plot\n\ndev.off()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}