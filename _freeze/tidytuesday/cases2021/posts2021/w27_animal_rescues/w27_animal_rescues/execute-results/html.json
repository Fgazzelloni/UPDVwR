{
  "hash": "8045ec1e1aa12c91a813022fd20d4c4e",
  "result": {
    "markdown": "---\ntitle: \"Animal Rescues\"\nsubtitle: \"Welcome to TidyTuesday 2021 week 27\"\ndate: \"2021-06-29\"\nimage: \"w27_animal_rescues.png\"\nimage-alt: \"\"\ndescription: \"Networks\"\noutput: html_document\nexecute: \n  eval: false\n---\n\n\n# Week 27 TidyTuesday Animal Rescues\n\nmore reading:\n[Animal rescues by London fire brigade rise 20% in pandemic year](https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-06-29/readme.md#:~:text=Animal%20rescues%20by%20London%20fire%20brigade%20rise%2020%25%20in%20pandemic%20year)\n- [TrackReconstruction](https://cran.r-project.org/web/packages/TrackReconstruction/TrackReconstruction.pdf)\n- [animate bar plot](https://stackoverflow.com/questions/61150926/r-label-with-commas-but-no-decimals)\n- [composition of plots](http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/81-ggplot2-easy-way-to-mix-multiple-graphs-on-the-same-page/)\n- [annotate](https://rpkgs.datanovia.com/ggpubr/reference/annotate_figure.html)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggpubr)\nlibrary(ggthemes)\nlibrary(ggalt)\nlibrary(gganimate)\nlibrary(ggdist)\nlibrary(ggExtra)\nlibrary(ggtext)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2021, week = 27)\nanimal_rescues <- tuesdata$animal_rescues\n\nhead(animal_rescues)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(animal_rescues)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(animal_rescues)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nanimal_rescues_small <- animal_rescues %>% \n  select(date_time_of_call,cal_year,incident_notional_cost,animal_group_parent,\n         special_service_type,ward,borough,stn_ground_name,latitude,longitude) %>%\n  mutate(borough=tolower(borough)) %>% \n  drop_na() %>%\n  mutate(animal_group_parent=case_when(stringr::str_detect(animal_group_parent,\"^Unknown\") ~ \"Unknown\",\n                                       TRUE ~ animal_group_parent),\n         cal_year=as.factor(cal_year) ,\n         incident_notional_cost=ifelse(incident_notional_cost==\"NULL\",0,incident_notional_cost),\n         incident_notional_cost=as.numeric(incident_notional_cost),\n         date_time_of_call=as.Date(date_time_of_call,\"%d/%m/%Y\")) %>%\n  rename(date=date_time_of_call,year=cal_year) %>%\n  mutate(month=lubridate::month(date),\n         day=lubridate::day(date)) %>%\n  complete(date = full_seq(date, 1)) %>%\n  mutate(incident_notional_cost_full = round(spline(x = date, y = incident_notional_cost, xout = date)$y))\n  \n\nstr(animal_rescues_small)\n\nanimal_rescues_small %>% count(incident_notional_cost) %>% arrange(-n) #desc(incident_notional_cost))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nDataExplorer::profile_missing(animal_rescues_small)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncalls <- animal_rescues_small%>%group_by(year)%>%count(year)%>%arrange(-n)\n\n\nbar_plot <- ggplot(data=animal_rescues_small%>%drop_na(),aes(x=year,y=borough)) + \n  geom_col(aes(group=borough,fill=borough,color=borough)) +\n  geom_text(data=calls, aes(x= year, y=n, label=n), hjust=0.5,\n           position = position_stack(vjust = 18),fontface = \"bold\"\n            )+\n  guides(color=\"none\",fill=\"none\") +\n  labs(title=\"Numbers of call by Year to the London Fire Brigate for Animal Rescues\",\n       x=\"Year\",y=\"by London Borough\") + \n  ggthemes::theme_calc() +\n  theme(axis.text.y = element_blank(),\n        axis.text.x = element_text(size=8),\n        axis.title.x = element_text(vjust=-2),\n        axis.ticks.x = element_line(size=2,color=\"pink\"),\n        plot.title = element_text(face=\"bold\",size=11),\n        plot.margin = unit(c(0.5,0.5,0.5,0.5), \"cm\"))\n\nbar_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbox_plot <- animal_rescues_small %>%  drop_na() %>% # count(year)\n  filter(incident_notional_cost<2000) %>%\n  ggplot(aes(x=fct_reorder(animal_group_parent, incident_notional_cost),y=incident_notional_cost, group=animal_group_parent)) +\n  geom_boxplot(aes(color=animal_group_parent),size=0.5,alpha=0.4) +\n  scale_y_continuous(labels = scales::comma) +\n  guides(color=\"none\") +\n  labs(title=\"LFB Animal Rescues - Incident notional cost 2009 - 2021\",\n       color=\"Animal group parent\", y=\"Cost value £\",x=\"\") +\n  coord_flip() +\n  ggthemes::theme_calc() +\n  theme(axis.text.y = element_text(size=8,angle=0),\n        axis.text.x = element_text(size=8,angle=0),\n        axis.title.x = element_text(vjust=-2),\n        axis.ticks.x = element_line(size=2,color=\"pink\"),\n        axis.ticks.y = element_line(size=2,color=\"pink\"),\n        panel.grid.major.y = element_line(size=0.2),\n        plot.title = element_text(face=\"bold\",size=11),\n        plot.margin = unit(c(0.5,0.5,0.5,0.5), \"cm\"))\n\nbox_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsmoth_line <-animal_rescues_small%>%\n  group_by(month)%>%\n  summarise(med_val=median(incident_notional_cost))%>%\n  ungroup() \n\n\n\ncost_month_plot <- ggplot(data=smoth_line,aes(x=month,y=med_val))+\n  geom_point(shape=21,aes(fill=month)) +\n  geom_line(linetype = 3)+\n  geom_smooth(size=0.3,fill=\"pink\") +\n  geom_boxplot(data=subset(animal_rescues_small,incident_notional_cost<500 & incident_notional_cost>200),\n               aes(x=month,y=incident_notional_cost,group=month,color=month),fill=NA) +\n  geom_text(aes(label=med_val),vjust = -1) +\n  scale_x_discrete(limits =seq(1,12,1), labels=c(\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\n                                                 \"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"))+\n  guides(fill=\"none\",color=\"none\") + \n  labs(title=\"Cost of incident by month (2009 - 2021)\",\n       x=\"Month\",y=\"Median value £\") +\n  ggthemes::theme_calc() +\n  theme(axis.text.y = element_blank(),\n        axis.text.x = element_text(size=8),\n        axis.title.x = element_text(vjust=-2),\n        axis.ticks.y = element_blank(),\n        axis.ticks.x = element_line(size=2,color=\"pink\"),\n        panel.grid.major.y = element_blank(),\n        panel.grid.minor.y = element_line(size=0.1),\n        plot.title = element_text(face=\"bold\",size=11),\n        plot.margin = unit(c(0.5,0.5,0.5,0.5), \"cm\"))\n\ncost_month_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsmoth_line_yr <-animal_rescues_small%>%#count(year)\n  mutate(year=as.numeric(year))%>% #count(year)\n  group_by(year)%>%\n  summarise(tot_val=sum(incident_notional_cost_full))%>%\n  ungroup() \n\n\n\ncost_yr_plot <- ggplot(data=smoth_line_yr,aes(x=year,y=tot_val))+\n  geom_point(shape=21,aes(fill=year)) +\n  geom_line(linetype = 3)+\n  geom_smooth(size=0.3,fill=\"pink\") +\n  geom_text(aes(label=scales::comma(tot_val)),vjust = -1.5,size=3) +\n  scale_x_discrete(limits =seq(1,13,1),labels=seq(2009,2021,1))+\n  guides(fill=\"none\",color=\"none\") + \n  labs(title=\"Annual cost of incidents by Year (2009 - 2021)\",\n       y=\"Annual cost - median value £\",x=\"Year\") +\n  ggthemes::theme_calc() +\n  theme(axis.text.y = element_blank(),\n        axis.text.x = element_text(size=8),\n        axis.title.x = element_text(vjust=-2),\n        axis.ticks.y = element_blank(),\n        axis.ticks.x = element_line(color=\"pink\",size=1),\n        panel.grid.major.x = element_line(size=0.1),\n        panel.grid.major.y = element_blank(),\n        plot.title = element_text(face=\"bold\",size=11),\n        plot.margin = unit(c(0.5,0.5,0.5,0.5), \"cm\"))\n\ncost_yr_plot  \n```\n:::\n\n::: {.cell layout-align=\"center\" ut.width='100%'}\n\n```{.r .cell-code}\np1 <- ggarrange(bar_plot, box_plot + \n                font(\"x.text\", size = 9),\n                ncol = 1, nrow = 2)\np2 <- ggarrange(cost_month_plot, cost_yr_plot +\n                font(\"x.text\", size = 9),\n                ncol = 1, nrow = 2)\ngraphics<- ggarrange(p1, p2, ncol = 2, nrow = 1)\n\n\n\n\nfinal_plot <- annotate_figure(graphics,\n               top = text_grob(\"Animal rescues by London fire brigade rise 20% in pandemic year\", \n                               color = c(\"#FF34B3\", \"#FFFFFF\", \"#FFFFFF\"), face = \"bold\", size = 14),\n               bottom = text_grob(\"DataViz: @fgazzelloni DataSource: \\n TidyTuesday and Animal Rescues - London.gov - The Guardian - week27\",\n                                  color = \"blue\",\n                                  hjust = 1, x = 1, face = \"italic\", size = 10),\n               left = text_grob(\"Last year 337 animals were helped compared with 269 in 2019\", color = c(\"#BA55D3\", \"#FFFFFF\", \"#FFFFFF\"), rot = 90,size=10),\n               right = text_grob(bquote(\"The LFB calculates the average cost of each rescue to be £346\"), rot = 90,size=10),\n               fig.lab = \"TidyTuesday week27\", fig.lab.face = \"bold\"\n)\n\nfinal_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n###################### SAVING ############################\n\n\nragg::agg_png(here::here(\"w27\",\"w27_animals.png\"),\n              res = 320, width = 14, height = 8, units = \"in\")\nfinal_plot\n\ndev.off()\n\n##################################################\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}