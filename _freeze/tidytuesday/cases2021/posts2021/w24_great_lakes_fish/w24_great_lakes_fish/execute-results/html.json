{
  "hash": "d924d4ad80a246d1df5fa3bfc2eb81e6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Great Lakes Fish\"\nsubtitle: \"Welcome to TidyTuesday 2021 week 24\"\ndate: \"2021-06-08\"\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/TidyTuesday/ab924a20bbe270bab306f4b13df0daaa6e53ffeb/data/2021/w24_great_lakes_fish/w24_great_lakes_fish.png'\ndescription: \"Networks\"\noutput: html_document\nexecute: \n  eval: false\n---\n\n\n\n\n# TidyTuesday week 24 \n\nData Source: Great Lakes Fish,\tGreat Lakes Database,\tDetroit Free Press\ndatabase of all fish stocked from artificial propagation into the Great Lakes\n\n\nlibraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidytuesdayR)\nlibrary(tidyverse)\nlibrary(stringr)\nlibrary(hrbrthemes)\nlibrary(viridis)\nlibrary(forcats)\nlibrary(ggridges)\nlibrary(patchwork)\n\n# load data ##############################\ntuesdata <- tidytuesdayR::tt_load(2021, week = 24)\n\n\nstocked <- tuesdata$stocked\nfishing <- tuesdata$fishing\n\n# check #################################\nhead(stocked);dim(stocked)\nhead(fishing);dim(fishing)\n\nlibrary(DataExplorer)\nprofile_missing(fishing)\n\nfishing$grand_total[is.na(fishing$grand_total)]<-0\nfishing$values[is.na(fishing$values)]<-0\n\n# wrangling ###########################\nmy_df <- fishing%>%\n  arrange(year)%>%\n  mutate(\n    species=case_when(species==\"Amercian Eel\"~\"American Eel\",\n              species==\"Bullhead\"~\"Bullheads\",\n              species==\"Channel catfish\"~\"Channel Catfish\",\n              species==\"Cisco and chubs\"~\"Cisco and Chubs\",\n              species==\"Cisco and Chub\"~\"Cisco and Chubs\",\n              species==\"Crappie\"~\"Crappies\",\n              species==\"Drum\"~\"Freshwater Drum\",\n              species==\"Lake Trout - siscowet\"~\"Lake Trout\",\n              species==\"Pacific salmon\"~\"Pacific Salmon\",\n              species==\"White bass\"~\"White Bass\",\n              TRUE~species))\n\n\n# plotting #################################\n\nfig1 <- my_df %>%\n  filter(!str_detect(species,\"and\")) %>%\n  arrange(year)%>%\n  mutate(text = fct_reorder(species, year )) %>%\n  ggplot( aes(y=text, x=year,fill=species)) +\n  geom_density_ridges_gradient(scale = 2, rel_min_height = 0.01) +\n  scale_fill_viridis(discrete=TRUE) +\n  scale_x_continuous(breaks=seq(1867, 2015, 8))+\n  labs(title=\"All Fisheries from the Great Lakes Fishery Commission\",\n       subtitle=\"from 1867 to 2015\",\n       tag = \"Fig1\")+\n  xlab(\"\") +\n  ylab(\"Assigned Probability (%)\")+\n  theme_ft_rc()+\n  theme(axis.text.x = element_text(angle=90),\n    legend.position=\"none\",\n    plot.title.position = \"plot\",\n    panel.grid.major.x = element_blank(),\n    panel.grid.minor.x = element_blank(),\n    panel.spacing = unit(0.1, \"lines\"),\n    strip.text.x = element_text(size = 8))\n\n\nfig2 <- my_df%>%\n  filter(!str_detect(species,\"and\")) %>%\n  group_by(year,species)%>%\n  summarize(total_number=sum(grand_total),total_production=sum(values))%>%\n  ungroup()%>%\n  arrange(total_number)%>%\n  filter(!total_number==0)%>%\n  mutate(percent=total_production/total_number)%>%\n  filter(!percent>1)%>%\n  arrange(year,percent)%>%\n  filter(str_detect(species,(\"Lake\")))%>%\n  ggplot(aes(x=year,y=reorder(species,-total_production),group=species,color=species))+\n  geom_line(aes(size=total_production))+\n  labs(title=\"Lake Fisheries by Year\",\n       subtitle=\"sized by total value of production\",\n       tag=\"Fig2\",\n       size=\"Total value of production in $\",\n       x=\"\",\n       y=\"Species\"\n       #color=\"Species\",#size=\"Percent\",\n       #caption=\"Viz @fgazzelloni, DataSource: TidyTuesday Week24 - Great Lakes Fish,Great Lakes Database,Detroit Free Press\"\n       )+\n scale_color_viridis(discrete = TRUE)+\n  guides(color = FALSE)+\n   scale_x_continuous(breaks=seq(1867, 2015, 18))+\n  theme_ft_rc()+\n  theme(axis.text.x = element_text(angle=0),\n        legend.position = \"top\",\n        panel.grid = element_blank(),\n        panel.grid.minor = element_blank(),\n        panel.grid.major = element_blank())\n\nfig3 <- my_df%>%\n  filter(!str_detect(species,\"and\")) %>%\n  arrange(year)%>%\n  filter(str_detect(species,(\"Lake\")))%>%\n  ggplot(aes(x=species, y=values, fill=species)) +\n  geom_boxplot() +\n  scale_fill_viridis(discrete = TRUE, alpha=0.6) +\n  geom_jitter(aes(colour=values), size=0.3, alpha=0.5) +\n  scale_colour_viridis_c()+\n  labs(tag = \"Fig3\",\n       x=\"\",y=\"Values\",\n       caption=\"Viz @fgazzelloni, DataSource: TidyTuesday Week24 - Great Lakes Fish,Great Lakes Database,Detroit Free Press\")+\n  theme_ft_rc() +\n  theme(\n    legend.position=\"none\",\n    panel.background = element_blank(),\n    panel.grid = element_blank(),\n    panel.grid.major = element_blank(),\n    panel.grid.minor = element_blank())\n\n\n\n\n\n\n\nfinal <- fig1+(fig2/fig3)\n\nfinal\n\n\n\n\n\n\n###################### SAVING ############################\n\n\nragg::agg_png(here::here(\"w24\",\"w24_fisheries.png\"),\n              res = 320, width = 14, height = 8, units = \"in\")\nfinal\n\ndev.off()\n\n\n\n#### ATTACHING LOGO ############################\nlibrary(ggimage)\nlibrary(magick)\n\n\ntidy_logo<-image_read(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/static/plot_logo.png\") %>%\n  image_resize(\"300x300\")\n\n\nfinal_plot <- image_read(\"w24/w24_fisheries.png\")\n\nattached_logo <- image_composite(final_plot, tidy_logo,\n                                 operator=\"atop\",\n                                 gravity=\"northeast\") # tell R where to put the logo\n\n\nimage_write(attached_logo, path = \"w24/w24_fisheries.png\",\n            format = \"png\") # save final plot\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}