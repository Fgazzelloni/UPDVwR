{
  "hash": "b043aaa53ab7b7c7f9db7a2d705472a7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Dr. Who'\nsubtitle: 'Welcome to TidyTuesday 2021 week 48'\ndate: '2021-11-23'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/TidyTuesday/ab924a20bbe270bab306f4b13df0daaa6e53ffeb/data/2021/w48_dr_who/w48_dr_who.png'\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n\n\n\n##  DR. WHO TidyTuesday week 48\nrm(list=ls())\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(\"datardis\")\n\ndirectors <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-11-23/directors.csv')\nepisodes <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-11-23/episodes.csv')\nwriters <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-11-23/writers.csv')\n\nmy_df <- directors%>%\n  full_join(episodes,by=\"story_number\")%>%\n  full_join(writers,by=\"story_number\")\n\n# my_df%>%head\n\nuk_viewers<- my_df$uk_viewers\nuk_viewers[is.na(uk_viewers)]<- 0\n\n\n# https://www.r-graph-gallery.com/59-nifty-graph.html\nmoxbuller = function(uk_viewers) {   \n  u = runif(uk_viewers)   \n  v = runif(uk_viewers)   \n  x = cos(2*pi*u)*sqrt(-2*log(v))  \n  y = sin(2*pi*v)*sqrt(-2*log(u))\n  r = list(x=x, y=y)\n  return(r) \n}\nr = moxbuller(5000) \n\n\n# https://github.com/coolbutuseless/threed\nlibrary(threed)\ncamera_to_world <- threed::look_at_matrix(eye = c(4, 2, 5), \n                                          at = c(0, 0, 0))\nobj <- threed::mesh3dobj$cube %>%\n  transform_by(invert_matrix(camera_to_world)) %>%\n  perspective_projection()\n\n\nplot<-  data.frame(r)%>%\n  ggplot(aes(x=x,y=y,z=0))+\n  geom_point(shape=\".\",col=\"blue\")+\n  geom_polygon(data=obj,aes(x = x*25, y = y*25, group = zorder,\n                            linetype = hidden,  size = hidden), #zorder the drawing order of the elements from back to front\n               fill = NA, colour = 'blue', size = 0.7,\n               show.legend = F) +\n  geom_rect(mapping=aes(xmin=-30,xmax=0.7,ymin=0.2,ymax=0.8),\n            fill=NA)+  \n  theme_void() +\n  theme(plot.background = element_rect(color=\"black\",\n                                       fill=\"black\"))\n \n\nlibrary(showtext)\n\n# Import fonts\nfont_add_google(\"Luckiest Guy\", \"Luckiest\")\nfont_add_google(\"Poiret One\", \"Poiret\")\nshowtext_auto()\nshowtext_opts(dpi = 320)\n\n\nplot2<-my_df%>%\nggplot(aes(x=uk_viewers,y=rating))+\n  geom_jitter(aes(color=duration),show.legend = T)+\n  geom_smooth()+\n  theme_void()+\n  labs(x=\"rating\",y=\"viewers\",color=\"\")+\n  scale_color_viridis_c()+\n  theme(plot.background = element_rect(color=NA,\n                                       fill=NA),\n        text = element_text(family=\"Luckiest\",color=\"blue\"),\n        legend.position = c(0.5,-0.4),\n        legend.direction = \"horizontal\",\n        legend.title = element_blank())\n\n\n\nmy_df%>%\n  mutate(year=lubridate::year(first_aired))%>%\n  group_by(year)%>%\n  summarize(tot_view=sum(uk_viewers))%>%\n  arrange(-tot_view)#,rating,director)%>%arrange(-uk_viewers,-rating)\n\n######################################\nlibrary(prophet)\ndf<-my_df%>%select(ds=first_aired,y=uk_viewers)\nm <-prophet(df)\nfuture <- prophet::make_future_dataframe(m, periods=365)\nforecast <- predict(m,future)\n\n#### PROPHET PLOT COMPONENTS ###############################################\nplot3<-prophet_plot_components(m, forecast)\n######################################\ntrend <- forecast%>%\n  ggplot(aes(x=ds,y=trend))+\n  geom_line(color=\"blue\")+\n  theme_void()+\n  labs(x=\"rating\",y=\"viewers\")+\n  theme(plot.background = element_rect(color=NA,\n                                       fill=NA),\n        text = element_text(family=\"Luckiest\",color=\"blue\"),\n        axis.text.x = element_text(color=\"blue\",family = \"Luckiest\"))\n######################################\ntrend\n######################################\nweekly<- forecast%>%\n  mutate(day=lubridate::wday(ds,label = T,abbr = F,\n                             week_start = getOption(\"lubridate.week.start\", 7),\n                             locale = Sys.getlocale(\"LC_TIME\")),\n         .after=ds) %>%\n  select(ds,day,weekly,yearly,trend) %>%\n  \n  ggplot(aes(x=day,y=weekly,group = 1))+\n  geom_line(color=\"blue\")+\n  #geom_text(aes(label=day),color=\"blue\",family=\"Luckiest\")+\n  theme_void()+\n  labs(x=\"rating\",y=\"viewers\")+\n  theme(plot.background = element_rect(color=NA,\n                                       fill=NA),\n        text = element_text(family=\"Luckiest\",color=\"blue\"),\n        axis.text.x = element_text(color=\"blue\",\n                                   family = \"Luckiest\",\n                                   angle=15,size=8))\n######################################\nweekly # m$changepoints\n######################################\n\nlibrary(patchwork)\nplot3<-trend/weekly\n\n\nlibrary(cowplot)\nfinal <- ggdraw()+\n  draw_plot(plot)+\n  draw_plot(plot2,x = 0.02, y = 0,scale = 0.3)+\n  draw_plot(trend,x = -0.4, y = 0.2,scale = 0.25,height = 0.7,width=1.2)+\n  draw_plot(weekly,x = -0.4, y = -0.06,scale = 0.25,height = 0.7,width=1.2)+\n  draw_text(\"Dr. WHO - UK Viewers\", x=0.4,y=0.93,\n            color=\"blue\",size=42,family=\"Luckiest\")+\n  draw_text(\"Favorite months for watching are April, June and September\n            While the Years with the highest numbers of views \n            are 2010 and 2008\",\n            x=0.34,y=0.8,size=18,family=\"Luckiest\",color=\"blue\")+\n  draw_text(\"General trend declined after 2010 \n            favorite days of the week for watching are Tuesday to Friday\",\n            x=0.4,y=0.1,size=18,family=\"Luckiest\",color=\"blue\")+\n  draw_text(\"Trend\",x=0.04,y=0.56,angle=90,color=\"blue\",family = \"Luckiest\")+\n  draw_text(\"Weekly\",x=0.05,y=0.3,angle=90,color=\"blue\",family = \"Luckiest\")+\n  draw_text(\"Ratings\",x=0.365,y=0.53,angle=90,color=\"blue\",family = \"Luckiest\")+\n  draw_text(\"Viewers\",x=0.5,y=0.35,angle=0,color=\"blue\",family = \"Luckiest\")+\n  draw_text(\"Duration\",x=0.43,y=0.25,angle=0,color=\"blue\",family = \"Luckiest\",size=12)+\n  draw_text(\"Nifty UK Viewers density\",x=0.94,y=0.73,angle=88,\n            color=\"blue\",size=12,\n            family=\"Luckiest\")+\n  draw_text(\"#TidyTuesday week48 Dr.Who - DataViz: Federica Gazzelloni\", \n            x=0.4,y=0.03,color=\"blue\",size=14,family=\"Luckiest\")+\n  draw_image(\"/Users/federica/Documents/R/R_general_resources/TidyTuesday/TidyTuesday/w48/drwho.png\",\n             x=-0.14,y=0.17,scale=0.15)+\n  draw_image(\"/Users/federica/Documents/R/R_general_resources/TidyTuesday/TidyTuesday/w48/tardis.jpg\",\n             x=-0.42,y=0.42,scale=0.12)\n\nragg::agg_png(here::here(\"/Users/federica/Documents/R/R_general_resources/TidyTuesday/TidyTuesday/w48/dr_who2.png\"),\n              res = 320, width = 12, height = 8, units = \"in\")\nfinal\ndev.off()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}