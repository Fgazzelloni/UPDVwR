{
  "hash": "7c96f1c88d5cd6e7a021c987e779a8a3",
  "result": {
    "markdown": "---\ntitle: \"US drought\"\nsubtitle: \"Welcome to TidyTuesday 2021 week 30\"\ndate: \"2021-07-20\"\nimage: \"w30_drought.png\"\nimage-alt: \"\"\ndescription: \"Networks\"\noutput: html_document\nexecute: \n  eval: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\nResources for this week:\n\n- [rfordatascience](https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-07-20/readme.md)\n- [ComprehensiveStatistics](https://droughtmonitor.unl.edu/DmData/DataDownload/ComprehensiveStatistics.aspx)\n- [NYT](https://www.nytimes.com/interactive/2021/06/11/climate/california-western-drought-map.html)\n- [CNN](https://edition.cnn.com/2021/06/17/weather/west-california-drought-maps/index.html)\n- [Drought Classification](https://droughtmonitor.unl.edu/About/AbouttheData/DroughtClassification.aspx)\n- [drought Monitor](https://droughtmonitor.unl.edu/ConditionsOutlooks/CurrentConditions.aspx)\n\nFacts 2001 to 2021:\n\n- Six states are now entirely in drought conditions\n- The drought has nearly doubled in size from this time last year\n- Around 25% of the country was in drought conditions in July 2020\n- More than 94% of the West is in drought\n- More than 60% of the region is in 'extreme' or 'exceptional' drought\n- Six states completely in drought conditions; California, Oregon, Nevada, Utah, Idaho and North Dakota\n\nData limitations:\n\n- statistics are limited to areas based on counties\n- population changes over time\n- population is distributed evenly across each county\n\n- [limitation](https://droughtmonitor.unl.edu/About/AbouttheData/PopulationStatistics.aspx)\n\nCaption: The U.S. Drought Monitor is jointly produced by the National Drought Mitigation Center at the University of Nebraska-Lincoln, the United States Department of Agriculture, and the National Oceanic and Atmospheric Administration. Map courtesy of NDMC.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2021, week = 30)\n\ndrought <- tuesdata$drought\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(drought)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndrought%>%count(drought_lvl)\n```\n:::\n\n\nIntensity and Impacts\n\n::: {.cell}\n\n```{.r .cell-code}\nintensity_impacts<- c(\"D0\"=\"Abnormally Dry\",\n                      \"D1\"=\"Moderate Drought\",\n                      \"D2\"=\"Severe Drought\",\n                      \"D3\"= \"Extreme Drought\",\n                      \"D4\"=\"Exceptional Drought\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nDataExplorer::profile_missing(drought)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndrought_short <- drought %>%\n  dplyr::select(-map_date,-stat_fmt) %>%\n  filter(!drought_lvl==\"None\",!area_pct==0)\n\ndrought_short\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(raster)\nlibrary(spData)\nlibrary(spDataLarge)\n\nlibrary(maps)\nlibrary(viridis)\nlibrary(ggthemes)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nus_county_map <- map_data(\"county\")\n\ncounty_plot<-ggplot()+\n  geom_polygon(data=us_county_map,aes(x=long,y=lat,group = group),\n               fill=NA,color = \"lightblue\") +\n  theme_map()\n\ncounty_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_states <- drought_short%>%count(state_abb)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nus_state_map <- map_data(\"state\")\n\nstate_plot<-ggplot()+\n  geom_polygon(data=us_state_map,aes(x=long,y=lat,group = group),\n               fill=NA,color = \"lightblue\") +\n  theme_map()\n\nstate_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nus_plot<-ggplot()+\n  geom_polygon(data=us_county_map,aes(x=long,y=lat,group = group),\n               fill=NA,color = \"lightblue\") +\n   geom_polygon(data=us_state_map,aes(x=long,y=lat,group = group),\n               fill=NA,color = \"pink\") +\n  theme_map()\n\nus_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(zipcodeR)\nzipcodeR::download_zip_data()\n\ngeo_codes<- zipcodeR::search_state(drought_short$state_abb)%>%\n  dplyr::select(major_city,county,state,lat,lng,\n         population,population_density,\n         land_area_in_sqmi,water_area_in_sqmi,\n         housing_units,occupied_housing_units,\n         median_home_value,median_household_income) %>%\n  drop_na()\n\ngeo_codes\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_geo_codes_df<-geo_codes%>%\n  dplyr::select(state,lat,lng)\n  \n\ndrought_short_map <- drought_short %>%\n  arrange(valid_start)%>%\n  mutate(year=lubridate::year(valid_start),\n         month=lubridate::month(valid_start))%>%\n  filter(str_detect(valid_start,\"2021\")) %>%\n  #filter(month==c(1,2,3)) %>%\n  group_by(month,state_abb,drought_lvl) %>%\n  summarize(med_area_pct=round(median(area_pct),2))%>%\n  ungroup() %>%\n  filter(!med_area_pct==0) %>%\n  left_join(my_geo_codes_df,by=c(\"state_abb\"=\"state\")) %>%\n  mutate(month = month.name[month])\n  \ndrought_short_map\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(extrafont)\nloadfonts()\nfonts()\n\ndroughts_family <- \"Roboto Condensed\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndrought_plot <- ggplot() +\n  geom_point(data=subset(drought_short_map,lat>25&lat<50),\n                         aes(x=lng,y=lat,color=drought_lvl),\n             alpha=0.5,size=.4) +\n  geom_polygon(data=us_county_map,aes(x=long,y=lat,group = group),\n               fill=NA,color = \"lightblue\",size=0.2) +\n   geom_polygon(data=us_state_map,aes(x=long,y=lat,group = group),\n               fill=NA,color = \"pink\",size=0.4) +\n  facet_wrap(~factor(month, levels=c('January','February','March','April',\n                                     'May','June','July'))) +\n  labs(title=\"\",\n       subtitle=\"\",\n       caption=\"US Droughts map: available values by County\\n Jan to July 2021\",\n       #tag = \"Jan to July 2021\",\n       color=\"Level\") +\n  scale_color_viridis(labels = intensity_impacts,discrete = TRUE) +\n  guides(color = guide_legend(override.aes = list(size = 3))) +\n  ggthemes::theme_map() +\n  theme(legend.position = \"top\",\n        legend.title = element_text(family = droughts_family),\n        legend.text = element_text(size=8,family =droughts_family),\n        legend.background = element_blank(),\n        legend.box.background = element_blank(),\n        legend.key = element_blank(),\n        strip.background = element_blank(),\n        strip.text = element_text(family = droughts_family),\n        plot.title =element_text(size=15,face=\"bold\",family =droughts_family,color=\"black\"),\n        plot.subtitle =element_text(size=12,face=\"bold\",family =droughts_family),\n        plot.caption =element_text(size=9,family =droughts_family,hjust = 0),\n        #plot.tag = element_text(size=9,face=\"bold\",family =droughts_family,hjust = 0),\n        plot.caption.position = \"panel\",\n        plot.title.position = \"panel\")\n  \n\n\n# drought_plot \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidymodels)\ntidymodels_prefer()\n\n\ncooked_drought <- recipe(drought_lvl ~ med_area_pct+month + lat+lng +state_abb,drought_short_map) %>%\n  prep()%>%\n  bake(new_data=NULL)\n\ncooked_drought\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncooked_drought_plot <- cooked_drought%>%\n  group_by(drought_lvl,month) %>%\n  summarise(med_med_area_pct=median(med_area_pct)) %>%\n  mutate(month_f= case_when(month==\"January\"~1,\n                            month==\"February\"~2,\n                            month==\"March\"~3,\n                            month==\"April\"~4,\n                            month==\"May\"~5,\n                            month==\"June\"~6,\n                            month==\"July\"~7)) %>%\n\n  ggplot(aes(x=month_f,y=med_med_area_pct,fill=month)) +\n  geom_col()+\n  geom_text(aes(label=month),nudge_y = 1.5,size=1.5,family = droughts_family) +\n  geom_text(aes(label=med_med_area_pct),nudge_y = -1.5,size=1.5,color=\"white\") +\n  facet_wrap(~factor(drought_lvl,labels = intensity_impacts),\n             nrow = 1,ncol = 5,strip.position=\"bottom\",\n             scales = \"fixed\")+\n  scale_fill_viridis(discrete = TRUE) +\n  labs(y=\"\",\n       caption=\"Forecasted Droughts affected area pct median value by first 7 months of the year\")+\n  theme_void()+\n  theme(legend.position = \"none\",\n        plot.caption = element_text(family = droughts_family),\n        axis.text.x = element_blank(),\n        axis.ticks = element_blank(),\n        strip.placement = \"inside\",\n        strip.text = element_text(family = droughts_family,size=6),\n        plot.background = element_blank())\n\n\n  \n# cooked_drought_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cowplot)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ninset.plot <- cooked_drought_plot + theme(legend.position = \"none\")\n\ndouble_plot <- ggdraw() +\n  draw_plot(drought_plot,width = 1, height = 1) +\n  draw_plot(inset.plot, x = 0.39, y = .035, width = .55, height = .25)\n\n# double_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggpubr)\nlibrary(ggimage)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngraphics <- ggarrange(double_plot) \n\nannotation_plot <- annotate_figure(graphics,\n               top = text_grob(\"US droughts monitor condition outlook: \",color =c(\"#36648B\", \"#607B8B\", \"#668B8B\"), \n                               face = \"bold\", size = 30,family=droughts_family),\n               bottom = text_grob(\"DataViz: @fgazzelloni DataSource: \\n TidyTuesday week30, US Droughts,Drought Monitor,NYTimes & CNN\",\n                                  color = c(\"#36648B\", \"#607B8B\", \"#668B8B\"),family=droughts_family,\n                                  hjust = 0.5, x = 0.5, face = \"bold.italic\", size = 10),\n               left = text_grob(\"\", color = c(\"#778899\"), rot = 90,size=1),\n               right = text_grob(bquote(\"\"), color=c(\"#778899\"),rot = 90,size=1),\n               fig.lab = \"TidyTuesday week30\\n\", fig.lab.face = \"bold.italic\",fig.lab.size=7,\n               fig.lab.pos=\"bottom.right\"\n)\n\nfinal_plot <- annotation_plot +\n  annotate(geom = \"text\", label=\"map approximates drought-related impacts\",x = 0.7, y = 0.87, \n           colour = \"#BF3EFF\", size = 8,family=droughts_family) \n  \n\n# final_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimg <- png::readPNG('NDMC-logo-usdm-opt.png')\nimg1 <- png::readPNG('DOC-logo-usdm.png')\nimg2 <- png::readPNG('NOAA-logo-usdm.png')\nimg3 <- png::readPNG('USDA-logo-usdm-opt.png')\n```\n:::\n\n::: {.cell width='100'}\n\n```{.r .cell-code}\nfinal <- ggdraw() +\n  draw_image(img,  x = -0.45, y = 0.44, scale = .10) +\n  draw_image(img1,  x = -0.38, y = 0.44, scale = .10) +\n  draw_image(img2,  x = 0.33, y = 0.44, scale = .10) +\n  draw_image(img3,  x = 0.42, y = 0.44, scale = .10) +\n  draw_plot(final_plot)\n\n# final\n```\n:::\n\n\n\n\nSaving:\n\n::: {.cell}\n\n```{.r .cell-code}\nragg::agg_png(here::here(\"w30\", \"w30_drought.png\"),\n              res = 320, width = 14, height = 8, units = \"in\")\nfinal\n\ndev.off()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}