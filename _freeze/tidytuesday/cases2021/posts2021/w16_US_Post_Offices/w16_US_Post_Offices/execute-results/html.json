{
  "hash": "408c60f5a4b117550e1bec859c2767f0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"US Post Office\"\nsubtitle: \"Welcome to TidyTuesday 2021 week 16\"\ndate: \"2021-04-13\"\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/TidyTuesday/ab924a20bbe270bab306f4b13df0daaa6e53ffeb/data/2021/w16_US_Post_office/w16_US_Post_office.png'\ndescription: \"Networks\"\noutput: html_document\nexecute: \n  eval: false\n---\n\n\n\nLoading libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidytuesdayR)\nlibrary(tidyverse)\nlibrary(maptools)\nlibrary(data.table)\n```\n:::\n\n\n\nLoading data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2021, week = 16)\npost_offices <- tuesdata$post_offices\n```\n:::\n\n\n\nWrangling\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(post_offices)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_df<-post_offices%>%filter(established>=1639,established<=2000,\n                          discontinued>=1775 ,discontinued<=2002,\n                          !is.na(stamp_index),\n                          !duration<0,\n                          !is.na(gnis_dist),\n                          !stamp_index==55,\n                          !is.na(county1))%>%\n  select(\"duration\",\"gnis_dist\",\"stamp_index\")%>%\n  group_by(stamp_index)%>%\n  summarize(avg_duration=mean(duration),avg_dist=mean(gnis_dist))\n```\n:::\n\n\n\nSetting data ready for plotting\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(igraph)\nmat <- cor(t(my_df))\nmat[mat<0.995] <- 0\n# Make an Igraph object from this matrix:\nnetwork <- graph_from_adjacency_matrix( mat, weighted=T, mode=\"undirected\", diag=F)\n\n# Basic chart\nplot(network)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# color palette\nlibrary(RColorBrewer)\ncoul <- brewer.pal(nlevels(as.factor(my_df$stamp_index)), \"Set3\")\n\n# Map the color to cylinders\nmy_color <- coul[as.numeric(as.factor(my_df$stamp_index))]\n```\n:::\n\n\n\nSetting for saving plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nragg::agg_png(here::here(\"US_Post_office_space.png\"),\n              res = 320, width = 14, height = 8, units = \"in\")\n\n# plotting ############################################\n\npar(bg=\"mediumblue\", mar=c(1,1,1,1))\nset.seed(4)\nplot(network, \n     vertex.label.family=\"Georgia\", \n     edge.curved=0.08,\n     edge.width=2,                                 \n     edge.arrow.size=1,                       \n     edge.arrow.width=1,                          \n     edge.lty=\"solid\",\n     vertex.size=12,\n     vertex.shape=c(\"raster\",\"sphere\"), \n     vertex.color=my_color, \n     vertex.label.cex=0.7,\n     vertex.label.color=\"blue\",\n     vertex.frame.color=\"transparent\"\n)\n\nop <- par(family = \"Luminari\")\n\n#### legend and titles ########################\n\nlegend(x=1.3, y=0.7, \n       legend=paste( levels(as.factor(my_df$stamp_index)), \"stamp*\", sep=\"*\"), \n       col = coul , \n       bty = \"n\", pch=20 , pt.cex = 2, cex = 1,\n       text.col=\"white\" , horiz = F)\ntext(-1.4,1.1,\"US Post Offices\",col=\"white\", cex=1.5)\ntext(-1.3,1,\"Stamps index by distance\",col=\"white\", cex=1.2)\ntext(-1.1,0.9,\"visualization of the distance between offices by different stamps index\",col=\"white\", cex=0.8)\n\ntext(-1,-1.1,\"Viz @fgazzelloni | #TidyTueasday Week 16 | Space Day 14 | DataSource: Harvard Dataverse\",col=\"white\", cex=0.8)\npar(op)\n```\n:::\n\n\n\nImaging\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(png)\nlibrary(grid)\nlibrary(magick)\n\ntidy_logo<-image_read(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/static/plot_logo.png\") %>%\n  image_resize(\"400x400\")\n\nmypng2<-readPNG(\"satellite2.png\")\nmypng3<-readPNG(\"satellite3.png\")\n\n\ngrid.raster(tidy_logo, x=0.9, y=0.2, width=.08)\ngrid.raster(mypng2, x=.09, y=.7, width=.25)\ngrid.raster(mypng3, x=.9, y=.9, width=.25)\n\n####### final ###################\n\n# dev.off()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}