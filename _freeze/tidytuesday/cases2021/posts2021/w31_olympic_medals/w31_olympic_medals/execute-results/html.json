{
  "hash": "fb1e6bf710b55477c0b641907deff7ea",
  "result": {
    "markdown": "---\ntitle: \"Olympic Medals\"\nsubtitle: \"Welcome to TidyTuesday 2021 week 31\"\ndate: \"2021-07-27\"\nimage: \"w31_olympic_medals.png\"\nimage-alt: \"\"\ndescription: \"Networks\"\noutput: html_document\nexecute: \n  eval: false\n---\n\n\n35 Years of Olympic Games\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(countrycode)\nlibrary(ggflags)\nlibrary(ggthemes)\nlibrary(hrbrthemes)\n\n\noptions(scipen = 999)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2021, week = 31)\n\nolympics <- tuesdata$olympics\nregions <- tuesdata$regions\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#glimpse(olympics)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# View(olympics)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nDataExplorer::profile_missing(olympics)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(regions)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nDataExplorer::profile_missing(regions)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nregions%>%filter(is.na(region))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nregions <- regions%>%rename(noc=\"NOC\")\n\n\nmy_olympics <- olympics %>% \n  inner_join(regions,by=\"noc\") %>%\n  mutate(medal=replace_na(medal,\"Absent\")) %>%\n  filter(!is.na(region)) %>%\n  select(-notes,-name,-team,-event) %>% \n  drop_na() \n\n# DataExplorer::profile_missing(my_olympics)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nskimr::skim_to_list(my_olympics)\n```\n:::\n\n\n\n\nConverting \"region\" vector into country code \"iso2c\" with {countrycodes} to be able to use {ggflags}\n\nsome values were not matched unambiguously:  \n\n- Bolivia\n- Individual Olympic Athletes\n- Kosovo\n- Micronesia\n\n\nI could do a dataset with only \"Individual Olympic Athletes\" and eventually use it to add some info in a `geom_`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nIOA <- my_olympics %>% filter(region %in% \"Individual Olympic Athletes\" ) %>% count(sex)\n\nIOA\n```\n:::\n\n\nAfter a quick look at the \"ambiguous_country_codes\", just one is relevant with a \"Gold medal\", then will see how to use it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nambiguous_country_codes <- c(\"Boliva\",\"Kosovo\",\"Micronesia\")\n\nkos_gold <- my_olympics %>% filter(!region %in% \"Individual Olympic Athletes\",\n                                   region %in% ambiguous_country_codes, \n                                   medal==\"Gold\") \n\nkos_gold\n```\n:::\n\n\nUpdate \"my_olympics\" with `countrycode()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_olympics <- my_olympics %>%\n  filter(!region %in% \"Individual Olympic Athletes\",\n         !region %in% ambiguous_country_codes) \n```\n:::\n\n\n\n35 Years: 1896 to 2016\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_olympics%>%count(year)\n```\n:::\n\n\nAge: 11 to 71 (61 different ages)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_olympics %>% count(age)\n```\n:::\n\n\n## Section Age & Sex\n\n\n::: {.cell}\n\n```{.r .cell-code}\nage_sex_plot <- my_olympics %>% \n  group_by(sex) %>%\n  summarize(age,height,weight,year) %>% # count(age)\n  ungroup() %>% \n  ggplot(aes(x=factor(age),fill=factor(sex))) + \n  geom_bar(position=\"stack\") +\n  scale_fill_fivethirtyeight() +\n  labs(title=\"Distribution of age by sex\",\n       subtitle=\"61 different age years form 11 to 71 years old gamers\",\n       fill=\"Sex\") + \n  theme_fivethirtyeight() +\n  theme(axis.text.x = element_text(angle=20),\n        legend.position = \"bottom\",\n        plot.title = element_text(size=16,vjust=-0.5),\n        panel.grid.major.x = element_blank())\n\nage_sex_plot\n```\n:::\n\n\n\nComposition of plots and background\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(magick)\nlibrary(ggimage)\nlibrary(ggpubr)\nlibrary(cowplot)\nlibrary(extrafont)\nlibrary(showtext)\nfonts()\nolympics_family<-\"Roboto Condensed\"\n#library(ggflags)\nlibrary(countrycode)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nolympics_plot <- ggplot() +\n  geom_blank() + \n  theme_void() +\n  theme()\n\n\nimg_olympics<-\"olympics.png\"\n\nplot <- ggbackground(age_sex_plot, img_olympics,alpha=.4, color=\"#CD919E\")\n\n\nplot +\n  theme(plot.background = element_rect())#fill=\"#FFEFDB\"))\n```\n:::\n\n\nThen add a secon plot on the right corner\n\n\n## Section medals\n\n\"At the 1968 Summer Olympics in Mexico City, 29 events in swimming were contested. There was a total of 468 participants from 51 countries competing. The United States dominated the competition, winning 52 of 87 possible medals. 15-year-old phenom Debbie Meyer from Maryland won three gold medals.\"\n\nsource: [Swimming at the 1968 Summer Olympics](https://en.wikipedia.org/wiki/Swimming_at_the_1968_Summer_Olympics#:~:text=At%20the%201968%20Summer%20Olympics%20in%20Mexico%20City%2C%2029%20events,Maryland%20won%20three%20gold%20medals.)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_olympics_with_country_codes<- my_olympics%>%\n  mutate(country_code = countrycode(region, \n            origin = 'country.name', \n            destination = 'iso2c'),\n         country_code=tolower(country_code)) %>%\n  select(year,sport,medal,country_code) %>%\n  filter(medal==\"Gold\") %>%\n  count(year,sport,country_code) %>%\n  arrange(year) \n  \n\n\nmy_olympics_with_country_codes\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_favourites <- c(\"Athletics\",\"Wrestling\",\"Swimming\",\"Shooting\",\"Rowing\",\n                   \"Boxing\",\"Canoeing\",\"Cycling\")\n\n\nmy_favourite_sports <- my_olympics_with_country_codes%>%\n  filter(sport %in%my_favourites)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggflags)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_golden_sports <- ggplot(data=my_favourite_sports,\n       aes(x=factor(year),y=fct_reorder(sport,-year))) +\n  geom_point(shape = 21, colour = \"gold\", fill = NA, size = 7, stroke = 1) +\n  ggflags::geom_flag(aes(country=country_code), size=4.5) +\n  ggflags::scale_country() +\n  guides(country=\"none\") +\n  labs(title=\"Top 8 Gold medal sport winners\",\n       x=\"\",y=\"\") +\n  theme_fivethirtyeight()+\n  theme(axis.text.x = element_text(angle=90),\n        panel.grid.major.y = element_blank(),\n        panel.grid.major.x = element_line(color=\"#CD919E\"),\n        plot.title.position = \"plot\",\n        plot.background = element_blank(),\n        panel.background = element_blank())\n\n# top_golden_sports\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#png(\"top_golden_sports.png\")\nggsave(\"top_golden_sports.png\", width = 8, height = 6)\n\nprint(top_golden_sports)\ndev.off()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cowplot)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimg <- \"top_golden_sports.png\"\n\ninset.plot <- ggdraw() +\n  draw_image(img,  x = 0.22, y = -0.2,  scale = .70) \n\ninset.plot <- inset.plot + theme(legend.position = \"none\",\n                                    plot.background = element_blank(),\n                                    panel.background = element_blank())\ninset.plot2 <- age_sex_plot + theme(legend.position = \"none\",\n                                    plot.background = element_blank(),\n                                    panel.background = element_blank())\n\ndouble_plot <- ggdraw() +\n  draw_plot(inset.plot2, x = 0, y = 0, width = 1, height = 1) +\n  draw_plot(inset.plot, x = -0.35, y = .18, width = 1.5, height = 0.9) \n\n\ndouble_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimg_olympics<-\"olympics.png\"\nplot <- ggbackground(double_plot, img_olympics,alpha=.2, color=\"#CD919E\")\n\n\nplot +\n  theme(plot.background = element_rect(fill=\"#FFEFDB\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngraphics <- ggarrange(plot) \n\nannotation_plot <- annotate_figure(graphics,\n               top = text_grob(\"Olympics outlook 1896 - 2016  \",color =c(\"#FF4040\", \"#FFFFFF\", \"#FFFFFF\"), \n                               face = \"bold\", size = 40,family=olympics_family),\n               bottom = text_grob(\"DataViz: @fgazzelloni DataSource: \\n TidyTuesday week31, Olympic Medals, Kaggle, Financial Times & FiveThirtyEight\",\n                                  color = c(\"black\"),family=olympics_family,\n                                  hjust = 0.5, x = 0.5, face = \"bold.italic\", size = 10),\n               left = text_grob(\"\", color = c(\"#778899\"), rot = 90,size=1),\n               right = text_grob(bquote(\"\"), color=c(\"#778899\"),rot = 90,size=1),\n               fig.lab = \"TidyTuesday week31\\n\", fig.lab.face = \"bold.italic\",fig.lab.size=7,\n               fig.lab.pos=\"bottom.right\"\n)\n\nfinal_plot <- annotation_plot +\n  annotate(geom = \"text\", label=\"The historical dataset on the modern Olympic Games,\\n including all the Games from Athens 1896 to Rio 2016\",x = 0.7, y = 0.81, \n           colour = \"black\", size = 6,family=olympics_family) \n  \n\nfinal_plot\n```\n:::\n\n\nAttach the Olympic logo at the sides of the title\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimg_olympics<-\"olympics.png\"\n\nfinal <- ggdraw() +\n  draw_image(img_olympics,  x = -0.35, y = 0.45, scale = .10) +\n  draw_image(img_olympics,  x = 0.32, y = 0.45, scale = .10) +\n  draw_plot(final_plot)\n```\n:::\n\n\n\nSaving:\n\n::: {.cell}\n\n```{.r .cell-code}\nragg::agg_png(here::here(\"w31\", \"w31_olympics.png\"),\n              res = 320, width = 14, height = 8, units = \"in\")\nfinal\n\ndev.off()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}