{
  "hash": "e5fb0854354278c4068a1f4d7d93bd47",
  "result": {
    "markdown": "---\ntitle: 'Global Seafood'\nsubtitle: 'Welcome to TidyTuesday 2021 week 42'\ndate: '2021-10-12'\nimage: 'w42_seafood.png'\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n\n# WEEK42 SEAFOOD\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load library and data\nlibrary(tidyverse)\n\nfarmed <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-12/aquaculture-farmed-fish-production.csv')\ncaptured_vs_farmed <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-12/capture-fisheries-vs-aquaculture.csv')\ncaptured <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-12/capture-fishery-production.csv')\nconsumption <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-12/fish-and-seafood-consumption-per-capita.csv')\nstock <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-12/fish-stocks-within-sustainable-levels.csv')\nfishery <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-12/global-fishery-catch-by-sector.csv')\nproduction <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-12/seafood-and-fish-production-thousand-tonnes.csv')\n\n# make one dataframe \ndf <- farmed %>%\n  full_join(captured_vs_farmed,by=c(\"Entity\",\"Code\",\"Year\",\"Aquaculture production (metric tons)\")) %>%\n  full_join(captured,by=c(\"Entity\",\"Code\",\"Year\",\"Capture fisheries production (metric tons)\")) %>%\n  full_join(consumption,by=c(\"Entity\",\"Code\",\"Year\")) %>%\n  full_join(stock,by=c(\"Entity\",\"Code\",\"Year\")) %>%\n  full_join(fishery,by=c(\"Entity\",\"Code\",\"Year\")) %>%\n  full_join(production,by=c(\"Entity\",\"Code\",\"Year\")) %>%\n  janitor::clean_names()\n\nnames(df);dim(df)\nDataExplorer::profile_missing(df)\n\n\n# set the dataset for the first plot \ndf_group1 <- df %>%\n  filter(is.na(code)) %>%\n  select(-code) %>%\n  filter(str_detect(entity,\"income\")) %>%\n  pivot_longer(cols = 3:19,names_to = \"names\",values_to = \"values\") %>%\n  mutate(values = ifelse(is.na(values),0,values)) %>%\n  filter(values > 0) %>% \n  mutate(entity = gsub(\"excluding high income\",\"*\",entity)) %>% #count(entity)\n  mutate(entity = factor(entity, levels = c('High income','Upper middle income','Middle income',\n                                          'Lower middle income','Low & middle income','Low income',\n                                          'Europe & Central Asia (*)','Latin America & Caribbean (*)',\n                                          'East Asia & Pacific (*)','Middle East & North Africa (*)','Sub-Saharan Africa (*)'))) \n\n\n# choose the color palette  \n# RColorBrewer::brewer.pal.info\n# set the text options \nlibrary(showtext)\nshowtext_opts(dpi = 320)\nshowtext_auto(enable = T)\nfont_add_google(\"Share Tech Mono\", \"techmono\")\n   \n\n# make the first plot: a facet_plot of the World Continents by income level\nfacet_plot <-  ggplot(data = df_group1, aes(x = factor(year), y = values/100000000,group = names,color = names)) +\n  geom_line(size = 1.3) +\n  guides(color = guide_legend(title = \"Production tons sc-%\",ncol = 1,title.position = \"top\", title.hjust = 0.5)) +\n  scale_x_discrete(breaks = seq(1960,2018,10)) +\n  scale_y_continuous(labels = scales::percent) +\n  scale_color_manual(limits = c(\"aquaculture_production_metric_tons\",\"capture_fisheries_production_metric_tons\"),\n                     labels = c(\"aquaculture_production_metric_tons\" = \"Aquaculture\",\n                                \"capture_fisheries_production_metric_tons\" = \"Capture Fisheries\"),\n                     values = RColorBrewer::brewer.pal(2,\"Reds\")) +\n  facet_wrap(vars(entity),scales = \"free\",nrow = 2) +\n  labs(subtitle = \" \", caption = \" \") +\n  ggthemes::theme_fivethirtyeight() +\n  theme(text = element_text(family = \"techmono\",color = \"#FFF8DC\",face = \"bold\"),\n        legend.position = c(0.92,0.3),\n        legend.title = element_text(face = \"bold\",size = 14),\n        legend.box.background = element_blank(),\n        legend.background = element_rect(fill = \"#009ACD\",color = \"#009ACD\"),\n        legend.key = element_rect(fill = \"#009ACD\",color = \"#009ACD\"),\n        legend.text = element_text(size = 9),\n        strip.text = element_text(size = 9,face = \"bold\"),\n        strip.background = element_rect(fill = \"#009ACD\",color = \"#009ACD\"),\n        panel.grid.major = element_blank(),\n        panel.grid.minor = element_line(size = 0.2),\n        plot.background = element_rect(fill = \"#009ACD\",color = \"#009ACD\"),\n        panel.background = element_rect(fill = \"#009ACD\",color = \"#009ACD\"),\n        plot.title = element_text(face = \"bold\",size = 30),\n        plot.margin = margin(0,0,0,0,unit = \"pt\")) \n\n\n\n#-------------\n# seafood supply time-series plot of all countries and selected countries of seafood supply kg per capita FAO yr 2020\n\n\n# data to use in the second plot for the first geom_line for all countries (in grey)\ndf_group2 <- df %>% \n  filter(!is.na(code)) %>%\n  pivot_longer(cols = 14:20,names_to = \"livestock\",values_to = \"livestock_commodity\") %>%\n  select(-4,-5) %>%\n  mutate(livestock = gsub(\"commodity_balances_livestock_and_fish_primary_equivalent_\",\"\",livestock),\n         livestock = gsub(\"_production_5510_tonnes\",\"\",livestock),\n         livestock = gsub(\"[0-9]\",\"\",livestock),\n         livestock = gsub(\"_\",\"\",livestock)) %>%\n  pivot_longer(cols = 5:6,names_to = \"share_of_fish\",values_to = \"fish_stocks\") %>%\n  mutate(share_of_fish = recode(share_of_fish,\n                                share_of_fish_stocks_that_are_overexploited = \"overexploited\",\n                                share_of_fish_stocks_within_biologically_sustainable_levels_fao_2020 = \"sustainable\")) %>%\n  pivot_longer(cols = c(5,7),names_to = \"commercial\",values_to = \"scale_commercial\") %>%\n  mutate(commercial = recode(commercial,\n                             artisanal_small_scale_commercial = \"artisanal\",\n                             industrial_large_scale_commercial = \"industrial\")) %>%\n  rename(seafood_supply = fish_seafood_food_supply_quantity_kg_capita_yr_fao_2020)\n\n\ndf_group2[is.na(df_group2)] <- 0\n\ndf_group2 <- df_group2 %>% \n  filter(seafood_supply > 0) %>% \n  select(year,entity,seafood_supply)\n\n\n\n# data to use in the second geom_line for selected countries\ndf_group3 <- df_group2 %>%\n  filter(entity %in% c(\"Iceland\",\"Maldives\",\"Lesotho\",\"Brazil\",'Sri Lanka',\"Malaysia\",\"Chile\",\"Tanzania\",\"Japan\")) \n\n\n\n# make the second plot: time series of all countries and selected countries of seafood supply kg per capita FAO yr 2020\n seafood_plot <- ggplot() +\n  geom_line(data = df_group2, \n            aes(x = factor(year),y = (seafood_supply),group = entity),color = \"grey75\",size = 0.2) +\n  geom_line(data = df_group3 ,\n            aes(x = factor(year),y = (seafood_supply),group = entity,color = entity),size = 1.2,\n            key_glyph = \"timeseries\") +\n  scale_x_discrete(breaks = seq(1960,2018,5), expand = expansion(add = 0.5)) +\n  scale_y_log10(labels = scales::comma_format()) +\n  scale_color_manual(values = RColorBrewer::brewer.pal(9,\"Set1\")) +\n  guides(color = guide_legend(title = \"Selected Countries seafood production kg per capita FAO yr 2020\",\n                              nrow = 1,title.position = \"top\", title.hjust = 0.5,title.vjust = 0.5)) +\n  labs(x = \"Years\",y = \"Values in log scale\",\n       title = \" \",\n       subtitle = \" \") +\n  ggthemes::theme_fivethirtyeight() +\n  theme(text = element_text(family = \"techmono\",color = \"#FFF8DC\",face = \"bold\"),\n        axis.title.x = element_text(vjust = 0.5,face = \"bold\"),\n        axis.title.y = element_text(vjust = 0.5,face = \"bold\"),\n        plot.background = element_rect(fill = \"#009ACD\",color = \"#009ACD\"),\n        panel.background = element_rect(fill = \"#009ACD\",color = \"#009ACD\"),\n        panel.grid.major.x = element_line(size = 0.2,linetype = \"dashed\"),\n        legend.background = element_blank(),\n        legend.text = element_text(size = 14),\n        legend.position = \"top\",\n        legend.title = element_text(face = \"bold\",size = 16),\n        legend.key = element_blank(),\n        plot.title = element_text(face = \"bold\",size = 30),\n        plot.margin = margin(0,0,0,0,unit = \"pt\"))\n\n\n# make one plot\nlibrary(patchwork)  \nplot <- (seafood_plot / facet_plot ) \n  #theme_update(plot.background = element_rect(fill=\"#009ACD\",color=\"#009ACD\"),\n               #panel.background = element_rect(fill=\"#009ACD\",color=\"#009ACD\"),\n               #plot.margin = margin(0,0,0,0,unit = \"pt\"))\n\n\n# load the libraries for final touches\nrequire(ggpubr)\n\n# ggarrange from {ggpubr} frames the plot to make side annotations\ngraphics <- ggpubr::ggarrange(plot) \n\nfinal_plot <- ggpubr::annotate_figure(graphics,\n                              top = text_grob(\"Global Seafood Supply in 182 countries \\n(1960 - 2018)\",\n                                              color = c(\"#FFF8DC\"), face = \"bold\", size = 34,\n                                              family = \"techmono\",vjust = 0.8),\n                              bottom = text_grob(\"Infographics Federica Gazzelloni DataSource: OurWorldinData.org - TidyTuesday week42\",\n                                                 color = \"#FFF8DC\",family = \"techmono\",\n                                                 hjust = 0.5, vjust = 0.5, x = 0.5, face = \"bold.italic\", size = 14),\n                              left = text_grob(\" \", color = c(\"#778899\"), rot = 90,size = 12),\n                              right = text_grob(bquote(\" \"), color = c(\"#778899\"),rot = 90,size = 10),\n                              fig.lab = \"\", fig.lab.face = \"bold.italic\",fig.lab.size = 8,\n                              fig.lab.pos = \"bottom.right\"\n)\n\nfinal_plot <- final_plot +\n  annotate(geom = \"text\", label = \"(*) excluding high income\",\n         x = 0.91, y = 0.1,colour = \"#FFF8DC\",size = 4,family = \"techmono\",fontface = \"bold\") \n  \n  \nlibrary(cowplot)  \nlibrary(ggimage)\nlibrary(magick)\n\n# add the images for the legend keys \n\nimgOWD <- image_read(here::here(\"w42/owd.png\"))\nimgfish <- image_read(here::here(\"w42/fish.png\"))\nimgtt <- image_read(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/static/plot_logo.png\") %>%\n  image_resize(\"300x300\")\n\n\n# ggdraw from {cowplot} draw the plot for setting the background colors of the side annotations\nfinal <- cowplot::ggdraw(final_plot) + \n  draw_image(imgfish, x = 0.03, y = 0.44,width = 0.07) +\n  draw_image(imgfish, x = 0.08, y = 0.37,width = 0.05) +\n  draw_image(imgfish, x = 0.12, y = 0.32,width = 0.03) +\n  draw_image(imgtt, x = 0.85, y = 0.45,width = 0.12) +\n  draw_image(imgOWD, x = 0.9, y = -0.46,width = 0.06) +\n  theme(plot.background = element_rect(fill = \"#009ACD\",color = \"#009ACD\")) \n\n\n# save final plot\nragg::agg_png(here::here(\"/Users/federica/Documents/R/R_general_resourses/TidyTuesday/TidyTuesday/w42/w42_seafood.png\"),\n              res = 320, width = 16, height = 14, units = \"in\")\nfinal\ndev.off()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}