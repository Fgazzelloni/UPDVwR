{
  "hash": "626920ae1216291649d417008a10c913",
  "result": {
    "markdown": "---\ntitle: \"Bea Infrastructure Investment\"\nsubtitle: \"Welcome to TidyTuesday 2021 week 33\"\ndate: \"2021-08-10\"\nimage: \"w33_bea_Infrastructure_Investment.png\"\nimage-alt: \"\"\ndescription: \"Networks\"\noutput: html_document\nexecute: \n  eval: false\n---\n\n\n\n# BEA Infrastructure Investment\n\n\n\n**Introduction**\n\n\nThe measurement of infrastructure in the U.S. National Economic Accounts (NEAs) considers different metrics, provided are the resources devoted to different types of infrastructure each year and a useful overview of trends.\n\nClassification of investment categories is provided by North American Industry Classification System ([NAICS](https://www.census.gov/naics/))\n\n\n----------------------------\n\n\nTypes of infrastructure:\n\n- Basic: transportation and utilities\n- Social: pubblic safety, education and health\n- Digital: it excludes servers owned by private firms outside of NAICS 518 and 519\n\nthe analysis spans through **70 Years** of investments from 1947 to 2017.\n\n\n\n\n\n\n\n## Data\n\nThis analysis starts with analysing the classification of the investment categories by looking at:\n\n### Original data\n\nThe original [datasets](https://www.bea.gov/system/files/2021-01/infrastructure-data-may-2020.xlsx) provided by the website are very useful to check whether the **category** and the **meta category** variables are homogeneous within the data sets:\n\n\n1 - **Investment** data set:\n\n*Investment* data set is extracted from the original .xlsx file and shows the basic structure of the group categories on which the analysis is based.\n\n\n\n::: {.cell hash='w33_bea_Infrastructure_Investment_cache/html/unnamed-chunk-2_60ffb046ab451e57bf01876978563f5a'}\n\n```{.r .cell-code}\ndf_inv_raw <- readxl::read_excel(\"infrastructure-data-may-2020.xlsx\", sheet = \"cu$inv\",skip = 2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_inv_raw <- df_inv_raw %>% \n  rename(group = ...1, category = ...2) %>% \n  filter(!is.na(category)) %>% \n  mutate(\n    meta_cat = if_else(!is.na(group), category, NA_character_), \n    group_num = group,\n    .after = \"category\"\n    ) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nDT::datatable(df_inv_raw %>% select(meta_cat,group,category))\n```\n:::\n\n\n\n\n\nIn addtion it contains the *gross investment* variable which is the variable that will be used in the analysis as one of the factors to construct the *Implicit Price Deflators* index.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(investment)\n```\n:::\n\n\n\n2 - **Chain investment** data set:\n\nIt is extracted as the same as the *investment* set and it contains the same group of category variables except for one element in the category which is missing, it will be shown in more details further below in the analysis. \n\nIt doesn't contains the *gross investment* variable but it the *gross investment chain* instead.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(chain_investment)\n```\n:::\n\n\n\n3 - **IPD: Implicit Price Deflators** data set:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDT::datatable(df_IPD_inv_raw %>% select(meta_cat,group,category))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nipd <- df_IPD_inv_raw %>%\n  fill(meta_cat, group_num) %>%\n  pivot_longer(names_to = \"year\", values_to = \"gross_inv_ipd\", cols = `1947`:`2017`,\n               names_transform = list(year = as.integer)) %>% \n  filter(is.na(group)) %>% \n  select(-group) \n```\n:::\n\n\n\n\n\nIPD set contains one more meta category as well as one more group number for the GDP element of the vector, which corresponds to group category number 0.\n\nIn fact the script for the IPD variable changes slightly with the addition of one more line of code.\n\nIt also contains the *gross investment ipd* variables whixh is the object of this study.\n\n::: {.cell}\n\n```{.r .cell-code}\n ipd <- ipd %>%\n  mutate(meta_cat = if_else(category == \"GDP\", \"GDP\", meta_cat)) \n\nnames(ipd)\n```\n:::\n\n\n\n### TidyTuesday data\n\nData can also be loaded via:\n\n::: {.cell hash='w33_bea_Infrastructure_Investment_cache/html/unnamed-chunk-13_95926d9fc63fc98e94396697ca98e4a7'}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2021, week = 33)\ntidytuesdayR::readme(tuesdata)\n```\n:::\n\n\n\n\n-----------------------------\n\n\n## Meta Categories and sub-groups\n\nThe original data sets are very useful to check whether the investments classified within their categories are homogeneous within the other data sets.\n\nThe analysis starts with checking of the three data sets, to see what are the common categories and if there are any differences. Next step would be to unify the three data sets to make a model for the **Implicit Price Deflators**.\n\n\n\n------------------\n\n\nThe first data set **Investment** is the one used for understanding the composition of the variables. The other two are quite similar except for the *investment* variable, and two other differences in group category.\n\nLet's start having a look at any missing values:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninvestment <- tuesdata$investment\nDataExplorer::profile_missing(investment)\n```\n:::\n\n\nNo values are missing in *investment* which is made of 5 variables:\n\n- **category**: Category of investment (60 categories)\n- **meta_cat**:\tGroup category of investment (16 meta categories)\n- **group_num**: Group number of investment (1 to 20 number of sub-group of investment category)\n- **year**:\tYear of investment (from 1947 to 2017)\n- **gross_inv**: Gross investment in millions of USD (which ranges from -194 to 500 900 millions $)\n\n\nThe `meta_cat` vector is the *Group category of investment*, and it has a sub-group numeric version named `group_num`, and a sub-sub-group of more specific categories of investments named: `category`. \n\nThe last variable is `gross_inv` i.e. **Gross investment** which is the sum of gross private domestic investment, government gross investment, and balance on current account, national income and product accounts.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDT::datatable(head(investment,3))\n```\n:::\n\n\n--------------------\n\n\n### Group category of investment\n\n16 `meta_cat`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDT::datatable(investment%>%count(meta_cat))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ninvestment <- investment %>%\n  mutate(meta_cat = case_when(meta_cat==\"Total basic infrastructure\" ~ \"Basic\",\n                              TRUE~meta_cat ))\n```\n:::\n\n\n\n---------------------\n\n\n\n### Group number of investment\n\n20 sub-group of the `meta_cat` corresponding to `group_num`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDT::datatable(investment %>% count(group_num))\n```\n:::\n\n\n\n---------------------\n\n\n\n### Category of investment\n\n60 sub-sub-group `category` vector:\n\n::: {.cell}\n\n```{.r .cell-code}\nDT::datatable(investment %>% count(category))\n```\n:::\n\n\n\nThe list of `category` contains a specification of the classification method for some of the elements in the vector, such as:\n\n- Private communications equipment in NAICS 515, 517, 518, and 519 \n- Private computers in NAICS 515, 517, 518, and 519\n- Office buildings, NAICS 518 and 519\n- Private software in NAICS 515, 517, 518, and 519\n\nThese elements are part of the **Digital** meta category of investment and the numbers at the ends are to specify that they are classified by the NAICS and only those classified in North America are accepted within the list of digital investments. So, other form of digital investments are not considered in this study.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninvestment <- investment %>%\n  mutate(category = case_when(\n    category==\"Private communications equipment in NAICS 515, 517, 518, and 519\"~\"Private communications equipment\",\n    category==\"Private computers in NAICS 515, 517, 518, and 519\"~\"Private computers\",\n    category==\"Office buildings, NAICS 518 and 519\"~\"Office buildings\",\n    category==\"Private software in NAICS 515, 517, 518, and 519\"~\"Private software\",\n    TRUE~category)) \n```\n:::\n\n\n\n### Exploratory analysis - Investment\n\nExploratory analysis on *Gross investments* shows an increase in investments in the private sector as the most flourishing category within the last 70 years, followed by basic, S&L and social investments in infrastructures. Digital infrastructure and transports are still below 200 000 millions $.\nTo be noted is that the private category for gross investment is still divided by amount of investments, but as a whole it releases the stronger increase over time.\n\n\n\n\n\n::: {.cell layout-align=\"center\" height='100%' width='100%'}\n\n```{.r .cell-code}\nplot1\n```\n:::\n\n\nA second visualization of the *gross investment* shows the category with the highest level of *gross investment* within the last 70 years in millions $.\n\n\n\n\n\n::: {.cell layout-align=\"center\" height='100%' width='100%'}\n\n```{.r .cell-code}\nplot2\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\" height='100%' width='100%'}\n\n```{.r .cell-code}\nplot3\n```\n:::\n\n\n\n---------------------\n\n\n\nBefore continuing with other visualizations of investment trends, let's check the other data sets to see the differences and then decide if to make a unified dataframe to use for comparison of gross investments, chained investments with implicit price deflactors (IPDs).\n\nThe first 4 variables are in common within all datasets, the next step is to check whether there are differences within the first 4 variables.\n\nThe second set doesn't contains differences in classification when compared with investment set.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchain_investment <- tuesdata$chain_investment\nDataExplorer::profile_missing(chain_investment)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nchain_investment <- chain_investment%>% \n  mutate(meta_cat = case_when(meta_cat==\"Total basic infrastructure\" ~ \"Basic\",\n                              TRUE~meta_cat ))\n```\n:::\n\n\n\n\n59 chain investment categories:\n\n::: {.cell}\n\n```{.r .cell-code}\nchain_investment <- chain_investment %>% \n  mutate(category=case_when(category==\"Private communications equipment in NAICS 515, 517, 518, and 519\"~\"Private communications equipment\",\n                            category==\"Private computers in NAICS 515, 517, 518, and 519\"~\"Private computers\",\n                            category==\"Office buildings, NAICS 518 and 519\"~\"Office buildings\",\n                            category==\"Private software in NAICS 515, 517, 518, and 519\"~\"Private software\",\n         TRUE~category)) \n```\n:::\n\n\n\"Office buildings\" is the only category in \"investment\" df which doesn't appear in \"chain_investment\" df.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncat <- chain_investment %>% count(category) %>% select(-n) %>% unlist()\ninvestment %>% filter(!category %in% cat) %>% \n  count(category)\n```\n:::\n\n\n\n\n\n-----------------------------\n\nImplicit Price Deflators (IPDs). \nAn implicit price deflator is the ratio of the current-dollar value of a series, such as gross domestic product (GDP), to its corresponding chained-dollar value, multiplied by 100.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nipd <- tuesdata$ipd\nDataExplorer::profile_missing(ipd)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmeta_inv <- investment%>%count(meta_cat)%>%select(-n)%>%unlist()\nipd%>%filter(!meta_cat%in%meta_inv)%>%count(meta_cat)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nipd <- ipd%>%\n  mutate(meta_cat = case_when(meta_cat==\"Total basic infrastructure\" ~ \"Basic\",\n                              meta_cat==\"Infrastructure\"~\"Total infrastructure\",\n                              meta_cat==\"Health care\"~\"Health\",\n                                TRUE~meta_cat ))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nipd <- ipd %>%\n  mutate(category=case_when(category==\"Private communications equipment in NAICS 515, 517, 518, and 519\"~\"Private communications equipment\",\n                            category==\"Private computers in NAICS 515, 517, 518, and 519\"~\"Private computers\",\n                            category==\"Office buildings, NAICS 518 and 519\"~\"Office buildings\",\n                            category==\"Private software in NAICS 515, 517, 518, and 519\"~\"Private software\",\n         TRUE~category)) \n```\n:::\n\n\n\n60 categories are in the \"Implicit Price Deflators\" df\n\n\n::: {.cell}\n\n```{.r .cell-code}\nipd_cats <-ipd %>% count(category)%>%unlist()\n```\n:::\n\n\ncomparing it with the \"investment\" and \"chain investment\" categories, 6 of those have a slightly different name, the best wat to handle this for obtaining a unified data set made of the three sets is to have homogeneous values for the category variable.\n\n\nThese are the 6 categories in *ipd* to be changed:\n\n::: {.cell}\n\n```{.r .cell-code}\ncat_investment <- investment%>%count(category)%>%select(-n)%>%unlist()\nipd_cats_to_be_renamed <- ipd%>%filter(!category%in%cat_investment)%>%count(category)%>%select(-n)%>%unlist()\n\nipd_cats_to_be_renamed\n```\n:::\n\n\n\n\nThese 6 categories are in the *investment* data set and we want to use these names for the category variable for all the sets:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nselected_categories <- investment %>% filter(!category %in% ipd_cats) %>% count(category,group_num) %>% arrange(group_num)\n\nselected_categories\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nipd <- ipd %>% \n  mutate(category = case_when(\n    category == \"Basic\" ~ \"Total basic infrastructure\",\n    category == \"Social\" ~ \"Total social infrastructure\",\n    category == \"Digital\" ~ \"Total digital infrastructure\",\n    category == \"Health care\" ~ \"Health\",\n    category == \"Communications structures\" ~ \"Private communications structures\",\n    TRUE ~ category\n  ))\n```\n:::\n\n\n\n\nLet's see how `meta_cat` of these 6 categories perform:\n\n\n\n::: {.cell layout-align=\"center\" height='100%' width='100%'}\n\n```{.r .cell-code}\nplot4\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntotal_inv_df <- ipd %>% \n  count(category,meta_cat,year,gross_inv_ipd) %>% \n  group_by(year,meta_cat) %>%\n  summarize(total=ifelse(!is.na(round(sum(gross_inv_ipd))),round(sum(gross_inv_ipd)), 0)) %>%\n  ungroup() %>%\n  filter(!total==0) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(extrafont)\nlibrary(showtext)\nshowtext_auto()\nshowtext_opts(dpi = 320)\nfont_add_google(\"Roboto Condensed\", \"roboto condensed\")\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\" height='100%' width='100%'}\n\n```{.r .cell-code}\nplot5\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\nlibrary(ggpubr)\nlibrary(cowplot)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimg <- png::readPNG('images.png')\n\n \n\ngraphics <- ggarrange(plot5) \n\nfinal_plot <- annotate_figure(graphics,\n               top = text_grob(\"IPDs Group investment categories\\n\", \n                               color = c(\"#FFD700\"), face = \"bold\", size = 34,\n                               family=\"roboto condensed\"),\n               bottom = text_grob(\"BEA: measurement of infrastructure in the U.S. National Economic Accounts (NEAs)\\nInfographic: @fgazzelloni\\n DataSource: TidyTuesday Week33: BEA Infrastructure Investment\",\n                                  color = \"#6C7B8B\",family=\"roboto condensed\",\n                                  hjust = 0.5, x = 0.5, face = \"bold.italic\", size = 10),\n               left = text_grob(\"\", color = c(\"#778899\"), rot = 90,size=10),\n               right = text_grob(bquote(\"\"), color=c(\"#778899\"),rot = 90,size=10),\n               fig.lab = \"TidyTuesday week33\", fig.lab.face = \"bold.italic\",fig.lab.size=8,\n               fig.lab.pos=\"bottom.right\"\n)\n\nfinal_plot <- final_plot +\n  annotate(geom = \"text\", label=\"values of the implicit price deflator ratio\",x = 0.25, y = 0.92, \n           colour = \"black\", face=\"bold\",size = 7,family=\"roboto condensed\") +\n  annotate(geom = \"text\", label=\"Digital just started in 1978 and followed \\nwith a deep decline during the last 40 years\",x = 0.70, y = 0.68, colour = \"#FF7F00\", size = 5,family=\"roboto condensed\") \n\n  \n\nfinal <- ggdraw() +\n  draw_image(img,  x = -0.4, y = -0.48, scale = .15) +\n  draw_plot(final_plot)\n\nfinal\n showtext.auto(enable = FALSE) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nragg::agg_png(\"w33_bea2.png\",\n              res = 320, width = 14, height = 8, units = \"in\")\nfinal\n\ndev.off()\n```\n:::\n\n\n\n\n\n\nInvestment on\tElectric power only appear starting from 1993 with a ratio of 336:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlist<-total_inv_df %>% filter(year==1992)%>%count(meta_cat)%>%select(-n)%>%unlist()\ntotal_inv_df %>% filter(year==1993,!meta_cat%in%list)\n```\n:::\n\n\n\nmeta_cat are the Group category of investment, there are 4 values which are different within the sets:\n\n- Health care = Health\n- Infrastructure = Total infrastructure\n- Basic = Total basic infrastructure\n- GDP \n\nWe need to add GDP as further meta_cat for both investment and chain_investment sets, and chenge the other three values into common values as shown above.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninv_meta_cats <- investment %>% count(meta_cat) %>% select(-n) %>% unlist()\n\nipd %>% filter(!meta_cat %in% inv_meta_cats) %>% count(meta_cat)\n```\n:::\n\n\n\n\nGDP is the only left meta_cat category, that it is not present in the other sets.\n\n::: {.cell}\n\n```{.r .cell-code}\nipd %>% filter(!meta_cat %in% inv_meta_cats) %>% count(meta_cat)\n```\n:::\n\n\nWhat about category variable?\nWhat are the differences in ipd set when compared with the other two?\n\nAs seen investment and chain_investment sets have the same category variables except for one variable which is \"Office buildings\", so next step is to find the differences of this vector in ipd set:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncat_inv <- investment %>% count (category) %>% select(-n) %>% unlist\nipd %>% filter(!category %in% cat_inv) %>% count(category)\n```\n:::\n\n\nwe need to convert these values in ipd set:\n\n- Basic = Total basic infrastructure\n- Communications structures = Private communications structures\n- Digital = Total digital infrastructure\n- GDP \n- Health care = Health\n- Social = Total social infrastructure\n\n\n\nFinally, GDP is the category group number 0 which is not in investment and chain investment sets, but only in IPD. While \"Office buildings\" is only in investment.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nipd <- ipd %>% \n  mutate(category = case_when(\n    category==\"Basic\"~\"Total basic infrastructure\",\n    category==\"Communications structures\"~\"Private communications structures\",\n    category==\"Digital\"~\"Total digital infrastructure\",\n    category==\"Health care\"~\"Health\",\n    category==\"Social\"~\"Total social infrastructure\",\n    TRUE~category))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nipd %>% filter(!category %in% cat_inv) %>% count(category)\n```\n:::\n\n\n\nThe new data sets will contain the 4 common variables plus these other three:\n\n- gross_inv:\tGross investment in millions of USD\n- gross_inv_chain:\tGross investment (chained 2021 dollars) in millions of USD\n- gross_inv_ipd: Implicit Price Deflators (IPDs)\n\n\nThe Implicit Price Deflators (IPDs) is obtained as an index result of: \n\n    [ (gross_inv *100) / (gross_inv_chain *100) ] *100\n    \n    \nThe ipd set contains some missing values, these values are the results of 0 investments for some of the selected categories within the years.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nipd %>% filter(is.na(gross_inv_ipd)) %>% count(meta_cat,category)\n```\n:::\n\n\nLet's calculate the **gross_inv_ipd** vector with the formula, assigning its value to a different name vector and then check the missing values. \nTo do this we need to join the three sets together:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninvestment_full <- investment%>%\n  full_join(chain_investment,by=c(\"category\",\"meta_cat\",\"group_num\",\"year\")) %>%\n  full_join(ipd,by=c(\"category\",\"meta_cat\",\"group_num\",\"year\")) %>%\n  #filter(meta_cat==\"GDP\"| category==\"Office buildings\") %>% \n  mutate(gross_inv_chain = if_else(category==\"Office buildings\",0,gross_inv_chain),\n         gross_inv_ipd = if_else(gross_inv<=0,0,gross_inv_ipd),\n         gross_inv_ipd2 = if_else(gross_inv_chain==0,0,((gross_inv/100)/(gross_inv_chain/100))*100),\n         gross_inv_ipd2 = round(gross_inv_ipd2,2))\n  #DataExplorer::profile_missing()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}