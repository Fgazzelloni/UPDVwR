{
  "hash": "f59067ce6d3c8a7d4d8db77d52c2c5f6",
  "result": {
    "markdown": "---\ntitle: \"The Pudding\"\nsubtitle: \"Welcome to TidyTuesday 2021 week 14\"\nauthor: \"Federica Gazzelloni\"\ndate: \"2021-03-30\"\nimage: \"w14_the_pudding.png\"\nimage-alt: \"\"\ndescription: \"Connections\"\noutput: html_document\nexecute: \n  eval: false\n---\n\n\n\n\n\nLoad libraries\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidytuesdayR)\nlibrary(tidyverse)\nlibrary(showtext)\nlibrary(ggtext)\nlibrary(scales)\nlibrary(extrafont)\nlibrary(patchwork)\nlibrary(cowplot)\nlibrary(ragg)\nlibrary(rmarkdown)\nlibrary(hrbrthemes)\nlibrary(wesanderson)\n```\n:::\n\n\n\nLoad Datasets\n\n::: {.cell}\n\n```{.r .cell-code}\nsephora <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-30/sephora.csv')\nulta <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-30/ulta.csv')\n\nallCategories <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-30/allCategories.csv')\nallShades <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-30/allShades.csv')\nallNumbers <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-30/allNumbers.csv')\n```\n:::\n\n\nLoad fonts\n\n::: {.cell}\n\n```{.r .cell-code}\nloadfonts()\nfont_add_google(name = \"Amatic SC\", family = \"amatic-sc\")\nfont_add_google(\"Cedarville Cursive\", \"cedarville\")\n\nshowtext_auto(enable = TRUE)\n\npalette <- c(\"#FF0000\",\"#FF7070\",\"#F09200\",\"#FFBF1F\",\"#00A08A\",\"#2989A3\",\"#5BBCD6\",\"#A475D9\")\n```\n:::\n\n\n\nManipulation of data\n\n::: {.cell}\n\n```{.r .cell-code}\nsephora_sub<-sephora%>%\n  mutate(shop=rep(\"sephora\",length(brand)),\n         brand=tolower(brand),\n         product=tolower(product),\n         name=tolower(name))%>%\n  select(brand,product,name)\n\nulta_sub<-ulta%>%\n  mutate(shop=rep(\"ulta\",length(brand)),\n         brand=tolower(brand),\n         product=tolower(product),\n         name=tolower(name))%>%\n  select(brand,product,name)\n\n\nshops<-rbind(sephora_sub,ulta_sub)\n```\n:::\n\n\n\nManipulation of data\n\n::: {.cell}\n\n```{.r .cell-code}\nallCategories_sub<-allCategories%>%\n  mutate(brand=tolower(brand),\n         product=tolower(product),\n         name=tolower(name))%>%\n  separate_rows(categories, convert = TRUE) %>%\n  mutate(categories = fct_reorder(categories, lightness))  %>%\n  select(brand,product,name,hex,lightness,categories)\n\nallShades_sub<-allShades%>%\n  mutate(brand=tolower(brand),\n         product=tolower(product),\n         name=tolower(name))%>%\n  select(brand,product,name,hex,hue,sat,lightness)\n\nallNumbers_sub<-allNumbers%>%\n  mutate(brand=tolower(brand),\n         product=tolower(product),\n         name=tolower(name))%>%\n  select(brand,product,name,hex,lightness,lightToDark)\n\n################### Full Join of the datasets ##############\n\nmake_up<-full_join(allCategories_sub,\n                   allShades_sub,by.x=hex,by.y=lightness)\nmake_up<-full_join(make_up,\n                   allNumbers_sub,by.x=hex,by.y=lightness)\n\nmake_up_sub<-make_up%>%\n  select(brand,name,hex,hue,sat,lightness)%>%\n  filter(!is.na(hue))%>%\n  arrange(hex)\n```\n:::\n\n\n\nCounting uniqueness\n\n::: {.cell}\n\n```{.r .cell-code}\nplyr::count(make_up$brand); #107\nplyr::count(make_up$product);#328\nplyr::count(make_up$name);#1,317\nplyr::count(allCategories_sub$categories)#17\n```\n:::\n\n\n\n\nSelection of data for making plots\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_companies <- sort(c(\"shiseido\",\"maybelline\",\"mac\",\"lancôme\",\"l'oréal\",\"guerlain\",\"estée lauder\",\"clinique\",\"benefit cosmetics\"), decreasing = TRUE)\n\nmake_up_for_plot <- make_up_sub %>%\n  filter(brand %in% my_companies) %>%\n  select(brand, name,hex, hue,sat,lightness) %>%\n  mutate(brand=as.factor(brand)) %>%\n  group_by(brand) %>%\n  mutate(mean_lightness = mean(lightness)) %>%\n  ungroup() %>%\n  mutate(brand = fct_reorder(brand, mean_lightness))\n\n\nlibrary(ggfx)\nlibrary(gridExtra)\n\n\nplot1<-make_up_for_plot%>%\n  ggplot(aes(brand,lightness,col=hex)) + \n  with_blur(\n    geom_boxplot(size=5,show.legend = FALSE)) + \n  geom_jitter(width = 0.15,height = 0.0,size = 1) + \n  scale_colour_identity() + \n  coord_polar() + \n  labs(title = \"Shades of makeup from The Pudding\",\n       subtitle = \"All collected from the US versions of Sephora and Ulta’s websites\",\n       caption = \"107 brands, 328 products, 317 names and 17 categories\",\n       tag = \"The Pudding\",\n       x = \"Lightness\",\n       y = \"Brands)\",\n       colour = \"white\")+\n  theme_void(base_family = \"cedarville\") + \n  theme(plot.background = element_rect(fill = \"black\",color=\"black\"),\n        axis.text.x = element_text(size = 30, vjust = 2,color=\"white\"),\n        plot.title = element_text(size = 56,hjust = 0.5,color=\"white\"),\n        plot.subtitle = element_text(size = 46,hjust = 0.5,color=\"white\"),\n        plot.caption = element_text(size = 36,hjust = 0.5, \n                                    margin = margin(t = 5, b = 10),color=\"white\"),\n        plot.tag = element_text()\n        )\n          \n\nplot2<-make_up_for_plot%>%\n  ggplot(aes(brand,lightness,col=hex)) + \n  with_blur(\n    geom_point(show.legend = FALSE)) + \n  geom_jitter(width = 0.15,height = 0.0,size = 2) + \n  scale_colour_identity() +\n  coord_polar(direction=1) +\n  theme_void() + \n  theme(plot.background = element_rect(fill = \"black\")) + \n  facet_wrap(vars(brand))\n```\n:::\n\n\n\n\nFinal plot\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggimage)\nrequire(magick)\n\n\nmain_plot <- plot1 + plot2\n\nfinal <- main_plot + \n  labs(title = \"Makeup - The naked truth\",\n       subtitle = \"combination for naming their shades\",\n       caption = \"TidyTuesday W14 - The Pudding - Viz - @fgazzelloni\") + \n  scale_fill_manual(values = palette,\n                    guide = guide_legend(title = NULL)) + \n  theme_void(base_family = \"cedarville\") + \n  theme(plot.background = element_rect(fill = \"#FCEBDA\",color = NA),\n        strip.text.x = element_text(color = NA),\n        axis.text.x = element_text(size = 20, vjust = 2),\n        panel.grid.major = element_line(size = 0.03, linetype = 'solid',colour = \"black\"),\n        plot.margin = margin(10, 10, 5, 10),\n        plot.title = element_text(size = 56,hjust = 0.5, margin = margin(t = 5, b = 10)),\n        plot.subtitle = element_text(size = 40,hjust = 0.5),\n        plot.caption = element_text(hjust = 0.5, size = 26))\n```\n:::\n\n\n\nSave the plot in a .png file\n\n::: {.cell}\n\n```{.r .cell-code}\nragg::agg_png(here::here(\"w14_the_pudding\", \"w14_the_pudding.png\"),\n              res = 320, width = 14, height = 8, units = \"in\")\nfinal\n\ndev.off()\n```\n:::\n\n\nRead the image, attach the Tidytuesday logo and save it\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy_logo <- image_read(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/static/plot_logo.png\") %>%\n  image_resize(\"300x300\")\n\n\nThe_Pudding_plot <- image_read(here::here(\"w14_the_pudding/w14_the_pudding.png\"))\n\nattached_logo <- image_composite(The_Pudding_plot, tidy_logo,\n                                 operator=\"atop\",\n                                 gravity=\"southeast\") # tell R where to put the logo\n\n\nimage_write(attached_logo, \n            path = \"/Users/federica/Documents/R/R_general_resourses/TidyTuesday/TidyTuesday/w14_the_pudding/w14_the_pudding.png\", format = \"png\") # save final plot\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}