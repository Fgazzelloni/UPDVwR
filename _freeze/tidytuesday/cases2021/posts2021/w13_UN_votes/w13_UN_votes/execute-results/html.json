{
  "hash": "ed4c930e997603d05f27fdbc592cfd9e",
  "result": {
    "markdown": "---\ntitle: \"UN Votes\"\nsubtitle: \"Welcome to TidyTuesday 2021 week 13\"\nauthor: \"Federica Gazzelloni\"\ndate: \"2021-03-23\"\nimage: \"w13_UN_votes.png\"\nimage-alt: \"\"\ndescription: \"Social Networks\"\noutput: html_document\nexecute: \n  eval: false\n---\n\n\n\nLibraries\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(DT)\nlibrary(unvotes)\nlibrary(tidytuesdayR)\nlibrary(ggplot2)\n\nlibrary(showtext)\nfont_add_google(\"Share Tech Mono\", \"techmono\")\nshowtext_opts(dpi = 320)\nshowtext_auto(enable = FALSE)\n```\n:::\n\n\nGet data\n\n::: {.cell}\n\n```{.r .cell-code}\nunvotes <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-23/unvotes.csv')\nroll_calls <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-23/roll_calls.csv')\nissues <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-23/issues.csv')\n```\n:::\n\n\n\nUNvotes_full and UNvotes_sub\n\n::: {.cell}\n\n```{.r .cell-code}\nunvotes_full <- unvotes %>%\n  inner_join(un_roll_calls, by = \"rcid\") %>%\n  inner_join(un_roll_call_issues, by = \"rcid\")\n\nunvotes_sub <- unvotes_full%>%\n  select(date,country,session,vote,issue)\n```\n:::\n\n\nUN Countries\n\n::: {.cell}\n\n```{.r .cell-code}\ngerman<-unvotes_full%>%filter(str_detect(country, \"Germ\"))\n#table(german$country)\ncongo<-unvotes_full%>%filter(str_detect(country, \"Congo\"))\n#table(congo$country)\nyemen<-unvotes_full%>%filter(str_detect(country, \"Yemen\"))\n#table(yemen$country)\nguinea<-unvotes_full%>%filter(str_detect(country, \"Guinea\"))\n#table(guinea$country)\n\nunvotes_merged_country_names<-unvotes_sub%>%\n  mutate(country=case_when(country==\"Federal Republic of Germany\"~\"Germany\",\n                           country==\"German Democratic Republic\"~\"Germany\",\n                           country==\"Congo - Brazzaville\"~\"Congo\",\n                           country==\"Congo - Kinshasa\"~\"Congo\",\n                           country==\"Micronesia (Federated States of)\"~\"Micronesia\",\n                           country==\"Myanmar (Burma)\"~\"Myanmar\",\n                           country==\"Yemen Arab Republic\"~\"Yemen\",\n                           country==\"Yemen People's Republic\"~\"Yemen\",\n                           country==\"Guinea-Bissau\"~\"Giunea\",\n                           TRUE~country))%>%\n  select(date,country,vote,issue) %>%\n  arrange(date)\n```\n:::\n\n\nby_country_year\n\n::: {.cell}\n\n```{.r .cell-code}\nby_country_year <- unvotes_merged_country_names %>%\n  group_by(year = year(date), country) %>%\n  summarize(issue,votes = n(),\n            percent_yes = round(mean(vote == \"yes\")*100,1),\n            percent_no = round(mean(vote == \"no\")*100,1),\n            percent_astain = round(mean(vote == \"abstain\")*100,1))\n```\n:::\n\n\nVisualization\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(graphics)\nbck_color <- \"#FEFCEF\"\nmain_plot<-ggplot(data=by_country_year,\n                  aes(x=year,y=votes,col=votes))+\n  geom_line()+\n  geom_point()+\n  scale_x_continuous(breaks=seq(1946,2019,10))+\n  \n  theme_void()+\n  theme(axis.text.x=element_text(color=bck_color))\n```\n:::\n\n\nUN background image\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggimage)\n\n\nUN_img=\"https://camo.githubusercontent.com/654fb54c78403255bbe1457b6a75423f5e370ee075eab4db0a189b886b68b8d7/68747470733a2f2f75706c6f61642e77696b696d656469612e6f72672f77696b6970656469612f636f6d6d6f6e732f7468756d622f652f65652f554e5f656d626c656d5f626c75652e7376672f3132303570782d554e5f656d626c656d5f626c75652e706e67\"\n\ng<-ggbackground(main_plot, UN_img, alpha=.7,color=\"#94BCFF\")\n```\n:::\n\n\nFinal plot annotations\n\n::: {.cell}\n\n```{.r .cell-code}\nshowtext_auto(enable = TRUE)\nlibrary(patchwork)\nlibrary(sf)\nlibrary(rnaturalearth)\nlibrary(magick)\nlibrary(grid)\nlibrary(png)\n\nfinal <- g + plot_annotation(\n    title = \"UN Votes from 1946 to 2019\",\n    subtitle=\"on six issues: Colonialism,Arms control and disarmament,Economic development,Human rights,Palestinian conflict Nuclear weapons and nuclear material\",\n    caption = \"Visualization: Federica Gazzelloni | Data: Harvards' UN votes\",\n    theme = theme(\n      plot.margin = margin(10,10,10,10),\n      plot.background = element_rect(fill = bck_color, color = NA),\n      plot.caption = element_text(family = \"techmono\", size = 9, color = bck_color, margin = margin(15,0,0,0), hjust = 0.95)\n    )\n  )\n\nragg::agg_png(here::here(\"render\", paste0(\"UN_votes_\",\n                                          format(Sys.time(),\n                                                 \"%Y%m%d_%H%M%S\"),\n                                          \".png\")),\n              res = 320, width = 14, height = 8, units = \"in\")\nfinal\n\ndev.off()\n```\n:::\n\n\nRead the image, attach the Tidytuesday logo and save it\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy_logo<-image_read(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/static/plot_logo.png\") %>%\n  image_resize(\"300x300\")\n\n\nUN_votes_plot <- image_read(\"~/R/Projects/TidyTuesday/render/UN_votes_20210326_201814.png\")\n\nattached_logo <- image_composite(UN_votes_plot, tidy_logo,\n                                 #offset = \"0+0\",\n                                 operator=\"atop\",\n                                 gravity=\"northeast\") # tell R where to put the logo\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_write(attached_logo, path = \"~/R/Projects/TidyTuesday/render/UN_votes_W13.png\", format = \"png\") # save final plot\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}