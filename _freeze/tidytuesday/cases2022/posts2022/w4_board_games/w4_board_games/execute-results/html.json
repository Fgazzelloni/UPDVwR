{
  "hash": "6e8b4e8f3d3bdffaacc9f09dc3d5b223",
  "result": {
    "markdown": "---\ntitle: 'Board games'\nsubtitle: 'Welcome to TidyTuesday 2022 week 4'\ndate: '2022-01-25'\nimage: \"w4_board_games.png\"\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n\n## Overview\n\nI've chosen this graphic for my blog because it turned out to be very interesting. As you can see reading through the article, the shape of the network changes along with the change of the parameters.\n\nThe dataset I've used for making this network comes from **[#TidyTuesday](https://github.com/rfordatascience/tidytuesday/blob/master/data/2022/2022-01-25/readme.md)** 2022 week 4 **Board games**. \n\nThe picture below is the result of the network visualization.\n\n![](featured.png)\n\n\nThe first step is to load the library needed for making the manupulations. I usually load **{tidyverse}** package because it contains a series of sub packages and functions that are all that is neede for thsi first part of the data wrangling. Also, it provides the **pipe `%>%` operator**, which is useful for linking different functions through subsetting the dataset.\n\n\n::: {.cell paged.print='false'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\nThe data sets provided can be loaded from the source like this:\n\n::: {.cell}\n\n```{.r .cell-code}\nratings <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-01-25/ratings.csv')\ndetails <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-01-25/details.csv')\n```\n:::\n\n\nI've also added few line of code for backing the original datasets by saving them as .RDS files, a light file format to store information in.\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(ratings,\"ratings.rds\")\nsaveRDS(details,\"details.rds\")\n```\n:::\n\n\nAnd assigned them to new variables:\n\n::: {.cell}\n\n```{.r .cell-code}\nrat <- readRDS(\"ratings.rds\")\ndet <- readRDS(\"details.rds\")\n```\n:::\n\n\n### Variables\n<details>\n\n<summary>Let's see the variable's names inside the sets.</summary>\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(rat)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(det)\n```\n:::\n\n\n</details>\n\nBased on the variables in the data sets, I've started googling for some information nad/or visualizations about Board games, to see if I could find any inspiration from past submissions, and in fact found this source of inspiration: https://www.thewayir.com/blog/boardgames/. Looking through the article found the code and the type of visualization I had in mind, so started replicating the code from the article. My surprise was that data updating and my manipulation slightly changed the output of the plot.\n\nLet's go a bit more in deep about that. I'll go through the steps for replicatiing the network but then sligtly change the output to what you can see in the picture.\n\nAmong the required libraries found [{widyr}](https://cran.r-project.org/web/packages/widyr/index.html) package which was very new to me.\n\n> Encapsulates the pattern of untidying data into a wide matrix, performing some processing, then turning it back into a tidy form. This is useful for several operations such as co-occurrence counts, correlations, or clustering that are mathematically convenient.\n\nAnd then the other packages such as **{igraph}**, **{ggraph}**, and **{ggforce}**, all packages for making [**networks of data**](https://ggplot2-book.org/networks.html), and for making extra features.\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(widyr)\nrequire(igraph)\nrequire(ggraph)\nrequire(ggforce)\n```\n:::\n\n\n---\n\n### Data wrangling \n<details>\n\n<summary>What's the best manipulation for making a graph?</summary>\n\nHere is the first part of the data-wrangling\n\n::: {.cell paged.print='false'}\n\n```{.r .cell-code}\nboard_games <- rat %>%\n  select(id,name) %>%\n  left_join(select(det,id,boardgamemechanic),by=\"id\") %>%\n  rename(mechanic=boardgamemechanic) %>%\n  tidyr::separate_rows(mechanic, sep = \",\") %>% \n  mutate(mechanic = str_remove_all(mechanic, \"[[:punct:]]\"),\n         mechanic = str_trim(mechanic),\n         mechanic = gsub(\"^and \",\"\",mechanic)) %>% \n  filter(!is.na(mechanic))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nkableExtra::kable(head(board_games))\n```\n:::\n\n\nHere is the second part of the wrangling\n\n::: {.cell paged.print='false'}\n\n```{.r .cell-code}\nmechanic <- board_games %>% \n  count(mechanic,sort=T) %>%\n  mutate(mechanic_pct=round(n/sum(n)*100,2))%>%\n  left_join(select(board_games,name,mechanic),by=\"mechanic\") %>%\n  mutate(name=as.factor(name),mechanic=as.factor(mechanic)) %>% \n   distinct() \n```\n:::\n\n\n\nThis part is for setting the fonts\n\n::: {.cell paged.print='false'}\n\n```{.r .cell-code}\nlibrary(extrafont)\nlibrary(showtext)\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi=320)\nlibrary(sysfonts)\n#font_families_google()\nfont_add_google(name=\"Piedra\",family=\"games\")\n\nfamily = \"games\"\n```\n:::\n\n\n</details>\n\nSelect the first 50 games\n\n::: {.cell}\n\n```{.r .cell-code}\nboard_games50 <-board_games%>%\n  select(name,mechanic)%>%\n  count(name,sort=T) %>%\n  slice(1:50)\n```\n:::\n\n\n\n### Then finally make the plot.\n\nThe interesting part is here: if we change the filtering level of the `mechanic_pct` and/or the `widyr::pairwise_cor()` from the `{widyr}` package we can see the graph changing along with it. More changes if the level of correlation changes to a lower value more than if set to a higher value.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- board_games50%>%\n  left_join(mechanic,by=\"name\") %>%\n  filter(mechanic_pct > 1) %>%\n  pairwise_cor(mechanic, name, sort = T) %>% \n  filter(correlation > .1)\n```\n:::\n\n\nThe function  `igraph::graph_from_data_frame()` transform data frames into igraph graphs. In addition the funtion `igraph::tkplot()` can be useful for looking at the graph under different perspectives.\n\n\n\n\n\n\n\n\nThis is the final version of the plot:\n\n::: {.cell paged.print='false'}\n\n```{.r .cell-code}\nplot <- df %>% \n  igraph::graph_from_data_frame() %>% \n  ggraph() +\n  geom_edge_link(linejoin = \"round\",\n                 color=\"grey5\",\n                 edge_colour=\"red\",\n                 edge_width=0.5,\n                 edge_linetype=\"solid\") +\n  geom_node_point(color=\"midnightblue\",size=40,alpha=0.4) +\n  geom_node_text(aes(label = name), \n                 repel = T,\n                 size=5,\n                 nudge_y = 0,\n                 color=\"orange\",\n                 family=family) + \n  theme_void() +\n   theme(text = element_text(family=family),\n         plot.background = element_rect(color=\"beige\",fill=\"beige\"))\n```\n:::\n\n\n</details>\n\n### Final touches with {cowplot} and ggsave()\n<details>\n\n<summary>Adding some features and save</summary>\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cowplot)\n\nfinal <-ggdraw()+\n  draw_plot(plot) +\n  draw_label(\"Network of game \\nmechanics\",x=0.5,y=0.85,size=55,fontfamily=family)+\n  draw_label(\"Sliced by the first 50 games by frequency, \n             filtered mechanics greater than 2% proportion of total,\n             then finally taken just the most highly correlated ones\",\n             x=0.8,y=0.12,size=11,fontfamily=family) +\n  draw_label(\"DataSource: Kaggle & Board Games Geek | Viz: Federica Gazzelloni\",\n             x=0.8,y=0.03,angle=0,size=11,alpha=0.5,fontfamily=family) +\n   draw_image(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/static/plot_logo.png\",x=0.09,y=-0.47,scale=0.05)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"w4_board_games.png\",\n        plot =final,\n        bg=\"white\",\n        dpi = 320,\n        width = 11,\n        height = 6\n       )\n```\n:::\n\n\n</details>\n\n### Resources:\n\n- [tidygraph](https://tidygraph.data-imaginist.com/index.html)\n- [igraph](https://igraph.org/)\n- [ggnet](https://briatte.github.io/ggnet/)\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}