{
  "hash": "689e5427a7ff9ce28c0d042556540b71",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Hydro Wastewater plants'\nsubtitle: 'Welcome to #TidyTuesday 2022 day 38'\ndate: '2022-09-20'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/TidyTuesday/main/data/2022/w38_hydro_wastewater/w38_hydro_wastewater_v2.png'\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nHydroWASTE_v10 <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-20/HydroWASTE_v10.csv')\n\nHydroWASTE_v10%>%names\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nHydroWASTE_v10%>%DataExplorer::profile_missing()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# HydroWASTE_v10%>%View()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- HydroWASTE_v10%>%\n  janitor::clean_names()%>%\n  count(country,lat_wwtp,lon_wwtp,source,\n        qual_loc,qual_pop,qual_waste,qual_level,qual_cap)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# source: https://stackoverflow.com/questions/68278789/how-to-rotate-world-map-using-mollweide-projection-with-sf-rnaturalearth-ggplot\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(sf)\n\ntarget_crs <- st_crs(\"+proj=moll +x_0=0 +y_0=0 +lat_0=0 +lon_0=133\")\n\nworldrn <- ne_countries(scale = \"medium\", returnclass = \"sf\") %>%\n  st_make_valid()\n\n\n# define a long & slim polygon that overlaps the meridian line & set its CRS \n# Centered in lon 133\noffset <- 180 - 133\n\n# build a polygon\npolygon <- st_polygon(x = list(rbind(\n  c(-0.0001 - offset, 90),\n  c(0 - offset, 90),\n  c(0 - offset, -90),\n  c(-0.0001 - offset, -90),\n  c(-0.0001 - offset, 90)))) %>%\n  st_sfc() %>%\n  st_set_crs(4326)\n\n\n# set the polygons\nworld2 <- worldrn %>% \n  st_difference(polygon) %>% \n  st_transform(crs = target_crs)\n```\n:::\n\n\n\n\nSet the values for hydro waste to the new target crs.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoords <- df %>% \n  rename(lat=lat_wwtp,lon=lon_wwtp) %>%\n  sf::st_as_sf(coords = c(\"lon\", \"lat\"), crs = 4326) %>% \n  sf::st_transform(crs = target_crs) \n```\n:::\n\n\n\n\nSet the colors.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(RColorBrewer)\nmy_palette <- RColorBrewer::brewer.pal(12,\"Set3\")\n\nmy_values <- c(\"1\"=\"#8DD3C7\", \n               \"2\"=\"#FFFFB3\",\n               \"3\"=\"#BEBADA\", \n               \"4\"=\"#FB8072\",\n               \"5\"=\"#80B1D3\", \n               \"6\"=\"#FDB462\",\n               \"7\"=\"#B3DE69\",\t\n               \"8\"=\"#FCCDE5\",\n               \"9\"=\"#D9D9D9\",\n               \"10\"=\"#BC80BD\",\n               \"11\"=\"#CCEBC5\", \n               \"12\"=\"#FFED6F\")\n\nmy_labels<-c(\"Europe\", \"United States\",\n             \"Brazil\", \"Mexico\",\n             \"China\", \"Canada\",\n             \"Australia\",\t\"South Africa\",\n             \"India\", \"New Zealand\",\n             \"Peru\", \"Remaining Countries\")\n```\n:::\n\n\n\n\n\nMake the mollweide, more info on how to set the projections here: https://epsg.io/54009\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_sf(data = world3, aes(group = admin), \n          fill = \"#f5f5f5\") + \n  geom_sf(data = coords,\n          mapping = aes(color=factor(source)),\n          key_glyph = draw_key_rect,\n          size=0.1) + \n  scale_color_manual(labels=my_labels,values=my_values)+\n  labs(title=\"Wastewater Plants\",\n       subtitle=\"Concentrated point sources of residual contaminant loads into surface waters\",\n       caption=\"DataSource: #TidyTuesday 2022 week38 Hydro Wastewater | DataViz: Federica Gazzelloni @fgazzelloni\",\n       color=\"Source of\\nwaterwaste\")+\n  coord_sf()+\n  ggthemes::theme_map() +\n  theme(plot.title = element_text(size=14,face=\"bold\"),\n        plot.subtitle = element_text(size=12,face=\"bold\"),\n        text=element_text(family=\"Roboto Condensed\",color=\"#89a5b9\"),\n        panel.grid = element_line(color=\"#bfd0dd\"),\n        plot.background = element_rect(fill=\"#275477\",color=\"#275477\"),\n        panel.background = element_rect(fill=\"#275477\",color=\"#275477\"),\n        legend.background = element_blank(),\n        legend.position = c(-0.05,0.05),\n        legend.key = element_rect(size=4))\n```\n:::\n\n\n\n\nSave it.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"w38_hydro_waterwaste.png\",\n       dpi=320,\n       width = 10,\n       height = 5)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}