{
  "hash": "a87b29521cd929071b9dd6f4854b7a0e",
  "result": {
    "markdown": "---\ntitle: 'San Francisco Rentals'\nsubtitle: 'Welcome to TidyTuesday 2022 week 27'\ndate: '2022-07-05'\nimage: \"w27_rentals.png\"\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nrent<-readRDS(\"rent.rds\")\nrent\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmax<-rent%>%\n  mutate(city=str_to_title(city))%>%\n  filter(year>2000)%>%\n  group_by(year,city)%>%\n  mutate(avg=median(price))%>%\n  ungroup()%>%\n  count(year,city,avg) %>%\n    arrange(year,-avg) %>%\n  slice_max(order_by=c(avg),n=10) %>%\n  count(city) %>%\n  select(-n) %>%\n  unlist()\n\nmax\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\navg_df<- rent%>%\n  mutate(city=str_to_title(city))%>%\n  filter(year>2000)%>%\n  group_by(year,city)%>%\n  mutate(avg=median(price))%>%\n  ungroup() %>%\n  count(year,city,avg) %>%\n  mutate(pct=round(n/sum(n)*100,2)) %>%\n  arrange(year,-avg)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\navg_group<-avg_df%>%\n  filter(!city%in%max) %>%\n  group_by(year)%>%\n  summarise(avg_group=median(avg)) %>%\n  ungroup()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(avg_df$avg)\n```\n:::\n\n\n# text prices\n\n::: {.cell}\n\n```{.r .cell-code}\ntext_max<-rent%>%\n  mutate(city=str_to_title(city))%>%\n  filter(year>2000)%>%\n  group_by(year,city)%>%\n  mutate(avg=median(price))%>%\n  ungroup()%>%\n  count(year,city,avg) %>%\n    arrange(year,-avg) %>%\n  slice_max(order_by=c(avg),n=5) %>%\n  mutate(avg_comma=formatC(avg, format=\"d\", big.mark=\",\"))%>%\n  mutate(avg_text=paste0(\"$\",avg_comma,\" \",city))\n\ntext_max\n```\n:::\n\n::: {.cell paged.print='false'}\n\n```{.r .cell-code}\n main<- avg_df %>%\n    ggplot(aes(x=factor(year),y=avg,group=factor(city),color=city))+\n    geom_line(size=0.2,show.legend = F,color=\"grey80\",alpha=0.2) +\n    geom_line(data= subset(avg_df, city%in%max),\n              inherit.aes = T,key_glyph = \"timeseries\")+\n    geom_line(data=avg_group,\n            aes(x=factor(year),y=avg_group,group=1),\n              inherit.aes = F,size=1)+\n  geom_text(data= text_max, aes(x=factor(year),y=avg,label=avg_text),\n            inherit.aes = F,family=\"Roboto Condensed\",face=\"bold\",\n            vjust=1,hjust=1)+\n  scale_color_viridis_d()+\n  guides(color=guide_legend(nrow = 2))+\n  scale_x_discrete(expand = c(0,0.09),breaks=seq(2000,2018,2))+\n  scale_y_log10(expand = c(0,0),breaks=5)+\n  labs(title=\"San Francisco Bay Area Craigslist rental prices\",\n       subtitle=\"top 10 high-rent cities & expected global trend (2001-2018)\",\n       caption=\"DataSource: #TidyTuesday2022 week27 San Francisco Rentals on Craigslist\\nDataViz: Federica Gazzelloni (@fgazzelloni)\",\n       color=\"City\",\n       x=\"Year\",y=\"Median values - log transf ($525 to $11,140)\")+\n    ggdark::dark_theme_classic()+\n  theme(text=element_text(family=\"Roboto Condensed\",color=\"grey90\"),\n        axis.text = element_text(20),\n        legend.position = c(0.75,-0.1),\n        legend.background = element_blank(),\n        legend.text = element_text(size=6),\n        legend.margin = margin(5,5,5,5,\"pt\"),\n        legend.direction = \"horizontal\",\n        panel.grid.major.x = element_line(size=0.2),\n        plot.margin = margin(10,10,10,10,\"pt\"),\n        plot.title = element_text(size=22),\n        plot.caption = element_text(hjust=0),\n        axis.line.y = element_line(size=0.2),\n        axis.line.x = element_line(size=1),\n        axis.ticks = element_line(size=2))\nmain\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(showtext)\nshowtext.auto()\nshowtext.opts(dpi=320)\nlibrary(extrafont)\n#loadfonts()\n```\n:::\n\n::: {.cell paged.print='false'}\n\n```{.r .cell-code}\ninsect<-rent%>%\n  group_by(year)%>%\n  summarize(avg=median(price))%>%\n  ungroup()%>%\n  ggplot(aes(x=factor(year),y=avg,group=1))+\n  geom_point()+\n  geom_line()+\n  scale_x_discrete(expand = c(0,0.09),breaks=seq(2000,2018,4))+\n  labs(title=\"Global SFB rental prices from 2000 to 2018\",\n       subtitle=\"Median values\",\n        x=\"\",y=\"\")+\n   ggdark::dark_theme_classic()+\n  theme(text=element_text(family=\"Roboto Condensed\",color=\"grey90\",size = 18),\n        panel.grid.major.x = element_line(size=0.2),\n        axis.text = element_text(size=20),\n        plot.title = element_text(size=25),\n        plot.title.position = \"plot\",\n        plot.margin = margin(10,10,10,10,\"pt\"),\n        plot.caption = element_text(hjust=0),\n        axis.line.y = element_line(size=0.2),\n        axis.line.x = element_line(size=1),\n        axis.ticks = element_line(size=2))\ninsect\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"insect.png\",\n       dpi=300,\n       width = 8,\n       height = 6)\n```\n:::\n\n::: {.cell paged.print='false'}\n\n```{.r .cell-code}\nlibrary(cowplot)\n\nggdraw(main)+\n  draw_image(\"insect.png\",scale=0.25,\n             x=-0.35,y=0.25)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"w27_rentals.png\",\n       dpi=320,\n       width = 9,\n       height = 6)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}