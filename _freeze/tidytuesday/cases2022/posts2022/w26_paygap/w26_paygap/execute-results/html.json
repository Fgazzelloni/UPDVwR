{
  "hash": "adc85cdcff949e1142fa08535f74d440",
  "result": {
    "markdown": "---\ntitle: 'UK Gender pay gap'\nsubtitle: 'Welcome to TidyTuesday 2022 week 26'\ndate: '2022-06-28'\nimage: \"w26_paygap.png\"\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n::: {.cell paged.print='false'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npaygap <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-06-28/paygap.csv')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npaygap%>%head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npaygap%>%names\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- paygap%>% # count(employer_id,sort=T)\n  arrange(employer_id) %>%\n  group_by(employer_id)%>%\n  summarize(employer_size,across(.cols = is.numeric,median)) %>%\n  ungroup()\n  \ndf\n```\n:::\n\n\n## df_bonus\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_bonus <- df%>% #DataExplorer::profile_missing()\n  select(employer_id,employer_size,contains(\"bonus\")) %>%\n  filter(!employer_size==\"Not Provided\") %>%\n  mutate(id=case_when(employer_size==\"Less than 250\"~1,\n                      employer_size==\"250 to 499\"~2,\n                      employer_size==\"500 to 999\"~3,\n                      employer_size==\"1000 to 4999\"~4,\n                      employer_size==\"5000 to 19,999\"~5,\n                      employer_size==\"20,000 or more\"~6)) %>%\n  relocate(id) %>%\n  arrange(id)\n\ndf_bonus %>% DataExplorer::profile_missing()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_bonus %>%\n  #group_by(employer_size) %>%\n  #summarize(across(is.numeric,.fns = median)) %>%\n  #ungroup() %>%\n  ggplot(aes(x=male_bonus_percent,y=female_bonus_percent))+\n  geom_boxplot(aes(group=employer_size),size=0.2)+ \n  geom_point(size=0.1,aes(color=employer_id))+\n  geom_abline(intercept = max(df_bonus$male_bonus_percent),slope=-1,size=0.1,linetype=\"dashed\")+\n  geom_abline(intercept = 0,slope=1,size=0.5,linetype=\"dashed\",color=\"red\")+\n  geom_smooth(method=\"lm\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_bonus%>%\n  filter(male_bonus_percent>50,female_bonus_percent<50) %>%\n    ggplot(aes(x=male_bonus_percent,y=female_bonus_percent))+\n # geom_boxplot(aes(group=employer_size),size=0.2)+ \n  geom_point(size=0.1,aes(color=employer_id))+\n  geom_abline(intercept = max(df_bonus$male_bonus_percent),slope=-1,size=0.5,linetype=\"dashed\")+\n  geom_abline(intercept = 0,slope=1,size=0.5,linetype=\"dashed\",color=\"red\")+\n  geom_text(aes(label=employer_id),check_overlap = T,size=2)+\n  geom_smooth(method=\"lm\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidymodels)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npay_bonus_pca<- df_bonus %>%\n  select(-employer_size) %>%\n  drop_na() %>%\n  prcomp(scale = TRUE)\n\ntidy(pay_bonus_pca, matrix = \"scores\") %>%\n  filter(PC%in%c(1,2)) %>%\n  pivot_wider(names_from=PC,values_from=value)%>%\n  janitor::clean_names() %>%\n  ggplot(aes(x=x1,y=x2))+\n    geom_point()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf%>%count(employer_size)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>%\n  mutate(id=case_when(employer_size==\"Less than 250\"~1,\n                      employer_size==\"250 to 499\"~2,\n                      employer_size==\"500 to 999\"~3,\n                      employer_size==\"1000 to 4999\"~4,\n                      employer_size==\"5000 to 19,999\"~5,\n                      employer_size==\"20,000 or more\"~6)) %>%\n  relocate(id) %>%\n  arrange(id) \n  #DataExplorer::profile_missing()\n```\n:::\n\n\n\nSampling\n\n::: {.cell}\n\n```{.r .cell-code}\ndf1<-df %>%\n  mutate(id=case_when(employer_size==\"Less than 250\"~1,\n                      employer_size==\"250 to 499\"~2,\n                      employer_size==\"500 to 999\"~3,\n                      employer_size==\"1000 to 4999\"~4,\n                      employer_size==\"5000 to 19,999\"~5,\n                      employer_size==\"20,000 or more\"~6)) %>%\n  relocate(id) %>%\n  arrange(id)\ndf1\n# library(sampling)\n# strata(df1,size=300)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf2<-df %>% #DataExplorer::profile_missing()\n  filter(!is.na(female_lower_quartile),!employer_size==\"Not Provided\") %>%\n  select(!contains(\"bonus\")) %>%\n  mutate(id=case_when(employer_size==\"Less than 250\"~1,\n                      employer_size==\"250 to 499\"~2,\n                      employer_size==\"500 to 999\"~3,\n                      employer_size==\"1000 to 4999\"~4,\n                      employer_size==\"5000 to 19,999\"~5,\n                      employer_size==\"20,000 or more\"~6)) %>%\n  relocate(id) %>%\n  arrange(id) %>%\n  group_by(id,employer_size)%>%\n  mutate(n=n()) %>%\n  ungroup() %>%\n  mutate(pct=round(n/sqrt(sum(n))*100,5))%>%#count(pct,n) %>%\n  relocate(n,pct)%>%\n  group_by(id,employer_size)%>%\n  summarise(across(.cols = everything(),.fns = mean)) %>%\n  ungroup() %>%\n # select(-diff_mean_bonus_percent) %>%\n  #mutate(diff_mean_bonus=round(male_bonus_percent-female_bonus_percent,2)) %>%\n  mutate_if(is.numeric, round, 2)\ndf2\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf2 %>%\n  arrange(id)%>%names\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf2 %>%\n  arrange(id)%>%\n  ggplot(aes(x=25,y=fct_reorder(employer_size,id),label=employer_size))+\n  geom_point(color=\"grey80\",shape=\".\")+\n  geom_text(hjust=1)+\n  geom_text(aes(x=30,label=paste0(diff_mean_hourly_percent,\"%\"))) +\n  # lower\n  geomtextpath::geom_textsegment(label=\"Lower\",size=4,\n                                 aes(x=female_lower_quartile,xend=male_lower_quartile,yend=employer_size),\n               position = position_nudge(y = 0.25),\n               color=\"grey50\",size=0.5)+\n  geom_point(aes(x=female_lower_quartile,y=employer_size),\n             position = position_nudge(y = 0.25),\n             color=\"violet\",size=5)+\n  geom_point(aes(x=male_lower_quartile,y=employer_size),\n             position = position_nudge(y = 0.25),\n             color=\"navy\",size=5)+\n  # upper\n    geomtextpath::geom_textsegment(label=\"Upper\",size=4,\n                            aes(x=female_top_quartile,xend=male_top_quartile,yend=employer_size),\n                            color=\"grey50\",size=0.5)+\n  geom_point(aes(x=female_top_quartile,y=employer_size),color=\"violet\",size=5)+\n  geom_point(aes(x=male_top_quartile,y=employer_size),color=\"navy\",size=5)+\n  geom_vline(xintercept = 50,size=0.3,linetype=\"dashed\")+\n\n  #scale_x_continuous(limits = c(0,65),breaks = c(40,50,60))+\n  labs(y=\"\")+\n  ggthemes::theme_fivethirtyeight()+\n  theme(axis.text.y = element_blank(),\n        panel.grid.major.y = element_blank(),\n        panel.grid.major.x = element_blank())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf2 %>%\n  arrange(id)%>%\n  ggplot(aes(x=25,y=fct_reorder(employer_size,id),label=employer_size))+\n  geom_text(hjust=1,fontface=\"bold\",color=\"#003d59\",size=6)+\n  geom_text(aes(x=30,label=paste0(diff_median_hourly_percent,\"%\")),\n            fontface=\"bold\",size=4,\n            color=\"#003d59\") +\n  # lower\n  geom_segment(size=3.5,\n               aes(x=female_lower_quartile,xend=female_top_quartile,yend=employer_size),\n               position = position_nudge(y = 0.2),\n               color=\"#a8bd3a\",size=0.5)+\n  geom_point(aes(x=female_lower_quartile,y=employer_size),\n             position = position_nudge(y = 0.2),\n             shape=21,stroke=1,fill=\"violet\",\n             color=\"#a8bd3a\",size=5)+\n  geom_point(aes(x=female_top_quartile,y=employer_size),\n             position = position_nudge(y = 0.2),\n             shape=21,stroke=1,fill=\"violet\",\n             color=\"#a8bd3a\",size=5)+\n  # upper\n  geom_segment(size=3.5,\n               aes(x=male_lower_quartile,xend=male_top_quartile,yend=employer_size),\n               position = position_nudge(y = -0.2),\n               color=\"#a8bd3a\",size=0.5)+\n  geom_point(aes(x=male_lower_quartile,y=employer_size),\n             position = position_nudge(y = -0.2),\n             shape=21,stroke=1,fill=\"navy\",\n             color=\"#a8bd3a\",size=5)+\n  geom_point(aes(x=male_top_quartile,y=employer_size),\n             position = position_nudge(y = -0.2),\n             shape=21,stroke=1,fill=\"navy\",\n             color=\"#a8bd3a\",size=5)+\n  # vertical line\n  geom_vline(xintercept = c(40,50,60),size=(c(40,100,40)/100),linetype=\"dashed\",color=\"grey40\")+\n  scale_x_continuous(limits = c(10,65),breaks = c(40,50,60),labels = paste0(c(40,50,60),\"K\"))+\n  coord_cartesian(clip = \"off\",ylim = c(1,6))+\n  labs(title=\"Difference in gender PayGap by size of Employers\\n\\n\",\n       caption=\"\\nDataSource: #TidyTuesday 2022 week26 ons.gov.uk | DataViz: Federica Gazzelloni (@fgazzelloni)\")+\n   annotate(\"text\",\n            x= c(18,30,50),\n            y = c(6.8,6.8,6.8),\n           label = c(\"Employer size\", \"PayGap\", \"Gender upper/lower values \"),\n           family = \"\", fontface = 3, size=5,color=\"#a8bd3a\") +\n    ggthemes::theme_fivethirtyeight()+\n  theme(text = element_text(color=\"#a8bd3a\"),\n        plot.title = element_text(size=18),\n        plot.caption = element_text(size=8.5,family=\"\",face=3),\n        axis.text.y = element_blank(),\n        axis.text.x = element_text(size=12,face=\"bold\"),\n        panel.grid.major.y = element_line(size=14),\n        panel.grid.major.x = element_blank(),\n        plot.background = element_rect(color=\"#003d59\",fill=\"#003d59\"),\n        panel.background = element_rect(color=\"#003d59\",fill=\"#003d59\"))+\n     annotate(\"text\",\n            x= 20.8,\n            y = 0.2,\n           label = \"PayGap are median values calculated on unique employer id\\nfrom hourly pay(%) mean difference\\nPink = Female | Blue = Male\",\n           family = \"\", fontface = 3, size=2.8,color=\"white\") \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"w26_paygap.png\",dpi=320)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}