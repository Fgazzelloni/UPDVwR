{
  "hash": "1e94c1d65e4cb161654657a76f55fd77",
  "result": {
    "markdown": "---\ntitle: 'Pell Grants'\nsubtitle: 'Welcome to TidyTuesday 2022 week 35'\ndate: '2022-08-30'\nimage: \"w35_pell.png\"\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npell <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-08-30/pell.csv')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(pell)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nusdata::state_stats%>%names\n```\n:::\n\n\n\n51 abbr\n\n::: {.cell}\n\n```{.r .cell-code}\nabbr <- usdata::state_stats%>%\n  count(abbr) %>%\n  select(-n)\n```\n:::\n\n\n\n59 STATES\n\n::: {.cell}\n\n```{.r .cell-code}\npell_abbr <- pell%>%\n  count(abbr=STATE) %>%\n  select(-n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing <- setdiff(pell_abbr,abbr)%>%\n  unlist()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyear_id <- pell%>%\n  count(YEAR) %>%\n  select(-n)%>%\n  mutate(year_id=seq(1,length(YEAR),1))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- pell%>%\n  arrange(YEAR) %>%\n  filter(STATE%in%missing)%>%\n  arrange(STATE) %>%\n  mutate(NAME=case_when(NAME==\"American Samoa Cmnty College\"~\"American Samoa Community College\",\n         TRUE~NAME)) %>%\n  mutate(NAME_long=case_when(STATE==\"PR\"~\"Puerto Rico\",\n                             STATE==\"AS\"~\"American Samoa\",\n                             STATE==\"GU\"~\"Guam\",\n                             STATE==\"MH\"~\"Marshall Islands\",\n                             STATE==\"PW\"~\"Palau\",\n                             STATE==\"VI\"~\"Virgin Islands\",\n                             STATE==\"MP\"~\"Marianas Islands\",\n                             STATE==\"FM\"~\"Micronesia\",\n                             TRUE~STATE)) %>%\n  count(STATE,NAME_long,AWARD,RECIPIENT,YEAR) %>%\n  group_by(STATE) %>%\n  mutate(n=n(),avg_single_aw=AWARD/RECIPIENT) %>%\n  ungroup() %>%\n  left_join(year_id,by=\"YEAR\")\n\ndf\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np <- df %>%\n  ggplot(aes(YEAR,avg_single_aw,group=YEAR))+\n  geom_boxplot()\n\n\np\nplotly::ggplotly(p)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(giscoR)\nworld <- gisco_get_countries()\n\n\nstates <- df %>%\n  count(STATE) %>%\n  select(-n)\n\n\nsmall_countries <-world%>%\n  filter(CNTR_ID%in%states$STATE)%>%\n  left_join(df,by=c(\"CNTR_ID\"=\"STATE\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(sf)\n\n\ncropped_world<- st_crop(world, \n        xmin = 120, xmax = 172,\n        ymin = -14, ymax = 40)\n\n\n\n\n\nsmall_countries_feat <- small_countries %>%\n  st_drop_geometry() %>%\n  #filter(CNTR_ID==\"PR\")%>%\n  group_by(YEAR,CNTR_ID,NAME_ENGL)%>%\n  summarise(avg_single_aw,\n            mean_val=mean(avg_single_aw),.groups=\"drop\")%>%\n  ungroup() %>%\n  count(YEAR,CNTR_ID,NAME_ENGL,mean_val) %>%\n  group_by(CNTR_ID)%>%\n  mutate(diff=c(0,diff(mean_val)),\n         diff_prop=paste0(round(diff/mean_val*100,2),\"%\"),\n        # diff_w=round(c(0,diff(mean_val))*1/n,2),\n         avg=round(mean(round(diff/mean_val*100,2)),2))%>%\n  ungroup()\n  \nsmall_countries_feat  \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnames <- small_countries%>%\n  count(CNTR_ID,NAME_ENGL,avg_single_aw)\n\n\nsubworld <- small_countries %>% \n  group_by(CNTR_ID) %>%\n  # Mock the data field\n  summarise(data=n())%>%\n  ungroup()%>%\n  mutate(id=seq(1,8,1))\n\ntext <- subworld %>% \n  #select(geometry) %>%\n  st_cast(\"MULTIPOLYGON\") %>%\n # st_coordinates() %>%\n  st_centroid() %>%\n  st_coordinates() %>%\n  cbind(names) %>%\n  select(-n)\n\n\ntext_full <- text %>%\n  left_join(small_countries_feat,by=c(\"CNTR_ID\",\"NAME_ENGL\")) %>%\n  count(X,Y,NAME_ENGL,avg) %>%\n  mutate(text=paste0(NAME_ENGL,\"\\n\",avg,\"%\\n\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggforce)\n\ncircles <-\ndata.frame(\nx0 = text_full$X,\ny0 = text_full$Y,\nr = text_full$avg) #seq(min(text_full$avg), max(text_full$avg), length.out = 8))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(extrafont)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = cropped_world, fill=\"gray\")+\n  geom_sf(data = subworld, aes(color=CNTR_ID)) +\n  geom_text(data = text_full, aes(x=X,y=Y,label=text),family = \"Roboto Condensed\") +\n  geom_circle(data = circles, aes(x0 = x0, y0 = y0, \n                                  r = r,\n                                  fill=r,\n                                  alpha=r),\n              color=\"gray\",size=0.2) +\n  scale_fill_gradient(low = \"white\",high = \"blue\")+\n  scale_alpha_continuous(range = c(0.1,0.3))+\n  coord_sf(xlim = c(120,171.8428), \n           ylim = c( -14.36381, 40.59467),\n           crs = 4326) +\n  ggthemes::theme_fivethirtyeight() +\n  theme(text=element_text(family = \"Roboto Condensed\"),\n        panel.grid = element_line(size=0.08),\n        legend.position = \"none\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"map2.png\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(cowplot)\nggdraw() +\n  draw_image(\"map2.png\",scale=0.99) +\n  draw_image(\"globe.png\",\n             scale=0.2,\n             x=0.409,y=0.4) +\n  draw_label(\"Pell Awards\",\n             x=0.53,y=0.95,\n             fontfamily = \"Roboto Condensed\",\n             hjust=0,\n             color=\"grey30\",\n             size=30) +\n    draw_label(\"Pell Awards\",\n             x=0.53,y=0.95,\n             fontfamily = \"Roboto Condensed\",\n             hjust=0,\n             color=\"#a5bec9\",\n             size=29.5) +\n      draw_label(\"Basic Educational Opportunity Grants\\nby the U.S. Department of Education\",\n             x=0.47,y=0.88,\n             fontfamily = \"Roboto Condensed\",\n             hjust=0,\n             color=\"#24424f\",\n             size=12) +\n        draw_label(\"Western Pacific Ocean Islands yearly variation+ (average values %) 1990-2017\",\n               x=0.03,y=0.06,angle = 90,\n             #x=0.35,y=0.78,\n             fontfamily = \"Roboto Condensed\",\n             hjust=0,\n             color=\"#24424f\",\n             size=14) +\n  \n    draw_label(\"DataSource: #TidyTuesday 2022 week35\\nU.S. Department of Education\",\n             x=0.125,y=0.06,angle = 90,\n             fontfamily = \"Roboto Condensed\",\n             hjust=0,size=8) +\n      draw_label(\"DataVisualization: Federica Gazzelloni - @fgazzelloni\",\n             x=0.6,y=0.015,angle = 0,\n             fontfamily = \"Roboto Condensed\",\n             hjust=0,size=9) \n\nggsave(\"w35_pell.png\",bg=\"#b1d2e0\") #grey65 Saving 7 x 7 in image\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}