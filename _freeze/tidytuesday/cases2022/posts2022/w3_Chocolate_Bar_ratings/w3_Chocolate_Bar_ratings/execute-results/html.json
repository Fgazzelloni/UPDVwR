{
  "hash": "81e2e9461ee79829963029544a327fef",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Chocolate Bar ratings'\nsubtitle: 'Welcome to #TidyTuesday 2022 day 3'\ndate: '2022-01-18'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/TidyTuesday/main/data/2022/w3_chocolate/w3_chocolate.png'\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n\n\nHere is a short tutorial for making a **flow map**: https://github.com/rafapereirabr/flow-map-in-r-ggplot\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nchocolate <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-01-18/chocolate.csv')\n#DataExplorer::profile_missing(chocolate)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(maps)\nlibrary(geosphere)\n#library(rworldmap)\nlibrary(ggthemes)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get World map\nworldMap <- rworldmap::getMap()\nmapworld_df <- ggplot2::fortify( worldMap )\n```\n:::\n\n\n\n\nMismatching values in **company_location**\n\n\n\n\n\n\n\n\n**Martinique** would not be added in this flow map\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchocolate1<-chocolate%>%\n  select(company_location,country_of_bean_origin,cocoa_percent,rating)%>%\n  mutate(company_location=case_when(company_location==\"Amsterdam\"~\"Netherlands\",\n                                    company_location==\"Sao Tome\"~\"Sao Tome and Principe\",\n                                    company_location==\"Sao Tome & Principe\"~\"Sao Tome and Principe\",\n                                    company_location==\"Scotland\"~\"United Kingdom\",\n                                    company_location==\"St. Lucia\"~\"Saint Lucia\",\n                                    company_location==\"St.Vincent-Grenadines\"~\"Saint Vincent and the Grenadines\",\n                                    company_location==\"U.A.E.\"~\"United Arab Emirates\",\n                                    company_location==\"U.K.\"~\"United Kingdom\",\n                                    company_location==\"U.S.A.\"~\"United States of America\",\n                                    company_location==\"Wales\"~\"United Kingdom\",\n                                    TRUE~company_location)\n                                    )\n```\n:::\n\n\n\n\n\nMismatching values in **country_of_bean_origin** - missing **martinique**\n\n\n\n\n\n\n\n\n\n**Martinique** and ** ** would not be added in this flow map\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchocolate1<- chocolate1 %>%\n  mutate(country_of_bean_origin=case_when(country_of_bean_origin==\"Blend\"~\"Indonesia\",\n                                          country_of_bean_origin==\"Burma\"~\"Myanmar\",\n                                          country_of_bean_origin==\"Congo\"~\"Republic of the Congo\",\n                                          country_of_bean_origin==\"DR Congo\"~\"Republic of the Congo\",\n                                          country_of_bean_origin==\"Principe\"~\"Sao Tome and Principe\",\n                                          country_of_bean_origin==\"Sao Tome\"~\"Sao Tome and Principe\",\n                                          country_of_bean_origin==\"Sao Tome & Principe\"~\"Sao Tome and Principe\",\n                                          country_of_bean_origin==\"St. Lucia\"~\"Saint Lucia\",\n                                          country_of_bean_origin==\"St.Vincent-Grenadines\"~\"Saint Vincent and the Grenadines\",\n                                          country_of_bean_origin==\"Sulawesi\"~\"Indonesia\",\n                                          country_of_bean_origin==\"Sumatra\"~\"Indonesia\",\n                                          country_of_bean_origin==\"Tanzania\"~\"United Republic of Tanzania\",\n                                          country_of_bean_origin==\"Tobago\"~\"Trinidad and Tobago\",\n                                          country_of_bean_origin==\"Trinidad\"~\"Trinidad and Tobago\",\n                                          country_of_bean_origin==\"U.S.A.\"~\"United States of America\",\n                                          TRUE~country_of_bean_origin)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nchocolate2<-chocolate1%>%count(company_location,country_of_bean_origin)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncentroids_map<- mapworld_df%>%\n  group_by(id)%>%\n  mutate(long=mean(range(long)),lat=mean(range(lat)))%>%\n  ungroup()%>%\n  count(id,long,lat)\n\nDataExplorer::profile_missing(centroids_map)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nchocolate3<-chocolate2%>%\n  filter(!company_location==\"Martinique\",\n         !country_of_bean_origin==\"Martinique\",\n         !country_of_bean_origin==\"Samoa\")%>%\n  left_join(centroids_map,by=c(\"company_location\"=\"id\"))%>%\n  rename(long_loc=long,lat_loc=lat)%>%\n  left_join(centroids_map,by=c(\"country_of_bean_origin\"=\"id\"))%>%\n  rename(long_orig=long,lat_orig=lat)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntext<-chocolate3%>%\n  pivot_longer(cols = c(company_location,country_of_bean_origin),names_to=\"names\",values_to=\"country\")%>%\n  count(country)%>%\n  left_join(centroids_map,by=c(\"country\"=\"id\"))\n```\n:::\n\n\n\n\n\nChocolate palette: https://www.color-name.com/bitter-chocolate.color#color-palettes\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(extrafont)\nlibrary(showtext)\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi=320)\nlibrary(sysfonts)\n#font_families_google()\nfont_add_google(name=\"Felipa\",family=\"choco\")\n\nfamily = \"choco\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncircle_legend<-ggplot() +\n  ggforce::geom_circle(aes(x0 = -0.5, y0 = 0, r = 0.05),\n                       color=\"#dfc27d\",fill=\"#dfc27d\") +\n  ggforce::geom_circle(aes(x0 = 0, y0 = 0, r = 0.05),\n                       color=\"#dfc27d\",fill=\"#dfc27d\") +\n  ggforce::geom_circle(aes(x0 = 0, y0 = 0, r = 0.015),\n                       color=\"blue\",fill=\"blue\") +\n  ggforce::geom_circle(aes(x0 = 0.5, y0 = 0, r = 0.025),\n                       color=\"blue\",fill=\"blue\") +\n  coord_fixed(xlim=c(-0.5,1),ylim = c(-0.5,1))+\n  theme_void()+\n  theme(plot.background = element_blank(),\n        panel.background = element_blank())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_plot<-ggplot() + \n    geom_polygon(data= mapworld_df%>%\n                   filter(!id==\"Antarctica\"), \n                 aes(long,lat, group=group), fill=\"#2B1A15\",color= \"#BFBAB9\",size=0.2) +\n    geom_point(data = chocolate3, \n                 aes(x = long_orig, y = lat_orig),\n                 color=\"#dfc27d\",size=3,alpha=0.3) +\n   geom_point(data = chocolate3, \n                 aes(x = long_loc, y = lat_loc),\n                 color=\"blue\",size=0.5) +\n  geom_segment(data = chocolate3, \n               aes(x = long_orig, y = lat_orig, \n                   xend = long_loc, yend = lat_loc, alpha=n.y,color=n.y),\n               size=0.05)+ # ,arrow = arrow(length = unit(0.01, \"npc\"))\n   geom_text(data=text,family=family,\n            aes(x=long,y=lat,label=country),color=\"#F07518\", #d2691e\n            vjust=\"top\",hjust=\"right\",size=3,check_overlap = T)+\n  \n  scale_colour_distiller(palette=\"BrBG\", name=\"Frequency\", guide = \"colorbar\") +\n  scale_alpha(range=c(0.8,1))+\n  guides(alpha=\"none\")+\n  labs(title=\"Cocoa's Countries of Origins and Production map\",\n       caption=\"DataSource: Flavors of Cacao | DataViz: Federica Gazzelloni\")+\n  ggthemes::theme_map()+\n  theme(text = element_text(color=\"#d2691e\",family=family),\n        plot.background = element_rect(color=\"#54504d\",fill=\"#54504d\"),# BFBAB9 #282625\n        panel.background = element_rect(color=\"#54504d\",fill=\"#54504d\"),\n        legend.background = element_blank(),\n        plot.title = element_text(hjust = 0.5,size=28),\n        plot.caption = element_text(size=10))\n\nlibrary(cowplot)\n\n\nfinal<-ggdraw()+\n  draw_plot(map_plot)+\n  draw_plot(circle_legend,scale=0.5,x=0.1,y=-0.3)+\n  draw_image(here::here(\"R_general_resources/TidyTuesday/data/2022/w3_chocolate/image1.png\"),\n             x=-0.3,y=-0.41,scale=0.23,clip = \"inherit\")+\n  draw_image(here::here(\"R_general_resources/TidyTuesday/data/2022/w3_chocolate/image2.png\"),\n             x=0.35,y=0.42,scale=0.2,clip = \"inherit\")+\n  draw_image(here::here(\"R_general_resources/TidyTuesday/data/2022/w3_chocolate/image2.png\"),\n             x=-0.35,y=0,scale=0.2,clip = \"inherit\")+\n  draw_label(\"Origin\",x=0.48,y=0.08,fontfamily = family,color=\"#F07518\",size=8)+\n  draw_label(\"Production\",x=0.65,y=0.08,fontfamily = family,color=\"#F07518\",size=8)+\n  draw_label(\"Origin & Production\",x=0.56,y=0.08,fontfamily = family,color=\"#F07518\",size=8)+\n  draw_label(\"data contains values for Martinique and Samoa not mentioned in this map\",x=0.56,y=0.05,color=\"#F07518\",size=8,fontfamily = family)\n\nggsave(\n   \"w3_chocolate.png\",\n   plot =final,\n  bg=\"white\",\n  dpi = 320,\n  width = 11,\n  height = 6\n)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}