{
  "hash": "45051bf90aa455e338f392366db4211b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Colour Friday: Blue'\nsubtitle: 'Welcome to #30DayMapChallenge 2022 day 18'\ndate: '2022-11-18'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2022/day18_color_friday_blue/day18_color_friday_blue.png'\nimage-alt: ''\ndescription: ''\noutput: html_document\nexecute: \n   eval: false\n---\n\n# Overview\n\nThis a map of `Milan, Italy` with religious locations. Data is from the `{osmdata}` package.\n\n\n\nSet the fonts\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(showtext)\nlibrary(sysfonts)\nlibrary(extrafont)\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi=320)\nfont_add_google(name=\"Gideon Roman\",\n                family=\"Gideon Roman\")\n```\n:::\n\n\nLoad libraries for data manipulation\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n# search for data\nlibrary(osmdata)\n```\n:::\n\n\n\n\nSome important functions are: \n  \n- getbb()             Get bounding box\n- opq()               Build an Overpass query\n- add_osm_feature()   Add a feature\n- osmdata_sf()        Return an object in sf format\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlocation <- \"Milan\"\ngetbb(location)\n# min      max\n# x  9.040887  9.27811\n# y 45.386738 45.53585\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\navailable_features()\nfeature <- \"religion\"\navailable_tags(feature)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nms <- opq(c(9.040887,45.386738,9.27811,45.53585)) %>% \n  add_osm_feature (key = feature) %>%\n  osmdata_sf (quiet = FALSE)\n\n# save(ms,file=\"data/ms.RData\")\nload(\"ms.RData\")\nms\n```\n:::\n\n\n\n\nTutorials:\n\n- <https://ggplot2tutor.com/tutorials/streetmaps>\n- <https://joshuamccrain.com/tutorials/maps/streets_tutorial.html>\n- <https://taraskaduk.com/posts/2021-01-18-print-street-maps/>\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstreets <- opq(c(9.040887,45.386738,9.27811,45.53585)) %>% \n  add_osm_feature(key = \"highway\", \n                  value = c(\"motorway\", \"primary\", \n                            \"secondary\", \"tertiary\")) %>%\n  osmdata_sf()\n# save(streets,file=\"data/streets.RData\")\nload(\"data/streets.RData\")\nstreets\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmall_streets <-  opq(c(9.040887,45.386738,9.27811,45.53585)) %>% \n  add_osm_feature(key = \"highway\", \n                  value = c(\"residential\", \"living_street\",\n                            \"unclassified\",\n                            \"service\", \"footway\")) %>%\n  osmdata_sf()\n# save(small_streets,file=\"data/small_streets.RData\")\nload(\"small_streets.RData\")\nsmall_streets\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nriver <- opq(c(9.040887,45.386738,9.27811,45.53585)) %>% \n  add_osm_feature(key = \"waterway\", value = \"river\") %>%\n  osmdata_sf()\n\n# save(river,file=\"data/river.RData\")\nload(\"river.RData\")\nriver\n```\n:::\n\n\nMake the map\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = streets$osm_lines,\n          inherit.aes = FALSE,\n          color = \"#7b9aca\",\n          linewidth = .04,\n          alpha = .8) +\ngeom_sf(data = small_streets$osm_lines,\n          inherit.aes = FALSE,\n          color = \"navy\",\n          linewidth = .03,\n          alpha = .8) +\n  geom_sf(data = river$osm_lines,\n          inherit.aes = FALSE,\n          color = \"#bfd0dd\",# \"#33dbe7\",\n          linewidth = 1.5,\n          alpha = .8) +\n  geom_sf(data = ms$osm_points,\n          inherit.aes = FALSE,\n          color = \"grey40\",\n          shape=21,\n          stroke=0.1,\n          size = 1,\n          alpha = .8) +\n  geom_sf(data = ms$osm_points,\n          inherit.aes = FALSE,\n          color = \"#043c6e\",\n          size = 0.05,\n          alpha = .8) +\n    # (9.040887,45.386738,9.27811,45.53585)\n  coord_sf(xlim=c(9.040887,9.27811),\n           ylim=c(45.386738,45.53585),\n           expand = FALSE) +\n  theme_void()+\n  theme(text=element_text(family=\"Gideon Roman\"),\n        plot.background = element_rect(fill=\"white\",color=\"#043c6e\",linewidth=0.5),\n        panel.background = element_rect(fill=\"white\",color=\"#043c6e\",linewidth=1),\n        plot.margin = margin(10,10,40,10,unit = \"pt\"))\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# save the base map\nggsave(\"base_map.png\", width = 6, height = 6)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# draw the map-viz\nlibrary(cowplot)\n\nggdraw()+\n  draw_image(\"base_map.png\")+\n  draw_line(x=c(0.03,0.97),y=c(0.169,0.169),\n            size=20,color=\"#bfd0dd\",alpha=0.5)+\n  draw_line(x=c(0.3,0.7),y=c(0.22,0.22),\n            size=1,color=\"#043c6e\")+\n  draw_label(\"Milan\",\n             x=0.5,y=0.19,\n             size=14.5,\n             color=\"#043c6e\",\n             fontface = \"bold\",\n             fontfamily = \"Gideon Roman\")+\n  draw_label(\"45°27'52.7904''N / 9°11'18.7440''E\",\n             x=0.5,y=0.149,\n             color=\"#043c6e\",\n             size=5,\n             fontfamily = \"Gideon Roman\") +\n  draw_label(\"OSM key: Religion\",\n             x=0.5,y=0.125,\n             color=\"#043c6e\",\n             size=4,\n             fontfamily = \"Gideon Roman\") +\n  draw_label(\"#30DayMapChallenge 2022 Day 18: Color Friday Blue\\nDataSource: {osmdata}: Milan, Italy | Map: Federica Gazzelloni (@fgazzelloni)\",\n             x=0.5,y=0.07,\n             size=4,\n             color=\"#043c6e\",\n             lineheight = 1.8,\n             fontfamily = \"Gideon Roman\")\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# save final version\nggsave(\"day8_openstreetmap.png\", \n       dpi=180,\n       width = 5.6, \n       height = 5.6,\n       bg=\"white\")\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}