{
  "hash": "a1668b1831d55cee2b365f7eff046615",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Paralympic\"\nsubtitle: \"Welcome to TidyTuesday 2021 week 32\"\ndate: \"2021-08-03\"\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/TidyTuesday/ab924a20bbe270bab306f4b13df0daaa6e53ffeb/data/2021/w32_paralympic/w32_paralympic.png'\ndescription: \"Networks\"\noutput: html_document\nexecute: \n  eval: false\n---\n\nTo set the `search()` function to check the kind of packages installed in the session:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nold <- search()\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\nlibrary(extrafont)\n# loadfonts() # to do just once at the beginning of the session\n```\n:::\n\n\n\nLoad this week data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2021, week = 32)\ntidytuesdayR::readme(tuesdata)\nathletes <- tuesdata$athletes\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(athletes)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(athletes,3)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDataExplorer::profile_missing(athletes)\n```\n:::\n\n\n\nSee the sports for the Paralympic Games:\na total of 11 sports takes place with an avg of 8 each four year round\n8,9,9,9,10,10,10,10,10,11\n\n::: {.cell}\n\n```{.r .cell-code}\nathletes %>% filter(year==\"2016\") %>%count(type) %>% arrange(-n)\n```\n:::\n\n\nSee which country \"abbreviation\" are missing:\n49 rows, 1996 Gold\t1\n\n::: {.cell}\n\n```{.r .cell-code}\nathletes %>% filter(is.na(abb)) %>% count(medal)\n```\n:::\n\n\nWhich Country won the Gold medal at the Paralympic in 1996 with Wheelchair Rugby ?\n\n- USA Rugby was the only US “Team Sport” to capture Gold during the 1996 Summer Paralympics.\n\nsource: [Wheelchair rugby at the Summer Paralympics](https://en.wikipedia.org/wiki/Wheelchair_rugby_at_the_Summer_Paralympics)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nathletes %>% filter(is.na(abb)) %>% count(gender,type,medal,year)%>%arrange(-year)\n```\n:::\n\n\n\nFill the row with the information above:\n\n::: {.cell}\n\n```{.r .cell-code}\nid <- row.names(athletes)\n\nathletes <- cbind(id,athletes)\n\nathletes[athletes$id==\"9796\",\"abb\"]<-\"USA\"\n\n\nathletes%>%filter(abb==\"USA\" & year==\"1996\" & medal==\"Gold\",type==\"Rugby\") \n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nathletes %>% filter(is.na(abb)) %>% count(id,gender,type,medal,year)%>%count(medal,year)\n```\n:::\n\n\nIn 1980 the USA won 75 Gold medals as well as Poland, while West Germany won just 68 Gold medals. \n\n[source](https://en.wikipedia.org/wiki/1980_Summer_Paralympics_medal_table)\n\nTo see effectively who are the countries who have won the Paralympic and fill the gaps found, the best way is to check it by the year.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nathletes %>% filter(year==\"1980\") %>% count(medal,abb==\"USA\")\n```\n:::\n\n\n\nLoad the Olympic Games data from last TidyTuesday:\nadd the regions data to our dataset to use {ggflag} and add the round shaped flag to our geoms\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2021, week = 31)\nregions <- tuesdata$regions\n```\n:::\n\n\nSet up the full dataset with some minor changes:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nathletes_full <- athletes %>%\n  mutate(gender=case_when(gender==\"Mixed\" ~ \"Mixed team\",\n                          TRUE ~ gender)) %>%\n  inner_join(regions,by=c(\"abb\"=\"NOC\")) %>%\n  select(year,abb,country,region,type,gender,medal,event,athlete) %>%\n  mutate(abb=tolower(abb),country=tolower(country))\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDataExplorer::profile_missing(athletes_full)\n```\n:::\n\n\n\nJust a double chek of the \"country\" vector and then we drop it:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(athletes_full,3)\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nathletes_full %>% count(abb,country,region)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nathletes_full <- athletes_full %>%\n  select(-country) \n```\n:::\n\n\n\n10 years from 1980 to 2016 of Summer Paralympic Games:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nathletes_full %>% count(year)\n```\n:::\n\n\n\nabb: abbreviation of country region are 112 , while the region vector contains 104 countries. \n\n- China region id divided in \"chn\" and \"hkg\", only hkg has 198 events \n- Czech Republic divided in \"cze\" and \"tch\"\n- Germany divided in \"frg\", \"gdr\", \"ger\"\n- Russia divided in \"rus\" and \"urs\"\n- Serbia divided in \"scg\", \"srb\", \"yug\"\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nathletes_full %>% count(region,abb)%>%arrange(region)\n```\n:::\n\n\n\nAdd the {ggflags} package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggflags)\nlibrary(countrycode)\n```\n:::\n\n\nAssigning a new name to have the athletes_full set as back up:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_df <- athletes_full %>% \n  mutate(country_code = countrycode(region, \n            origin = 'country.name', \n            destination = 'iso2c'),\n         country_code = tolower(country_code)) %>%\n  rename(sport=type) %>%\n  select(year,region,sport,medal,country_code) \n\n\nmy_df %>% DataExplorer::profile_missing()\n```\n:::\n\n\n\n\n\nWhat we want is to make a sigmoid network with geom_segment, geom_sigmoid, and geom_flag:\nto connect the 50+ highest frequency of countries at the Paralympic Games and the same by sports and Gold medals.\n\nSet the index vectors for each variable to connect with a sigmoid and rebuild a new set:\n\n\n::: {.cell}\n\n```{.r .cell-code}\norder_year <- my_df %>%\n  count(year) %>% \n  mutate(index_year = row_number())\n\n\norder_region <- my_df %>%\n  count(region) %>% arrange(-n) %>%\n  mutate(index_region = row_number())\n\norder_sport <- my_df %>%\n  count(sport) %>% arrange(-n) %>%\n  mutate(index_sport = row_number())\n\n\norder_medal <- my_df %>%\n  count(medal) %>% arrange(-n) %>%\n  mutate(index_medal = row_number())\n\n\nmy_df_ordered <- my_df %>%\n  left_join(order_year) %>% select(-n) %>%\n  left_join(order_region) %>% select(-n) %>%\n  left_join(order_sport) %>% select(-n) %>%\n  left_join(order_medal) %>% select(-n) \n```\n:::\n\n\nAdd the groups vectors and select the first 20 regions/countries by the highest frequency:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngold_medal_sports <- my_df_ordered %>%\n  mutate(group = glue::glue(\"{year}-{region}\"),\n         group2 = glue::glue(\"{region}-{sport}\"),\n         group3 = glue::glue(\"{sport}-{medal}\"),\n         group4 = glue::glue(\"{region}-{medal}\"))\n         \n\nfirst_20_regions<- gold_medal_sports %>% \n  count(region) %>% \n  arrange(-n) %>% \n  filter(n>=259) %>% \n  select(-n) %>% \n  unlist()\n```\n:::\n\n\nMake three more dataset for selected sigmoids data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsig_short <- gold_medal_sports %>% \n  filter(region %in% first_20_regions)# & year==2016)#  & region==c(\"UK\",\"Italy\",\"USA\")) \n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsig_short_gold <- sig_short%>%filter(medal==\"Gold\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsig_short_gold_yr <- sig_short %>% \n  filter(medal==\"Gold\") %>% \n  count(year,region,index_year,index_region,group) %>% \n  arrange(-n) %>%\n  filter(n>=50)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsig_short_gold_sport <- sig_short %>% \n  filter(medal==\"Gold\") %>% \n  count(region,sport,index_region,index_sport,group2) %>% \n  arrange(-n) %>%\n  filter(n>=50)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(scales)\nlibrary(ggbump)\nlibrary(extrafont)\nlibrary(showtext)\nlibrary(cowplot)\nlibrary(ggstream)\nlibrary(colorspace) \nlibrary(ggpubr)\n\n## Automatically use showtext to render text for future devices\nshowtext_auto()\n\n## Tell showtext the resolution of the device,\n## only needed for bitmap graphics. Default is 96\nshowtext_opts(dpi = 320)\n\n## Loading Google fonts (https://fonts.google.com/)\n\nfont_add_google(\"Oswald\", \"oswald\")\nfont_add_google(\"Rock Salt\", \"rock\")\nfont_add_google(\"Amatic SC\" , \"amatic\")\n\n\nfont_add_google(\"Share Tech Mono\", \"techmono\")\nfont_add_google(\"Roboto Condensed\", \"roboto condensed\")\nfont_add_google(\"Gochi Hand\", \"gochi\")\nfont_add_google(\"Schoolbell\", \"bell\") # title\nfont_add_google(\"Covered By Your Grace\", \"grace\")\n\n\n\n\n\nbackground <- \"red\"\ntext_color <- \"grey50\"\n\npalette <- c(\"#0286c3\" , lighten(\"#0286c3\" , 0.5)  , \n             \"#fbb22e\" , lighten( \"#fbb22e\" , 0.5) , \n             \"#168c39\" , lighten(\"#168c39\" , 0.5)  ,\n             \"#ee2f4d\" , lighten(\"#ee2f4d\" , 0.5)  )\n```\n:::\n\n\n\n\nOlympic Games color palettes:\nsource: [palettes](https://media.specialolympics.org/resources/brand-awareness-and-communication/branding/brand-guidelines/Brand-Identity-Color-Palette.pdf)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolor_paralympics <- c(\"#FF0000\",\"#C4161C\",\"#820000\",\"#ec008c\",\"#c40063\",\"#8B0037\",\"#92278F\",\"#6F2C91\",\"#3D1063\",\n                  \"#0095da\",\"#0063A5\",\"#013B82\",\"#39bb9d\",\n                  \"#39bb9d\",\"#00695E\",\"#B2D235\",\"#88ac2e\",\"#28752B\",\n                  \"#ffd400\",\"#e5A812\",\"#B18906\",\"#f7941E\",\n                  \"#E66A1F\",\"#985006\")\n```\n:::\n\n\n\nMake the sigmoid network:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npara_plot <- ggplot(data=sig_short) +\n  \n  geom_text(\n    aes(x = -2.9, y = index_year+5, label = year), vjust=0, hjust=\"left\", color = \"red\", size = 4.5,family = \"oswald\") +\n\n  geom_text(\n    aes(x = -0.65, y = index_region, label = region), vjust=0, hjust=\"center\", color = \"red\", size = 4.5,family = \"oswald\") +\n  \n  geom_text(aes(x = 1.75, y = index_sport+5, label = sport),family = \"oswald\", hjust=\"center\", vjust=0, color = \"red\", size = 4.5) +\n  \n  geom_text(aes(x = 3.25, y = index_medal+10, label = medal),family = \"oswald\", hjust=0, vjust=0, color = \"red\", size = 4.5) +\n  \n  #################\n  # first sigmoid connecting years to regions\n  \n   geom_point(data = sig_short_gold, aes(x = -2.7, y = index_year+5), color = \"gold\", size = 2, inherit.aes = FALSE) +\n  \n  geom_sigmoid(\n     aes(x = -2.7, xend = -1, y = index_year+5, yend =index_region, group=factor(group)), color = \"#DCDCDC\") + \n  \n  geom_point(data = sig_short_gold, aes(x = -1, y = index_region), shape = 21, colour = \"gold\", fill = NA, size = 7, stroke = 1,inherit.aes = FALSE) +\n  \n  geom_sigmoid(data=sig_short_gold_yr,\n     aes(x = -2.7, xend = -1, y = index_year+5, yend =index_region, group=factor(group),color = region)) +\n  \n\n  ggflags::geom_flag(data = sig_short_gold, aes(x = -1, y = index_region, country = country_code), size=4.5) +\n  \n  ggflags::scale_country() +\n  guides(country=\"none\") +\n  \n  \n  #################\n  # second sigmoid to connect regions to sports\n  \n\n  geom_point(data = sig_short_gold, aes(x = -0.4, y = index_region),color = \"gold\", size = 2, inherit.aes = FALSE) +\n  \n  geom_sigmoid(\n     aes(x = -0.4, xend = 1.4, y = index_region, yend =index_sport+5, group=factor(group2)),color = \"#DCDCDC\") +\n  \n  geom_point(data = sig_short_gold, aes(x = 1.4, y = index_sport+5), color = \"gold\", size = 2, inherit.aes = FALSE) +\n  \n  geom_sigmoid(data=sig_short_gold_sport,\n     aes(x = -0.4, xend = 1.4, y = index_region, yend =index_sport+5, group=factor(group2),color = sport)) +\n \n  \n  ################### \n  # third sigmoid to connect sports to medals\n\n\n  geom_point(data = sig_short_gold, aes(x = 2.10, y = index_sport+5), color = \"gold\", size = 2, inherit.aes = FALSE)+\n  \n  geom_sigmoid(\n     aes(x = 2.10, xend = 3.15, y = index_sport+5, yend =index_medal+10, group=factor(group3)),color = \"#DCDCDC\") +\n  \n  geom_point(data = sig_short_gold, aes(x = 3.15, y = index_medal+10, color = medal), shape = 21, colour = \"gold\", fill = NA, size = 7, stroke = 1, inherit.aes = FALSE) +\n\n  geom_sigmoid(data = sig_short_gold,\n     aes(x = 2.10, xend = 3.15, y = index_sport+5, yend =index_medal+10, group=factor(group3), color = sport)) +\n  \n  \n  #####################\n\n  \n  ylim(0,200) +\n  xlim(-5,4) +\n  scale_y_reverse() +\n  scale_color_manual(values = color_paralympics) +\n  theme_void() +\n  theme(plot.background = element_blank(),\n        panel.background = element_blank(),\n        legend.position = \"none\")\n\n\n\nimg_olympics<-\"https://www.pngall.com/wp-content/uploads/2017/05/Olympic-Rings-Download-PNG.png\"\n\nsigmoid <- ggimage::ggbackground(para_plot, img_olympics,alpha=.2, color=\"#CD919E\")\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfinal <- ggdraw(\n  sigmoid \n  ) + \n  ggtitle(label=\"Paralympic Games: from 1980 to 2016\") +\n  theme_void() +\n  theme(\n    text = element_text(color = text_color , face = \"bold\"),\n    plot.title = element_text(family = \"amatic\" , size = 40 , hjust = 0.24,vjust=2),\n    axis.title = element_blank(),\n    axis.text.y = element_blank(),\n    panel.grid.minor = element_blank(),\n    panel.grid.major = element_blank(),\n    plot.margin = margin(1,0,1,0, unit = \"cm\"),\n    plot.title.position = \"panel\") +\n  \n    annotate(geom = \"text\" , label = \"Source: Paralympic Medals, IPC, kaggle.com | Graphic: @fgazzelloni\" , x = 0.5 , y = 0 , family = \"rock\" , size = 6) +\n  \n    annotate(\"text\",label=\"The Paralympic Games or Paralympics is the largest international event for disabled athletes \\nand societal change and take place shortly after every Olympic Games in the same host city. \\nThe Paralympic Games are held every two years\", size=2.5,x = 0.78, y = 0.97,family=\"rock\") +\n    \n   annotate(\"text\",label=\"In 1980 the USA won 75 Gold medals \\nas well as Poland, while\\n West Germany won just 68 Gold medals.\", size=3,x = 0.14, y = 0.6,family=\"rock\") + \n    \n   annotate(\"text\",label=\"Which Country won the Gold medal at the Paralympic \\nin 1996 with Wheelchair Rugby ?\\nUSA Rugby was the only US “Team Sport” to capture \\nGold during the 1996 Summer Paralympics.\", size=3,x = 0.15, y = 0.2,family=\"rock\") +\n  \n   annotate(\"text\",label=\"Sigmoid network of the years, countries, sports and medals\", size=3,x = 0.8, y = 0.1,family=\"rock\") +\n  \n   annotate(\"text\",label=\"Countries with the highest frequency in participation\", size=3,x = 0.23, y =0.9,family=\"rock\") +\n  \n# annotate images\ndraw_image(image = (\"Olympic-Torch-PNG-Free-Download.png\"),\n             #\"https://www.pngall.com/wp-content/uploads/2017/05/Olympic-Rings-Download-PNG.png\",\n           x = -0.05 , y = 0.65 , height = 0.45 , width = 0.25) +\n  draw_image(image = \"https://camo.githubusercontent.com/1411a00ca19fc49c4b0099d26246d261baafd979a76c007ae835984f8c1ae3d2/68747470733a2f2f7777772e706172616c796d7069632e6f72672f73697465732f64656661756c742f66696c65732f7374796c65732f6c617267655f6f726967696e616c2f7075626c69632f323031392d31302f4950432532304e4557253230454d424c454d2e4a50473f69746f6b3d5f46534a62623651\",\n           x = 0.55 , y = 0.78 , height = 0.08 , width = 0.25)\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nragg::agg_png(\"w32_paralympic.png\",\n              res = 320, width = 14, height = 8, units = \"in\")\nfinal\n\ndev.off()\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read the image, attach the Tidytuesday logo and save it --------------------------\nlibrary(ggimage)\nlibrary(magick)\n\n\ntidy_logo<-image_read(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/static/plot_logo.png\") %>%\n  image_resize(\"300x300\")\n\n\ntidy_final <- image_read(\"w32_paralympic.png\")\n\nattached_logo <- image_composite(tidy_final, tidy_logo,\n                                 operator=\"atop\",\n                                 gravity=\"northeast\") # tell R where to put the logo\n\n\nimage_write(attached_logo, path = \"w32_paralympic.png\", format = \"png\") # save final plot\n```\n:::\n\n\n\n\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}