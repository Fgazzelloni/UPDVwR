{
  "hash": "bdfc8108055197f8172719400782857d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'NYTimes best sellers'\nsubtitle: 'Welcome to #TidyTuesday 2022 day 19'\ndate: '2022-05-10'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/TidyTuesday/main/data/2022/w19_nyt/w19_nyt.png'\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n\n\n### Housekeeping: clean the space before to start and set the working dorectory to your .R file source\nrm(list=ls())\nsetwd(dirname(rstudioapi::getActiveDocumentContext()$path))\n\n::: {.cell}\n\n```{.r .cell-code}\n# load the libraries\nlibrary(tidyverse)\nlibrary(forcats)\nlibrary(ggridges)\nlibrary(showtext)\nlibrary(cowplot)\n\n# set the font\nshowtext_auto(enable = T)\nsysfonts::font_families_google()\nsysfonts::font_add_google(\"Abril Fatface\", \"Abril Fatface\")\n\n\n# load data\nnyt_titles <- readr::read_tsv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-05-10/nyt_titles.tsv')\nnyt_full <- readr::read_tsv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-05-10/nyt_full.tsv')\n\n# look at the data\nnyt_titles%>%head\nnyt_full%>%head\n\n# a bit of wrangling\ndf <- nyt_titles %>%\n  full_join(nyt_full,by=c(\"year\",\"title\",\"author\"))\n\ndf2 <- df %>%\n  mutate(year_fct = fct_rev(as.factor(year))) %>% # \n  filter(!str_detect(author,\"Edited|edited|created|compiled|Completed|NO AUTHOR| and |Illustrated| with |translated\"))%>%\n  mutate(author=gsub(\"! by |? by |?by |\\\\?|\\\"|, Jr| Jr|\\\\.$| writing as.*\",\"\",author)) %>%\n  group_by(author) %>%\n  summarise(year_fct,\n            avg_rank=mean(rank),\n            scale=scale(rank,center = F),\n            scale_pct=scale/sum(scale),\n            avg_rank_pct=avg_rank/sum(avg_rank),\n            id=n()) %>%\n  ungroup()\n\n# set the dataset for the geom_text labels\nside_labels <- df2 %>%\n  group_by(year_fct,author)%>%\n  summarize(top=max(scale),scale_pct=mean(scale_pct))%>%\n  distinct()%>%\n  filter(top==max(top))%>%\n  mutate(lab=paste(author,\"in\",year_fct),\n         lab2=paste(author,\"ranked\",round(top),\"on avg in\",year_fct))%>%\n  ungroup() %>%\n  select(year_fct,lab,scale_pct)%>%\n  arrange(desc(year_fct))\n\n\n\n# make the plot\ndf2 %>% \n  # reorder different authors within the same year along with the percentages values\n  # this will reorder the density courves for each year \n  mutate(author=fct_reorder(author,scale_pct)) %>%\n  ggplot(aes(x=scale_pct, y=year_fct)) +\n  geom_density_ridges(aes(fill=author),\n                      show.legend = F,\n                      size=0.3,\n                      scale=1,\n                      alpha = .8, \n                      color = \"grey25\", \n                      from = 0, to = 1) +\n  geom_label(data=side_labels,\n             aes(x=0.5,y=year_fct,label=lab),\n             label.padding = unit(0.05, \"lines\"),\n             label.r = unit(0.5, \"lines\"),\n             label.size = 0,\n             family=\"Abril Fatface\",size=10,\n             inherit.aes = F,hjust=0,vjust=0)+\n  scale_y_discrete(expand = c(0, 0)) +\n  scale_x_continuous(expand = expansion(mult=c(0,-0.35),\n                                        add=c(0, -0.02))) +\n  scale_fill_grey(\n    start = 0.2,\n    end = 0.9,\n    na.value = \"red\",\n    aesthetics = \"fill\") +\n  labs(title=\"The New York Times\",\n       subtitle=\"Solo author ranks from 1931 to 2020\",\n       caption=\"DataSource: Post45 Data Collective NYT HARDCOVER FICTION BESTSELLERS\\nDataViz: Federica Gazzelloni (@fgazzelloni)\",\n       x=\"Rank density\",y=\"Year\") +\n  coord_cartesian(clip = \"off\") +\n  theme_ridges(grid = FALSE)+\n  theme(text = element_text(family=\"Abril Fatface\",size=45),\n        plot.title = element_text(size=90),\n        plot.caption = element_text(hjust=1),\n        axis.text.y = element_text(size=30,hjust=0),\n        axis.text.x = element_blank(),\n        axis.ticks.x = element_blank(),\n        plot.background = element_rect(color=\"grey90\",fill=\"grey90\"),\n        panel.background = element_rect(color=\"grey90\",fill=\"grey90\"))\n\n# save first partial version\nggsave(\"partial.png\",\n       dpi=320,\n       height = 14,\n       width =  10)\n\n# frame the graphics and add a notation with {cowplot}\n# it helps reducing time when setting the text position.\nggdraw()+\n  draw_image(\"partial.png\") +\n  draw_label(\"How to read it: \nOn average, authors rank 7.6 based on weekly frequencies on NYT, \nwhich corresponds to 3.4% of the total scaled avg-ranks.\nEach year shown in the graph represents the density curve of the \nranks for the NYT's solo authors in that year.\nThe density curves are ordered by total percentage of scaled ranks.\nOn the right is the author with the avg-weekly highest rank for the year.\",\n             lineheight = 0.25,hjust=0,\n              x=0.04,y=0.05,fontfamily=\"Abril Fatface\",size=25)\n\n# save the final version\nggsave(\"w19_nyt.png\",\n       dpi=320,\n       height = 12,\n       width =  9)\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}