{
  "hash": "813fb948390957698d9018276b88f6d3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'OSM Map'\nsubtitle: 'Welcome to #30DayMapChallenge 2024 Day 20'\ndate: '2024-11-20'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2024/day20_osm/day20_osm.png'\nimage-alt: 'day20_osm'\ndescription: 'OSM Map'\noutput: html_document\nexecute: \n   eval: false\n---\n\n![OSM Map](https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2024/day20_osm/day20_osm.png)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(showtext)\nlibrary(sysfonts)\nlibrary(extrafont)\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi=320)\nfont_add_google(name=\"Gideon Roman\",\n                family=\"Gideon Roman\")\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load libraries for data manipulation\nlibrary(tidyverse)\n\n# search for data\nlibrary(osmdata)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlocation <- \"Rome\"\ngetbb(location)\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\navailable_features()\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfeature <- \"bicycle_road\"\navailable_tags(feature)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# bicycle_road points\nbr <- opq(c(12.23447,41.65564,12.85576,42.14103)) %>% \n  add_osm_feature(key = \"bicycle_road\") %>%\n  osmdata_sf(quiet = FALSE)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxmin <- sf::st_bbox(br$osm_points)[1]\nymin <- sf::st_bbox(br$osm_points)[2]\nxmax <- sf::st_bbox(br$osm_points)[3]\nymax <- sf::st_bbox(br$osm_points)[4]\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# saveRDS(br, file = \"data/br.RDS\")\nbr <- readRDS(\"data/br.RDS\")\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstreets <- opq(c(12.23447,41.65564,12.85576,42.14103)) %>% \n  add_osm_feature(key = \"highway\", \n                  value = c(\"motorway\", \"primary\", \n                            \"secondary\", \"tertiary\")) %>%\n  osmdata_sf()\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(streets, file = \"data/streets.RDS\")\nstreets <- readRDS(\"data/streets.RDS\")\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmall_streets <- opq(c(xmin,ymin,xmax,ymax)) %>% \n  add_osm_feature(key = \"highway\", \n                  value = c(\"residential\", \"living_street\",\n                            \"unclassified\",\n                            \"service\", \"footway\")) %>%\n  osmdata_sf()\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nriver <- opq(c(xmin,ymin,xmax,ymax)) %>%\n  add_osm_feature(key = \"waterway\", value = \"river\") %>%\n  osmdata_sf()\n```\n:::\n\n\n\n\nMake the map\n\nThe latitude of Rome, Italy is 41.902782, and the longitude is 12.496366.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n geom_sf(data = streets$osm_lines,\n         inherit.aes = FALSE,\n         color = \"white\",\n         linewidth = .5,\n         alpha = .8) +\n geom_sf(data = small_streets$osm_lines,\n         inherit.aes = FALSE,\n         color = \"grey20\",\n         linewidth = .1,\n         alpha = .8) +\n    geom_sf(data = br$osm_lines,\n          inherit.aes = FALSE,\n          color = \"grey20\") +\n    geom_sf(data = br$osm_points,\n          inherit.aes = FALSE,\n          color = \"red\",\n          size = 1,\n          alpha = .8) +\n  coord_sf(xlim=c(xmin,xmax),\n         ylim=c(ymin,ymax),\n           expand = FALSE) +\n  theme_void()+\n  theme(text=element_text(family=\"Gideon Roman\"),\n        plot.background = element_rect(fill=\"white\",linewidth=0.5),\n        panel.background = element_rect(fill=\"#dbd3c5\",linewidth=1),\n        plot.margin = margin(10,10,40,10,unit = \"pt\"))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(sf)\nlibrary(cowplot)\n\n# Main Map: Detailed View\nmain_map <- ggplot() +\n geom_sf(data = streets$osm_lines,\n         inherit.aes = FALSE,\n         color = \"white\",\n         linewidth = .5,\n         alpha = .8) +\n geom_sf(data = small_streets$osm_lines,\n         inherit.aes = FALSE,\n         color = \"grey20\",\n         linewidth = .1,\n         alpha = .8) +\n    geom_sf(data = br$osm_lines,\n          inherit.aes = FALSE,\n          color = \"grey20\") +\n    geom_sf(data = br$osm_points,\n          inherit.aes = FALSE,\n          color = \"red\",\n          size = 1,\n          alpha = .8) +\n  coord_sf(xlim=c(xmin,xmax),\n         ylim=c(ymin,ymax),\n           expand = FALSE) +\n  theme_void()+\n  theme(text=element_text(family=\"Gideon Roman\"),\n        plot.background = element_rect(fill=\"white\",linewidth=0.5),\n        panel.background = element_rect(fill=\"#dbd3c5\",linewidth=1),\n        plot.margin = margin(10,10,40,10,unit = \"pt\"))\n\n# Inset Map: Overview of the Region\ninset_map <- ggplot() +\n geom_sf(data = streets$osm_lines,\n         inherit.aes = FALSE,\n         color = \"grey20\",\n         linewidth = .07,\n         alpha = .8) +\n  geom_sf(data = br$osm_points,\n          inherit.aes = FALSE,\n          color = \"red\",\n          size = 1,\n          alpha = .8) +\n  labs(caption=\"Rome\")+\n  theme_void() +\n  theme(text = element_text(family = \"Gideon Roman\"),\n        panel.background = element_rect(fill = alpha(\"white\",alpha = 0.1),\n                                        linewidth = 0),\n        plot.background = element_rect(fill = alpha(\"white\",alpha = 0.1),\n                                       linewidth = 0))\n\n# Combine Main Map with Inset Map\ncombined_map <- ggdraw() +\n  draw_plot(main_map) +\n  draw_plot(inset_map, x = 0.7, y = 0.7, \n            width = 0.3, height = 0.25)  +\n   draw_line(x=c(0.055,0.945),y=c(0.169,0.169),\n            size=20,\n            color=\"#dedede\",\n            alpha=0.7)+\n  draw_line(x=c(0.3,0.7),y=c(0.22,0.22),\n            size=1)+\n  draw_label(\"Bicycle Road\",\n             x=0.5,y=0.19,\n             size=14.5,\n             fontface = \"bold\",\n             fontfamily = \"Gideon Roman\")+\n  draw_label(\"41.9027°N/12.4964°E\",\n             x=0.5,y=0.149,\n             size=6,\n             fontfamily = \"Gideon Roman\",\n             fontface = \"bold\") +\n  draw_label(\"OSM key: Bicycle Road\",\n             x=0.5,y=0.125,\n             size=5,\n             fontfamily = \"Gideon Roman\") +\n  draw_label(\"#30DayMapChallenge 2024 Day 20: osmdata\\nDataSource: {osmdata}: Rome, Italy | Map: Federica Gazzelloni (@fgazzelloni)\",\n             x=0.5,y=0.07,\n             size=5,\n             lineheight = 1.5,\n             fontfamily = \"Gideon Roman\")\n\ncombined_map\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# save the base map\nggsave(\"day20_osm.png\", \n       dpi=320,\n       width = 10, \n       height = 6,\n       bg=\"white\")\n```\n:::\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}