{
  "hash": "0f4cd4c1e978f6feb13b96496b097563",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Polygons'\nsubtitle: 'Welcome to #30DayMapChallenge 2025 day 3'\ndate: '2025-11-03'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/refs/heads/master/2025/day3_polygons/day3_polygons.png'\nimage-alt: 'global robinson projection map of polygons'\ndescription: 'Working with polygons and global projections'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n![Global polygon data for mapping disease burden (DALYs) worldwide - Robison Projection](https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/refs/heads/master/2025/day3_polygons/day3_polygons.png)\n\n## Overview\n\nData for this challenge comes from the `{hmsidwR}` package, which includes **global polygon data for mapping disease burden (DALYs) worldwide**.\n\n### Load Libraries and Data\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(hmsidwR)\nlibrary(sf)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(idDALY_map_data)\n```\n:::\n\n\nTo gain more info about the data:\n\n    ?idDALY_map_data\n    \n\n::: {.cell}\n\n```{.r .cell-code}\nplot(idDALY_map_data)\n```\n:::\n\n\n### Working with Global Projections and Polygons\n\nTo plot the map's polygons to work properly in a different global projection such as the **Robinson projection**, some preprocessing is needed.\n\nWhen I first plotted the global polygons under Robinson projection, I noticed strange lines crossing Russia and the equator. These were caused by polygons that were invalid or crossed the ±180° meridian, a common issue in global datasets where countries span the dateline.\n\nTo fix this, I followed a few steps:\n\n1.\tMake sure the geometries are right with `st_make_valid()`, this removes self-intersections and other inconsistencies.\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. Make valid (repairs self-intersections)\nidDALY_clean <- st_make_valid(idDALY_map_data)\n```\n:::\n\n2.\tSplit multipolygons into individual polygon parts using `st_cast()`, ensuring that each island or country segment was treated separately.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 2. Break apart multipolygons into individual polygon pieces\nidDALY_clean <- idDALY_clean |>\n  st_cast(\"MULTIPOLYGON\") |>\n  st_cast(\"POLYGON\", warn = FALSE)\n```\n:::\n\n3.\tWrapped polygons at the dateline with `st_wrap_dateline()`, so that shapes crossing the ±180° longitude were properly split and would not draw straight lines across the map.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 3. Split polygons that cross the dateline\nidDALY_clean <- st_wrap_dateline(idDALY_clean, options = c(\"WRAPDATELINE=YES\", \"DATELINEOFFSET=180\"))\n```\n:::\n\n4.\tReprojected to Robinson with `st_transform()`, so the data could be displayed correctly on a flat, visually pleasing projection.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 4. Reproject to Robinson\nidDALY_robin <- st_transform(idDALY_clean, \"+proj=robin\")\n```\n:::\n\n5.\tAssigned unique polygon IDs to maintain proper grouping in ggplot2.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 5. Assign a unique polygon id for grouping\nidDALY_robin <- idDALY_robin |>\n  mutate(poly_id = row_number())\n```\n:::\n\n\nThese steps removed the unwanted lines and allowed the polygons to render smoothly in any projection, giving a clean, accurate global map for the Day 3 challenge.\n\n\nFinally, I plotted the cleaned and reprojected polygons:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 6. Plot\nggplot(idDALY_robin) +\n  geom_sf(aes(fill = location_name, \n              group = poly_id), \n          show.legend = FALSE,\n          color = NA) +\n  coord_sf(crs = st_crs(idDALY_robin)) +\n  theme_void() +\n  scale_fill_viridis_d(option = \"C\") +\n  labs(title = \"#30DayMapChallenge 2025 — Day 3: Polygons\",\n       caption = \"Data: hmsidwR | Projection: Robinson - Geometry repaired\\nMap: Federica Gazzelloni\") +\n  theme(plot.title = element_text(face = \"bold\", hjust = 0.5),\n        plot.caption = element_text(size = 8, \n                                colour = \"grey40\", hjust = 0.5))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"day3_polygons.png\", height = 4, width = 6, dpi = 320)\n```\n:::\n\n\n\n### Explanation of the Issue with Polygons and Global Projections\n\nMost global shapefiles (like those used in {hmsidwR}) are stored in longitude/latitude (EPSG:4326), so the world is represented as coordinates ranging from `-180° to +180°`.\n\nBut here’s the catch:\n\n- Countries like Russia, USA (Alaska), and Fiji span across the antimeridian (the ±180° meridian).\n- In raw coordinate form, these countries can have polygons whose edges go from +179° → -179°, which looks fine on a globe but breaks on a flat map.\n- When you reproject such data (for example, to the Robinson projection), the reprojection algorithm doesn’t *wrap* those edges, it literally draws a straight line between +179° and -179°, which slices across the map (through the Pacific, or even across the equator).\n\n\n\t\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}