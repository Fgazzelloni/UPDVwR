{
  "hash": "b6016278762c828a31cd4972544e57b1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Lines'\nsubtitle: 'Welcome to #30DayMapChallenge 2025 day 2'\ndate: '2025-11-02'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/refs/heads/master/2025/day2_lines/day2_lines.png'\nimage-alt: 'Visualizing Global Connections Using Lines'\ndescription: 'Visualizing Global Connections Using Lines'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n![Visualizing Global Connections Using Lines](https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/refs/heads/master/2025/day2_lines/day2_lines.png)\n\n## Overview\n\nThis workflow demonstrates how to visualize connections from an origin point (e.g., Wuhan) to affected countries using different line techniques: straight lines, great-circle (curved) lines, and flight-route style curves. The goal is to illustrate line-based spatial visualization techniques in R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(hmsidwR)      # sample data: affected countries & health metrics\nlibrary(sf)           # spatial operations\nlibrary(tidyverse)    # data wrangling & plotting\nlibrary(rnaturalearth) # world map\nlibrary(ggforce)      # for curved/Bezier lines\nlibrary(geosphere)    # great-circle calculations\nlibrary(patchwork)    # combining multiple plots\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load world map and clean\nworld <- ne_countries(returnclass = \"sf\") %>%\n  filter(name != \"Antarctica\") %>%\n  st_make_valid()\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load affected countries data\ndata(\"id_affected_countries\", package = \"hmsidwR\")\n\n# Compute averages for each metric per country\nid_avg <- id_affected_countries %>%\n  group_by(location_name) %>%\n  reframe(\n    avgDALYs  = mean(DALYs),\n    avgYLLs   = mean(YLLs),\n    avgYLDs   = mean(YLDs),\n    avgDeaths = mean(Deaths)\n  )\n```\n:::\n\n\n### Join Data to World Map and Compute Centroids\n\n::: {.cell}\n\n```{.r .cell-code}\n# Join country metrics with world map\naffected_sf <- world %>%\n  inner_join(id_avg, by = c(\"name\" = \"location_name\"))\n\n# Disable s2 to avoid geometry issues\nsf_use_s2(FALSE)\n\n# Compute centroids for plotting connections\ncentroids <- st_centroid(affected_sf)\n```\n:::\n\n\n\n### Define Origin Point\n\n::: {.cell}\n\n```{.r .cell-code}\n# Wuhan 30.5928° N, 114.3052° E\n# (example origin)\norigin <- st_sfc(st_point(c(114.3052, 30.5928)), crs = 4326)\n```\n:::\n\n\n### Straight Line Connections\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create simple straight lines from origin to centroids\nlines_list <- lapply(st_geometry(centroids), function(pt) {\n  st_linestring(rbind(st_coordinates(origin), st_coordinates(pt)))\n})\n\nlines_sf <- st_sf(\n  data.frame(location = centroids$name, pop_est = centroids$pop_est),\n  geometry = st_sfc(lines_list, crs = 4326)\n)\n```\n:::\n\n\n### Make the Map\n\nSimple straight lines show direct connections from origin to each centroid. Good for basic visualization but may look unrealistic at a global scale due to map distortions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot\np1 <- ggplot() +\n  geom_sf(data = world, fill = \"grey90\", color = \"white\") +\n  geom_sf(data = lines_sf, color = \"brown\", size = 0.05) +\n  geom_sf(data = origin, color = \"darkblue\", shape = 21) +\n  geom_sf(data = centroids, aes(size = pop_est), color = \"brown\", shape = 21) +\n  scale_size_continuous(labels = ~ .x / 1e6, name = \"Population (millions)\") +\n  ggthemes::theme_map()\n\np1\n```\n:::\n\n### Great-circle Lines\n\nGreat-circle lines follow the shortest path on the globe, giving a more realistic representation of long-distance connections. The Robinson projection (+proj=robin) enhances the visual global perspective.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Great-circle interpolation (curved on globe)\nlines_list_gc <- lapply(st_geometry(centroids), function(pt) {\n  inter <- geosphere::gcIntermediate(\n    st_coordinates(origin),\n    st_coordinates(pt),\n    n = 50,             # points along the curve\n    addStartEnd = TRUE,\n    sp = TRUE\n  )\n  st_as_sf(inter)\n})\n\nlines_sf_gc <- do.call(rbind, lines_list_gc)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2 <- ggplot() +\n  geom_sf(data = world, fill = \"grey90\", color = \"white\") +\n  geom_sf(data = lines_sf_gc, color = alpha(\"brown\", 0.2), linewidth = 0.5) +\n  geom_sf(data = origin, color = \"darkblue\", shape = 21) +\n  geom_sf(data = centroids, aes(size = pop_est), show.legend = FALSE, color = \"brown\", shape = 21) +\n  coord_sf(crs = \"+proj=robin\") +\n  ggthemes::theme_map()\n\np2\n```\n:::\n\n\n### Flight-Route Curves with geom_curve()\n\nCurved lines using geom_curve() resemble flight paths. They are visually appealing and can emphasize flow/direction. The curvature parameter controls the bending.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prepare data for curves\ncentroids_df <- st_coordinates(centroids) %>%\n  as.data.frame() %>%\n  mutate(name = centroids$name)\n\norigin_df <- data.frame(X = st_coordinates(origin)[1], Y = st_coordinates(origin)[2])\n\ncurve_data <- centroids_df %>%\n  rowwise() %>%\n  mutate(\n    x = origin_df$X, y = origin_df$Y,\n    xend = X, yend = Y,\n    curvature = 0.2\n  )\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot flight-route style\np3 <- ggplot() +\n  geom_sf(data = world, fill = \"grey90\", color = \"white\") +\n  geom_curve(data = curve_data, aes(x = x, y = y, \n                                    xend = xend, yend = yend),\n             curvature = 0.2, color = alpha(\"darkblue\", 0.9), \n             linewidth = 0.05) +\n  geom_sf(data = origin, color = \"darkblue\", shape = 21) +\n  geom_point(aes(x = X, y = Y), data = origin_df, color = \"darkblue\", shape = 21) +\n  geom_sf(data = centroids, aes(size = pop_est), \n          show.legend = FALSE, color = \"brown\", shape = 21) +\n  ggthemes::theme_map() \n\np3 \n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np4 <- ggplot() +\n  geom_sf(data = world, fill = \"grey90\", color = \"white\") +\n  geom_curve(data = curve_data,\n             aes(x = x, y = y, xend = xend, yend = yend),\n             curvature = 0.2, color = alpha(\"darkblue\", 0.9),\n             linewidth = 0.05) +\n  geom_sf(data = origin, color = \"darkblue\", shape=21) +\n  geom_sf(data = lines_sf, linewidth = 0.05,color = \"brown\") +\n  geom_sf(data = centroids, aes(size=pop_est),show.legend = F,\n          color = \"brown\", \n          shape = 21) +\n  scale_linewidth(range = c(0, 0.3))+\n  ggthemes::theme_map()\n\np4\n```\n:::\n\n\n### Combined 2x2 Plot with Patchwork\n\n- Straight lines (p1): simple, fast, but less realistic globally\n- Great-circle curves (p2): realistic paths along globe curvature\n- Flight-route curves (p3/p4): aesthetically curved, suggest movement or flow\n- Combined plot: shows how different line techniques can convey connections, distances, and relative magnitudes (using circle size for population).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1 Straight lines\np1 <- p1 + labs(caption = \"Straight lines connecting\\norigin to country centroids\")\n\n# 2 Great-circle lines\np2 <- p2 + labs(caption = \"Great-circle curves: shortest path\\non the globe (Robinson projection)\")\n\n# 3 Flight-route curves (geom_curve)\np3 <- p3 + labs(caption = \"Flight-route style curves\\nusing geom_curve()\")\n\n# 4 Combined curved lines and points\np4 <- p4 + labs(caption = \"Combined visualization with\\ncurved connections and population sizes\")\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined <- (p1 + p2) / (p3 + p4) +  \n  plot_layout(guides = \"collect\") +  \n    plot_annotation(\n    title = \"Visualizing Global Connections Using Lines\",\n    caption = \"Data: hmsidwR | Techniques: straight lines, great-circle curves, flight-route curves\\nMap: Federica Gazzelloni #30DayMapChallenge 2025 - Day2 (Lines)\",\n    theme = theme(plot.title = element_text(size = 18,\n                                            face = \"bold\",\n                                            hjust = 0.5),\n                  plot.caption = element_text(size = 12, \n                                  color = \"grey40\")))\n\n\ncombined \n```\n:::\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}