{
  "hash": "27d551bda107429e3510177c409a41a4",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Pictogram'\nsubtitle: 'Welcome to #30DayChartChallenge 2021 day 2'\ndate: '2021-04-02'\nimage: 'day2_pictogram.png'\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n\n\n\n### inspired by: https://github.com/ChrisWoodsSays/TidyTuesday/tree/master/2021/2021-03-23\n\n\n\n### Load packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"pacman\")\npacman::p_load(ihme.covid,\n               tidyverse, lubridate, stringi, \n               unvotes, wesanderson)\n\n\n\nlibrary(glue)\nlibrary(patchwork)\nlibrary(ggtext)\n#library(showtext)\nlibrary(extrafont)\nlibrary(hrbrthemes)\n\n\n\n\nsetwd(here::here(\"GBD/IHME/IHME_forked/Covid19\"))\n\nihme_covid<- read.csv(\"2021-01-15/reference_hospitalization_all_locs.csv\",header=TRUE)\n\n\nit_regions<-c(\"Abruzzo\",\n              \"Valle d'Aosta\",\n              \"Puglia\",\n              \"Basilicata\",\n              \"Calabria\",\n              \"Campania\",\n              \"Emilia-Romagna\",\n              \"Friuli-Venezia Giulia\",\n              \"Lazio\",\n              \"Liguria\",\n              \"Lombardia\",\n              \"Molise\",\n              \"Piemonte\",\n              \"Sardegna\",\n              \"Sicilia\",\n              \"Marche\",\n              \"Toscana\",\n              \"Umbria\",\n              \"Veneto\",\n              \"Provincia autonoma di Bolzano\",\n              \"Provincia autonoma di Trento\")\n\n\n\nihme_covid_back_up<-ihme_covid\n\nihme_covid_ICU<-ihme_covid_back_up%>%\n  filter(location_name==it_regions)%>%\n  select(-V1,-location_id)\n\n\nihme_covid_ICU<-data.frame(ihme_covid_ICU)\n\nicu_bed_var<-ihme_covid_ICU %>%\n  select(location_name,date,ICUbed_mean:ICUbed_upper) %>%\n  pivot_longer(ICUbed_mean:ICUbed_upper, \n               names_to = \"comparison\",\n               values_to = \"count\") %>%\n  mutate(date=as.Date(date,\"%Y-%m-%d\"),\n         time=seq(1,length(date),1),\n                year = lubridate::year(date),\n                month = lubridate::month(date),\n         week=week(date),\n         proportion = 100 * count/sum(count))\n\n\n\n\n##################################################################\n\nstartDate <- min(icu_bed_var$week)\nendDate <- max(icu_bed_var$week)\n\n\nscaleFactor = 3\n\ninnerLine <- 20 * scaleFactor\n\nmiddleLine <- 30 * scaleFactor\n\nouterLine <- 40 * scaleFactor\n\nalpha = 1\n\n# Get palette\nRoyal1 <- wesanderson::wes_palettes$Royal1\n\n\ng <- ggplot() +\n  \n  geom_ribbon(data = icu_bed_var %>% filter(comparison == \"ICUbed_mean\"), \n              aes(x = week, ymin = middleLine - count, ymax = middleLine + count, \n                  fill = comparison), \n              alpha = alpha/1, stat=\"identity\", colour = NA) +\n  \n  geom_ribbon(data = icu_bed_var %>% filter(comparison == \"ICUbed_upper\"), \n              aes(x = week, ymin = outerLine , ymax = outerLine + count, fill = comparison), \n              alpha = alpha, stat=\"identity\", colour = NA) +\n   \n  geom_ribbon(data = icu_bed_var %>% filter(comparison == \"ICUbed_lower\"), \n              aes(x = week, ymin = innerLine, ymax = innerLine - count, fill = comparison), \n              alpha = alpha, stat=\"identity\", colour = NA) +\n  \n  labs(title = \"Covid19 Italy regions - ICU beds capacity\",\n       subtitle = \"situation from Feb 2020 to March 2021 by week\",\n       caption = \"27.3.2021  |  Visualisation by @fgazzelloni  |  Data:IHME\") +\n\n  theme_ft_rc() +\n  coord_polar(direction=1) +\n  \n  scale_x_continuous(breaks=seq(startDate, endDate, by=round((endDate - startDate)/2)), \n                     expand=c(0,0), lim=c(startDate, endDate)) +\n  \n  scale_fill_manual(values = Darjeeling1) +\n  \n  theme(legend.position = \"none\",\n        axis.text.x = element_blank(), axis.title.x = element_blank(),\n        axis.text.y = element_blank(), axis.title.y = element_blank(),\n        strip.text.x = element_text(hjust = 0.5,size=8),\n        strip.text.y = element_text(hjust = 0.5, size = 5),\n        panel.grid.minor.x = element_blank(),\n        panel.spacing.x = unit(0, \"lines\"), # Remove horizontal spacing between facets\n        panel.spacing.y = unit(0, \"lines\"), # Remove vertical pacing between facets\n        plot.title.position = \"plot\",\n        \n        plot.background = element_rect(fill = \"black\", color = NA),\n        panel.background = element_rect(fill = \"black\", color = NA),\n        plot.margin = margin(5,5,5,5)\n  ) +\n  \n  facet_wrap(~location_name,\n             labeller = label_wrap_gen()) \n  \n\n\n\n#######################################################################################\n\n\n# Create non radial legend with a sample of data\ndataLegend <- icu_bed_var  %>% filter(location_name == \"Lazio\" & year == \"2020\") \n\ndataLegend$comparison = factor(dataLegend$comparison, levels=c('ICUbed_upper','ICUbed_mean','ICUbed_lower'))\n\nlegend <- ggplot() +\n  \n  geom_ribbon(data = dataLegend %>% filter(comparison == \"ICUbed_mean\"), \n              aes(x = week, \n                  ymin = middleLine - count/2, ymax = middleLine + count/2, \n                  fill = comparison), alpha = alpha/1, stat=\"identity\", colour = NA) +\n  geom_ribbon(data = dataLegend %>% filter(comparison == \"ICUbed_upper\"),\n              aes(x = week, \n                  ymin = 20, ymax = 20 + count, \n                  fill = comparison), alpha = alpha, stat=\"identity\", colour = NA) +\n  geom_ribbon(data = dataLegend %>% filter(comparison == \"ICUbed_lower\"),\n              aes(x = week, \n                  ymin = 23 - count/3, ymax = 23, \n                  fill = comparison), alpha = alpha, stat=\"identity\", colour = NA) +\n  \n  theme_void() +\n  coord_polar(direction=1) +\n  scale_fill_manual(values = Darjeeling1) +\n  theme(legend.position = \"none\",\n        axis.text.x = element_blank(), axis.title.x = element_blank(),\n        axis.text.y = element_blank(), axis.title.y = element_blank(),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        panel.grid.minor.y = element_blank(),\n        panel.grid.major.y = element_blank(),\n        \n        panel.spacing.x = unit(1, \"lines\"), # Increase horizontal spacing between facets\n        plot.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = \"pt\"),\n        strip.text.x = element_blank(),\n        \n        plot.background = element_rect(fill = \"black\", color = \"black\"),\n        panel.background = element_rect(fill = \"black\", color = \"black\"),\n        ) +\n  facet_wrap(vars(comparison))\n\n\n\n\n# Add facets, text and legend together and plot\n\n\nplot <- cowplot::ggdraw(g) +\n  \n  cowplot::draw_plot(legend, 0.4,0, 0.25, .2, scale=1.1) +\n  \n  cowplot::draw_label(\"ICUbed_upper\", x = 0.42, y = 0.15, colour = \"#929299\", size = 8, hjust = 0.5) +\n  cowplot::draw_label(\"ICUbed_mean\", x = 0.52, y = 0.15, colour = \"#929299\", size = 8, hjust = 0.5) +\n  cowplot::draw_label(\"ICUbed_lower\", x = 0.62, y = 0.15, colour = \"#929299\", size = 8, hjust = 0.5)\n\n\nggsave(here::here(\"GBD/IHME/IHME_forked\", \"covid19_icu.png\"), \n       plot, device = \"png\", width = 29.65, height = 21, \n       units = \"cm\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}