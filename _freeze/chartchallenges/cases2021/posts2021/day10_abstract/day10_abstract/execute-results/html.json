{
  "hash": "2bab97574df9773fadb9fde166d30ba2",
  "result": {
    "markdown": "---\ntitle: 'Abstract'\nsubtitle: 'Welcome to #30DayChartChallenge 2021 day 10'\ndate: '2021-04-10'\nimage: 'day10_abstract.png'\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n### Inspired by Hierarchical edge bundling and wanting to know more about \n### visualizing clustering\n### source: https://www.r-graph-gallery.com/hierarchical-edge-bundling.html\n\n\n\n### General-purpose data wrangling\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)  \n# Parsing of HTML/XML files  \nlibrary(rvest)    \n# String manipulation\nlibrary(stringr)   \n# Verbose regular expressions\nlibrary(rebus)     \n# Eases DateTime manipulation\nlibrary(lubridate)\n\nrequire(stats); require(graphics)\n\n\n# Table extracted from: https://www.worldometers.info/geography/alphabetical-list-of-countries/\n\nurl <- \"https://www.worldometers.info/geography/alphabetical-list-of-countries/\"\n\ntable_world_countries <-xml2::read_html(url)\n\nwcl<-table_world_countries%>%\n  rvest::html_node(\"table\") %>% \n  rvest::html_table(header = TRUE)%>%\n  select(2:5)\n\nwcl <- as.tibble(wcl)\n\n# sum(is.na(wcl))\n\nwcl$`Population(2020)`<-gsub(\",\",\"\",wcl$`Population(2020)`)\nwcl$`Population(2020)`<-as.numeric(as.character(wcl$`Population(2020)`))\nwcl$`Land Area (Km²)`<-gsub(\",\",\"\",wcl$`Land Area (Km²)`)\nwcl$`Land Area (Km²)`<-as.numeric(as.character(wcl$`Land Area (Km²)`))\nwcl$`Density(P/Km²)`<-gsub(\",\",\"\",wcl$`Density(P/Km²)`)\nwcl$`Density(P/Km²)`<-as.numeric(as.character(wcl$`Density(P/Km²)`))\n\n\nnames(wcl)[3] <- gsub(\" \",\"\",names(wcl)[3])\n\nnames(wcl)<-c(\"country\",\"population\",\"area\",\"density\")\nglimpse(wcl)\n\nwcl <- transform(wcl, country = factor(country))\n\nclean_wcl <- wcl%>%arrange(population)%>%\n  mutate(area=round(area,2),area_made=round(population/density,2))%>%\n  select(1,2,5,4)\n\nhead(clean_wcl)\n\nsummary(clean_wcl$population)\n\ntable(percent_rank(clean_wcl$country),clean_wcl$country)\n\nkclust <- kmeans(clean_wcl[,2:3],centers=5)  \ntable(kclust$cluster,clean_wcl$country)\n############################################ PCA #############################\n\nrid<-seq(1,length(clean_wcl$country),1)\nclass(rid)\n\ndf_wcl<- cbind(rid,clean_wcl)\n\ndf <-df_wcl%>%mutate(dens_log=log10(density))%>%\n  select(country,rid,dens_log)%>%\n  mutate(rid = paste0(\"rid_\", rid))%>%\n  pivot_wider(names_from = \"rid\", values_from = \"dens_log\", values_fill = 0)\n\n\nlibrary(recipes)\n\npca_rec <- recipe(~., data = df) %>%\n  update_role(country, new_role = \"id\") %>%\n  step_normalize(all_predictors()) %>%\n  step_pca(all_predictors(), num_comp = 5)\n\npca_prep <- prep(pca_rec)\n\npca_prep\n\nlibrary(extrafont)\nlibrary(ggrepel)\nbake(pca_prep, new_data = NULL) %>%\n  ggplot(aes(PC1, PC2, label = country)) +\n  geom_point(color = \"midnightblue\", alpha = 0.4, size = 2) +\n  geom_text(check_overlap = TRUE, hjust = \"inward\", family = \"Comic Sans MS\") +\n  labs(color = NULL)\n\n#------------\n\npca_comps <- tidy(pca_prep, 2) %>%\n  filter(component %in% paste0(\"PC\", 1:4)) %>%\n  left_join(df_wcl %>% mutate(terms = paste0(\"rid_\", rid))) %>%\n  group_by(component) %>%\n  top_n(8, abs(value)) %>%\n  ungroup()\n\n\npca_comps %>%\n  mutate(value = abs(value)) %>%\n  ggplot(aes(value, fct_reorder(terms, value), fill = country)) +\n  geom_col(position = \"dodge\") +\n  geom_text(check_overlap = TRUE, hjust = \"inward\", aes(value, fct_reorder(terms, value),label= country),family = \"Comic Sans MS\")+\n  facet_wrap(~component, scales = \"free_y\") +\n  labs(\n    x = \"Absolute population density\",\n    y = NULL, fill = NULL,\n    title = \"What World Countries are the most diverse in density?\",\n    subtitle = \"Seychelles, Antigua and Barbuda and San Marino are different\"\n  ) +\n  theme_void()+\n  theme(legend.position = \"none\",\n        axis.text = element_blank(),\n        axis.ticks = element_blank()\n        \n        )\n\nlibrary(embed)\n\numap_rec <- recipe(~., data = df) %>%\n  update_role(country, new_role = \"id\") %>%\n  step_normalize(all_predictors()) %>%\n  step_umap(all_predictors())\n\numap_prep <- prep(umap_rec)\n\numap_prep\n\nimage <- readJPEG(\"background-world-map-1.jpg\")\nlibrary(ggpubr)\nlibrary(jpeg)\nlibrary(ggimage)\nlibrary(magick)\n\nmain_plot<-bake(umap_prep, new_data = NULL) %>%\n  ggplot(aes(umap_1, umap_2, label = country)) +\n  background_image(image) + \n  geom_point(color = \"midnightblue\", alpha = 0.7, size = 2) +\n  geom_text(check_overlap = TRUE, hjust = \"inward\", family = \"Comic Sans MS\",size=5) +\n  labs(color = NULL)+\n  theme_void()+\n  theme(plot.background = element_blank(),\n        plot.margin = margin(5,5,5,5))\n\n\n\n\n#-----------------------\n\n\nlibrary(patchwork)\n\nfinal <- main_plot + plot_annotation(\n  title = \"World Countries driven by population density\",\n    subtitle = \"What else they have in common?\",\n  caption = \"Visualization: Federica Gazzelloni | Abstract Day10 | Data:Worldometers\",\n  theme = theme(plot.title = element_text(size=24,family=\"Comic Sans MS\",face = \"bold\"),\n                plot.subtitle = element_text(size=14,family=\"Comic Sans MS\"),\n                plot.margin = margin(10,10,10,10),\n                plot.background = element_rect(fill = \"#663fd9e2\" , color = NA),\n                plot.caption = element_text(family = \"Comic Sans MS\", size = 9, \n                                color =  \"midnightblue\", margin = margin(15,0,0,0), hjust = 0.95)\n  )\n)\n\nragg::agg_png(here::here(\"day10\", \"Abstract_day10.png\"),\n              res = 320, width = 14, height = 8, units = \"in\")\nfinal\n\ndev.off()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}