{
  "hash": "44507723e22fea088f31300eb3ef4f3f",
  "result": {
    "markdown": "---\ntitle: 'Down upwards'\nsubtitle: 'Welcome to #30DayChartChallenge 2022 day 21'\ndate: '2022-04-21'\nimage: 'day21_down_upwards.png'\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nrm(list=ls())\nlibrary(tidyverse)\n\nchocolate <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-01-18/chocolate.csv')\n\nchocolate%>%names\ndf <- chocolate%>% select(review_date,rating,cocoa_percent)\n\ndf%>%#count(review_date)\n  ggplot(aes(x=review_date))+\n  geom_histogram(binwidth=0.5)+\n  geom_freqpoly(binwidth=1)+\n  scale_x_continuous(breaks=seq(2006,2021,3))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(extrafont)\n# loadfonts()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf%>%\n  arrange(review_date) %>%\n  mutate(cocoa_percent=sub(\"%\",\"\",cocoa_percent),\n         cocoa_percent=as.integer(cocoa_percent))%>%\n  group_by(review_date)%>%\n  summarise_all(.funs = mean) %>% \n  ungroup() %>% \n  mutate(rating=(rating/sum(rating))*100)%>%\n  mutate(rating_sc=scale(rating),cocoa_sc=scale(cocoa_percent)) %>%\n  #filter(review_date%in%c(2007,2008))\n  filter(review_date%in%c(2011,2012))\n                         \n#2007-2008\nrat \n1/(5.894628-6.096499)\n# [1] -4.953659\ncoc\n1/(72.67391-72.08219)\n# [1] 1.689989\n\n#2011-2012\nrat \n1/(6.249116-6.400915)\n# [1] -6.587659\ncoc\n1/(71.55155-70.96933)\n# [1] 1.717564\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf%>%\n  arrange(review_date) %>%\n  mutate(cocoa_percent=sub(\"%\",\"\",cocoa_percent),\n         cocoa_percent=as.integer(cocoa_percent))%>%\n  group_by(review_date)%>%\n  summarise_all(.funs = mean) %>% \n  ungroup() %>% \n  mutate(rating=(rating/sum(rating))*100)%>%\n  mutate(rating_sc=scale(rating),cocoa_sc=scale(cocoa_percent))%>%\n  pivot_longer(cols=c(rating_sc,cocoa_sc),names_to=\"names\",values_to=\"values\")%>%#pull(values)%>%range()\n  ggplot()+\n  geom_line(aes(x=review_date,y=values,group=names,color=names),\n            size=2,key_glyph = \"timeseries\")+\n  geom_rect(aes(xmin = 2007, \n                xmax = 2008, \n                ymin = min(values), \n                ymax = max(values)),alpha=0.02,fill=\"pink\")+\n  geom_rect(aes(xmin = 2011, \n                xmax = 2015, \n                ymin = min(values), \n                ymax = max(values)),alpha=0.02,fill=\"pink\")+\n  geom_rect(aes(xmin = 2017, \n                xmax = 2019, \n                ymin = min(values), \n                ymax = max(values)),alpha=0.02,fill=\"pink\")+\n  scale_x_continuous(breaks=c(2007,2008,2011,2015,2017,2019,2021))+\n  scale_color_viridis_d(labels=c(\"Cocoa(%)\",\"Rating\"))+\n  annotate(\"curve\", x = 2005.4, xend = 2006.5, \n           y = 1.4, yend = 0.9, \n           curvature=0.5,\n           arrow = arrow(length = unit(0.3, \"cm\")),\n           colour = \"#800080\", size=1, alpha=0.6)+\n    annotate(\"text\", x = 2006.2, y = 1.4, \n             label=\"Cocoa(%)\\nUP\\n+1.7%\", family=\"Arial Black\",\n           colour = \"#800080\", size=4, alpha=0.6)+\n  annotate(\"text\", x = 2007.8, y = -0.8, \n             label=\"\\n-5%\", family=\"Arial Black\",\n           colour = \"#800080\", size=4, alpha=0.6)+\n   annotate(\"text\", x = 2011.9, y = -0.5, \n             label=\"\\n+1.8%\", family=\"Arial Black\",\n           colour = \"#800080\", size=4, alpha=0.6)+\n  annotate(\"text\", x = 2012, y = 1, \n             label=\"\\n-6.6%\", family=\"Arial Black\",\n           colour = \"#800080\", size=4, alpha=0.6)+\n  \n    annotate(\"curve\", x = 2011.5, xend = 2011.8, \n           y = 0.8, yend = 0.3, \n           curvature=-0.3,\n           arrow = arrow(length = unit(0.3, \"cm\")),\n           colour = \"#800080\", size=1, alpha=0.6)+\n  annotate(\"text\", x = 2010.8, y = 1, \n             label=\"Rating\\nDOWN\", family=\"Arial Black\",\n           colour = \"#800080\", size=4, alpha=0.6)+\n  annotate(\"segment\", x = 2005.4, xend = 2008.3, \n           y = 2.9, yend = 2.9, \n           colour = \"#800080\", size=7, alpha=0.6)+\n  annotate(\"text\",x=2007,y=-3,parse=T,family=\"Arial Black\",color=\"grey30\",\n           label=\"Slope == frac(y[2]-y[2],x[2]-x[1])\")+\n  coord_cartesian(ylim = c(-1.778707,1.780479), \n                  xlim = c(2006,2021),clip = \"off\")+\n  labs(color=\"\",title=\"Cocoa beans' Percent & Ratings\",\n       subtitle = \"Global AVG - scaled values\",\n       caption=\"#30DayChartChallenge 2022 #Day21 - Down/Upwards\n       DataSource: #TidyTuesday 2022 week3 - Chocolate Bar ratings\n       DataViz: Federica Gazzelloni\")+\n  ggthemes::theme_fivethirtyeight()+\n  theme(text = element_text(family=\"Arial Black\"),\n        axis.text.x = element_text(size=11,face=\"bold\"),\n        axis.text.y = element_blank(),\n        axis.ticks.x = element_line(size=3,lineend = \"butt\",color=\"grey50\"),\n        axis.ticks.length.x = unit(6,units = \"pt\"),\n        axis.line.x = element_line(color=\"#800080\",size=1),\n        plot.title = element_text(size=30),\n        plot.caption = element_text(color=\"grey30\"),\n        plot.background = element_rect(fill=\"grey90\",color=\"grey90\"),\n        panel.background = element_rect(fill=\"grey95\",color=\"grey90\"),\n        legend.background = element_blank(),\n        legend.key = element_blank(),\n        legend.text = element_text(size=12,face=\"bold\"))\nggsave(\"cocoa.png\",\n       dpi=320,\n       width = 8,\n       height = 6)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}