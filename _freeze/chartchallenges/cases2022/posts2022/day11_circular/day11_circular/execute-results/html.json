{
  "hash": "c12ccf2add91c9a3c255aeebee82e4a6",
  "result": {
    "markdown": "---\ntitle: 'day11_circular'\nsubtitle: 'Welcome to #30DayChartChallenge 2022 day 11'\ndate: '2022-04-11'\nimage: 'day11_circular.png'\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n\n\n\n### Quarterly Earnings per Johnson & Johnson Share\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n# data()\nrm(list=ls())\n\nsetwd(dirname(rstudioapi::getActiveDocumentContext()$path))\n\nlibrary(extrafont)\n# loadfonts()\n\n# transform time series dataset into a dataframe class\nres <-data.frame(value=as.matrix(JohnsonJohnson), date=time(JohnsonJohnson))\nres$year <- trunc(res$date)\nres$month <- (res$date - res$year) * 12 + 1\n\n# summarize by total annual earnings\nlabel_data <- res %>% \n  arrange(year) %>%\n  group_by(year) %>% summarise(tot_val=sum(value)) %>% ungroup()\n\n# set the labels\nlabel_data$id <- seq(1, nrow(label_data))\nnumber_of_bars <- nrow(label_data)\nangle <- 90 - 360*(label_data$id - 0.5)/number_of_bars\nlabel_data$hjust <-ifelse(angle< -90,1,0)\nlabel_data$angle<- ifelse(angle< -90, angle + 180, angle)\nlabel_data$label <- paste(\"$\",label_data$tot_val,\"in\",label_data$year)\n\n# set the colors\nmycolors <- colorRampPalette(RColorBrewer::brewer.pal(8, \"Set2\"))(21)\nmycolors2 <- colorRampPalette(RColorBrewer::brewer.pal(8, \"Set2\"))(1627)\n\n# make the circular barplot\np <- res %>% \n  ggplot(aes(x=as.factor(year),y=value,fill=alpha(month,0.7)))+\n  geom_bar(stat=\"identity\",\n           width = 0.7,\n           show.legend = F) +\n  geom_text(data = label_data,\n            aes(label=label,x=as.factor(year), y=tot_val+1,\n                vjust=\"center\",hjust=hjust,angle=angle),\n            color=\"grey90\",\n            fontface=\"bold\",\n            size=4,\n            family=\"Roboto Condensed\",\n            inherit.aes = F)+\n  ylim(-30,60)+\n  coord_polar(start = 0,theta = \"x\",direction = 1) +\n  scale_fill_manual(values=mycolors) +\n  theme_void() +\n  theme(text = element_text(family = \"Roboto Condensed\"),\n        aspect.ratio = 2/2,\n        axis.text = element_blank(),\n        axis.title = element_blank(),\n        panel.grid = element_blank(),\n        plot.margin = unit(rep(-1,4),\"cm\"))\n\n# make the map\nworld <- map_data(\"world\")\n\nworld%>%count(group)\n\nmap <-world %>% #count(group)%>%dim()\n  filter(!region==\"Antarctica\") %>%\n  ggplot(aes(x=long,y=lat,group=group))+\n  geom_polygon(aes(fill=region),show.legend = F) +\n  scale_fill_manual(values=mycolors2) +\n  coord_map(\"ortho\",orientation=c(14.707540, -74.452362,0))+\n  ggthemes::theme_map()+\n  theme(text = element_text(family = \"Roboto Condensed\"))\n\n# draw the plot\nlibrary(cowplot)\n\nggdraw()+\n  draw_plot(p,scale=0.9,y=-0.1) +\n  draw_plot(map,scale=0.28,x=-0.005,y=-0.1)+\n  draw_label(\"Johnson & Johnson: Quarterly earnings (dollars) per share\",\n             x=0.5,y=0.95,size=28,color=\"grey90\",\n             fontface = \"bold\",\n             fontfamily = \"Roboto Condensed\") +\n  draw_label(\"summarized by total annual earnings from 1960 to 1980\", \n             x=0.5,y=0.9, size=20,color=\"grey90\",\n             fontfamily = \"Roboto Condensed\",\n             fontface = \"bold\") +\n  draw_label(\"#30DayChartChallenge 2022 day11 - Circular\\nDataSource:Johnson & Johnson dataset in {datasets}\\nDataViz: Federica Gazzelloni\",\n             x=0.5,y=0.05,size=15,color=\"grey90\",\n             fontface = \"bold\",\n             fontfamily = \"Roboto Condensed\")\n\n# save the plot\nggsave(\"day11_circular.png\",\n       bg=\"grey20\",\n       width = 10,height = 10)  \n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}