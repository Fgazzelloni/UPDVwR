{
  "hash": "96a3f730ca0e3fc08f0b9498e456f571",
  "result": {
    "markdown": "---\ntitle: 'Environment'\nsubtitle: 'Welcome to #30DayChartChallenge 2022 day 16'\ndate: '2022-04-16'\nimage: 'day16_environment.png'\nimage-alt: ''\ndescription: 'Networks'\noutput: html_document\nexecute: \n   eval: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nindoor_pollution <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-04-12/indoor_pollution.csv')\nfuel_gdp<- read.csv(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-04-12/fuel_gdp.csv\")\ndeath_timeseries<-read.csv(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-04-12/death_timeseries.csv\")\ndeath_source<-read.csv(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-04-12/death_source.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# indoor_pollution;\n# fuel_gdp;\n# death_timeseries;\n# death_source\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nindoor_pollution1 <- indoor_pollution%>%\n  rename(Deaths_age.std.pct=`Deaths - Cause: All causes - Risk: Household air pollution from solid fuels - Sex: Both - Age: Age-standardized (Percent)`,\nYear_death=Year) %>%\n  janitor::clean_names()\n\nindoor_pollution1%>%head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfuel_gdp1 <- fuel_gdp%>%\n  rename(Clean.fuels=\"Access.to.clean.fuels.and.technologies.for.cooking....of.population.\",\n         GDP=\"GDP.per.capita..PPP..constant.2017.international...\",\n         Pop=\"Population..historical.estimates.\",\n         Year_fuel=Year) %>%\n  janitor::clean_names() \n\nfuel_gdp1 %>%head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndeaths_pct <- indoor_pollution1 %>%\n  right_join(fuel_gdp1,by=c(\"year_death\"=\"year_fuel\",\"entity\",\"code\"))%>%\n  janitor::clean_names()\n\ndf <- deaths_pct%>%\n  filter(!is.na(deaths_age_std_pct),\n         !is.na(clean_fuels),\n         !is.na(gdp)) %>%\n  select(-continent)\n  \n# DataExplorer::profile_missing()\ndf %>%head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf%>%glimpse()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(countrycode)\ndf$continent <- countrycode(df$entity,\n                            origin= \"country.name\",\n                            destination = \"continent\")\n\n\ndf%>% filter(is.na(continent)) %>% count(entity)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df %>%\n  filter(!entity%in%c(\"Micronesia (country)\",\"Timor\",\"World\")) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf%>%\n  head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndeath_plot <- df %>%\n  mutate(year=cut(year_death,5),.after=year_death) %>%\n  group_by(year)%>%\n  mutate(mean=mean(deaths_age_std_pct),\n         sd=sd(deaths_age_std_pct)) %>%\n  ungroup() %>% # pull(mean)%>%summary\n  select(year,mean,sd) %>%\n  distinct()%>%\n  ggplot(aes(y=fct_reorder(year,mean),\n             xdist = distributional::dist_normal(mean, sd),\n             layout = \"weave\",\n             fill = stat(x < 5.094))) + \n  ggdist::stat_dots(position = \"dodge\", color = \"grey70\")+\n  geom_vline(xintercept = 5.094, alpha = 0.25) +\n  scale_x_continuous() +\n  tvthemes::scale_fill_hilda()+\n  labs(x=\"\",\n       y=\"\",color=\"\",\n       title=\"Deaths\",\n       subtitle=\"\",\n       Caption=\"#30DayChartChallenge 2022 #day16 - Enviroment\\nDataSource: Indoor Air Pollution | DataViz: Federica Gazzelloni\")+\n  tvthemes::theme_avatar()+\n  theme(legend.background = element_blank(),\n        legend.box.background = element_blank(),\n        legend.key = element_blank(),\n        legend.key.width = unit(0.5,units=\"cm\"),\n        legend.direction = \"horizontal\",\n        legend.position = c(0.8,0.1))\ndeath_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf%>%head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfuel_plot <- df %>%\n  mutate(year=cut(year_death,5),.after=year_death) %>%\n  group_by(year)%>%\n  mutate(mean=mean(clean_fuels),\n         sd=sd(clean_fuels)) %>%\n  ungroup() %>% #pull(mean)%>%summary\n  select(year,mean,sd) %>%\n  distinct()%>%\n  ggplot(aes(y=fct_reorder(year,mean),\n             xdist = distributional::dist_normal(mean, sd),\n             layout = \"weave\",\n             fill = stat(x < 62.04))) + \n  ggdist::stat_dots(position = \"dodge\", color = \"grey70\")+\n  geom_vline(xintercept = 62.04, alpha = 0.25) +\n  scale_x_continuous() +\n  tvthemes::scale_fill_hilda()+\n  labs(x=\"\",\n       y=\"\",color=\"\",\n       title=\"Fuel\",\n       subtitle=\"\",\n       Caption=\"#30DayChartChallenge 2022 #day16 - Environment\\nDataSource: Indoor Air Pollution | DataViz: Federica Gazzelloni\")+\n  tvthemes::theme_avatar()+\n  theme(legend.background = element_blank(),\n        legend.box.background = element_blank(),\n        legend.key = element_blank(),\n        legend.key.width = unit(0.5,units=\"cm\"),\n        legend.direction = \"horizontal\",\n        legend.position = c(0.8,0.1))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\ndeath_plot|fuel_plot\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf%>%count(entity)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rnaturalearth)\nworld <- ne_countries(returnclass = \"sf\")\n\nworld%>%\n  right_join(df,by=c(\"name\"=\"entity\"))%>% select(name) %>%\n  sf::st_drop_geometry() %>%\n  count(name)\n\ndf1 <- world%>%\n  select(name)%>%\n  right_join(df,by=c(\"name\"=\"entity\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmap <- ggplot(data = world) +\n  geom_sf(size=0.5)+\n  geom_sf(data=df1,\n          mapping=aes(geometry=geometry,fill=deaths_age_std_pct),\n          size=0.1)+\n  coord_sf(xlim = c(-180.0,180.0), ylim = c(-60.0,90.0), expand = FALSE)+\n  labs(fill=\"Deaths (%)\",\n       title=\"Deaths caused by Indoor Air Pollution\") +\n  tvthemes::scale_fill_gravityFalls(178,type=\"continuous\")+\n  tvthemes::theme_hildaDay() +\n  theme(axis.text = element_blank(),\n        axis.ticks = element_blank(),\n        legend.background = element_blank(),\n        legend.position = c(0.1,0.3),\n        plot.background = element_rect(color=\"beige\",fill=\"beige\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"map.png\",dpi=320,width = 9,height = 6)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(scipen = 999)\nlines <- ggplot(df, aes(x = clean_fuels, y = deaths_age_std_pct)) +\n     geom_point(aes(fill=entity),\n                size = 0.5,\n                shape=21,color=\"grey70\",\n                show.legend = F) + \n     geom_smooth(aes(color = as.factor(year_death)),\n                 size=0.2,show.legend = F,se=F)+\n     geom_label(data=df%>%\n                filter(year_death==\"2009\")%>%\n                group_by(continent)%>%\n                mutate(deaths_age_std_pct=max(deaths_age_std_pct),\n                                        clean_fuels=max(clean_fuels))%>%\n                arrange(-deaths_age_std_pct)%>%\n                slice(1:1)%>%\n                ungroup() ,\n                aes(label=entity),\n                position = \"identity\",\n                vjust=0.5,hjust=\"right\",\n                size=2,\n                inherit.aes = T,\n                check_overlap = T)+\n     #scale_x_log10()+\n     #scale_y_log10(breaks=seq(0,23,5))+\n     facet_wrap(vars(continent),scales = \"free\",ncol = 5)+\n     #tvthemes::scale_fill_gravityFalls()+\n     tvthemes::scale_colour_gravityFalls()+\n     tvthemes::theme_hildaDay() +\n     theme(legend.position = \"none\",\n           plot.background = element_rect(color=\"midnightblue\",fill=\"beige\"),\n           panel.grid = element_line(size=0.05),\n           axis.text = element_blank(),\n           axis.title = element_blank())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"lines.png\",\n       dpi=320,\n       width = 9,height = 4)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cowplot)\nlibrary(extrafont)\n#loadfonts()\n\nggdraw()+\n  draw_plot(map,y=0.2,\n            height = 0.6)+\n  draw_plot(lines,scale=0.5,\n            width = 2,height = 0.5,\n            x=-0.5,y=-0.2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"day_16_enviroment.png\",\n       dpi=320,\n       width = 9,height = 6)\n```\n:::\n",
    "supporting": [
      "day16_environment_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}