{
  "hash": "0c1bca9a037d5b893d69f770c7dbd4dd",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: '3d'\nsubtitle: 'Welcome to #30DayMapChallenge 2022 day 28'\ndate: '2022-11-28'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2022/day28_3D/day28_3D.png'\nimage-alt: ''\ndescription: ''\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n\n# Overview\n\nMap of `Oregon Population Density`. Data is from `Kontur population US` and the  `{tigris}` package.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(tigris)\nlibrary(rayshader)\nlibrary(PrettyCols)\nlibrary(stars)\n```\n:::\n\n\n\n\n\n\nInspiration:\n\n- <https://github.com/Pecners/30DayMapChallenge/blob/main/R/day_21_kontur/colorado.R>\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://geodata-eu-central-1-kontur-public.s3.amazonaws.com/kontur_datasets/kontur_population_US_20220630.gpkg.gz\"\n# downloader::download(url, dest=\"data/kontour_pop_cr.zip\", mode=\"wb\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- st_read(\"data/kontur_population_US_20220630.gpkg\")\n# save(data,file=\"data/data.RData\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ns <- tigris::states() |> \n  st_transform(crs = st_crs(data))\n# save(s,file=\"data/s.RData\")\n\ns%>%count(NAME)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nor <- s |> \n  filter(NAME == \"Oregon\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nor_d <- st_intersection(data, or)\n# save(or_d,file=\"data/or_d.RData\")\nload(\"data/or_d.RData\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbb <- st_bbox(or_d)\nyind <- st_distance(st_point(c(bb[[\"xmin\"]], bb[[\"ymin\"]])), \n                    st_point(c(bb[[\"xmin\"]], bb[[\"ymax\"]])))\nxind <- st_distance(st_point(c(bb[[\"xmin\"]], bb[[\"ymin\"]])), \n                    st_point(c(bb[[\"xmax\"]], bb[[\"ymin\"]])))\n\nxind / yind\n\nsize <- 2500\nrast <- st_rasterize(or_d |> \n                       select(population, geom),\n                     nx = floor(size * (xind/yind)), ny = size)\n# save(rast,file=\"data/rast.RData\")\nload(\"data/rast.RData\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmat <- matrix(rast$population, \n              nrow = floor(size * (xind/yind)), \n              ncol = size)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npal <- \"pink_greens\"\n\nc1 <- prettycols(\"TangerineBlues\")\ncolors <- c(c1[c(6:8, 2:4)])\n# swatchplot(colors)\n\nscico::scico_palette_show()\ncolors <- scico::scico(6,palette=\"bamako\")\n\ntexture <- grDevices::colorRampPalette(colors, bias = 2)(256)\n# swatchplot(texture)\n\nrgl::rgl.close()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmat |> \n  height_shade(texture = texture) |> \n  plot_3d(heightmap = mat, \n          solid = FALSE,\n          soliddepth = 0,\n          z = 20,\n          shadowdepth = 0,\n          windowsize = c(800,800), \n          phi = 90, \n          zoom = 1, \n          theta = 0, \n          background = \"white\") \n\nrayshader::render_camera(phi = 50, \n                         zoom = .85, \n                         theta = 45)\nrender_snapshot(title_text = \"#30DayMapChallenge Day 28:3D | Graphics: @fgazzelloni\\n\\nOregon Population density, US\",\n                title_color = \"navy\",\n                title_font = \"Comic Sans\",\n                title_size = 25,\n                title_bar_alpha = 0.5,\n                title_bar_color = \"#a5a7c4\",\n                vignette = 0.2,\n                filename = \"day28_3D2.png\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}