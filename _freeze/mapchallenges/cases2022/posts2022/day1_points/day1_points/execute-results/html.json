{
  "hash": "bc6443d2d6fe8a192a7c6d091b5d4ee8",
  "result": {
    "markdown": "---\ntitle: 'Points'\nsubtitle: 'Welcome to #30DayMapChallenge 2022 day 1'\ndate: '2022-11-1'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2022/day1_points/day1_points.png'\nimage-alt: ''\ndescription: ''\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n# Overview\n\n`Malaria prevalence in children`, data recorded at villages in The `Gambia, Africa`. Data is from `{geoR}` package.\n\n\n\nLoad the libraries\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(geoR)\nlibrary(sf)\nlibrary(afrilearndata)\nlibrary(cowplot)\n\n# set the fonts\nlibrary(showtext)\nlibrary(sysfonts)\nlibrary(extrafont)\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi=320)\nfont_add_google(name = \"Mukta\",family=\"Mukta\")\n```\n:::\n\n\nLoad data and transform UTM coords into Lat and Long \n\n::: {.cell}\n\n```{.r .cell-code}\ndata(package=\"geoR\")\n# ?gambia\ngambia %>% head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngambia1 <- gambia %>%\n  select(x,y) %>%\n  sf::st_as_sf(coords = c(1,2), \n               crs = \"+proj=utm +zone=28\") %>%\n  # utm tranformation to longlat\n  sf::st_transform(crs = \"+proj=longlat +datum=WGS84\")  %>%\n  sf::st_coordinates() %>%\n  cbind(gambia) %>%\n  rename(long=X,lat=Y) \n\n\n# gambia.borders\n# gambia.borders %>%DataExplorer::profile_missing()\n# NA in the borders coords \nst_write(gambia.borders,\n        \"gambia_borders.csv\",\n         layer_options = \"GEOMETRY=AS_XY\")\n  \n# replacing null geometries with empty geometries\ngambia.borders2 = st_read(\"gambia_borders.csv\",\n                          options = c(\"X_POSSIBLE_NAMES=X\",\n                                      \"Y_POSSIBLE_NAMES=Y\"),\n                          crs=\"+proj=utm +zone=28\") \n  \ngambia.borders3 <- gambia.borders2 %>%\n  sf::st_as_sf(coords = c(1,2), \n              crs = \"+proj=utm +zone=28\") %>%\n  # utm tranformation to longlat\n  sf::st_transform(crs = \"+proj=longlat +datum=WGS84\") \n           \n \ngambia.borders4 <- gambia.borders3 %>%\n  sf::st_coordinates() %>%\n  as.data.frame()%>%\n  rename(long=X,lat=Y) \n  \n\n# check the bbox\n# bbox = left,bottom,right,top\n# bbox = min Longitude , min Latitude , max Longitude , max Latitude \n# gambia.borders3%>%\n#  st_bbox()\n```\n:::\n\n\nMake the map\n\n::: {.cell}\n\n```{.r .cell-code}\nmap <- gambia1 %>%\n  filter(pos==1) %>%\n  ggplot(aes(long,lat)) +\n  geom_point(shape=21,stroke=0.5,size=2,color=\"grey40\") +\n  geom_point(aes(color=age)) +\n  geom_point(data=gambia1 %>%\n               filter(pos==1,phc==1) ,\n             inherit.aes = TRUE,\n             shape=\"H\",stroke=0.1,size=2,color=\"red\") +\n  coord_map()+\n  scale_color_gradient2() +\n  geom_path(data = gambia.borders4, aes(long,lat),size=0.1)+\n  labs(title=\"Malaria prevalence in children\",\n       subtitle=\"data recorded at villages in The Gambia, Africa\",\n       caption=\"#30DayMapChallenge 2022 day 1 Points\\nDataSource: Gambia data from {geoR} package\\nMap: Federica Gazzelloni\",\n       color=\"Age in days\")+\n  ggthemes::theme_map()+\n  theme(text=element_text(family=\"Mukta\"),\n        legend.position = c(0.1,-0.1),\n        legend.direction = \"horizontal\",\n        legend.background = element_blank(),\n        legend.key.size = unit(10,units=\"pt\"),\n        legend.text = element_text(size=4),\n        legend.title = element_text(size=5),\n        plot.title = element_text(vjust=3,hjust=0.5),\n        plot.subtitle = element_text(vjust=3,hjust=0.5),\n        plot.caption = element_text(vjust=-9,hjust=0.5),\n        plot.title.position = \"panel\",\n        # margin(t = 0, r = 0, b = 0, l = 0, unit = \"pt\")\n        plot.margin = margin(10,1,20,1,unit = \"pt\"),\n        plot.background = element_rect(color = \"black\",fill=\"grey95\",size=0.05),\n        panel.background = element_rect(color = \"grey95\",fill=\"grey95\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# add a little Africa on a side\n# remotes::install_github(\"afrimapr/afrilearndata\")\n# library(afrilearndata)\nafr_sf <- afrilearndata::africountries\n# afr_sf%>%head\n\ngamb_sf <- afr_sf%>%filter(name_sw==\"Gambia\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nafrimap<-   ggplot()+\n  geom_sf(data=afr_sf,\n          aes(fill=pop_est),\n          size=0.1,\n          show.legend = F,alpha=0.1) +\n  geom_sf(data=gamb_sf,\n          fill=\"brown\",alpha=0.9)+\n  theme_void()\n```\n:::\n\n\nDraw the plot\n\n::: {.cell}\n\n```{.r .cell-code}\ncowplot::ggdraw()+\n  draw_plot(map)+\n  draw_plot(afrimap,scale = 0.2,\n            x=0.3,y=0.25)\n```\n:::\n\n\nSave it\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"day1_points.png\",\n       dpi=300,\n      bg=\"grey95\",\n       width = 6,height = 3.5)\n```\n:::\n",
    "supporting": [
      "day1_points_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}