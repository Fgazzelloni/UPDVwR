{
  "hash": "8368e72bcb91fdfde711c5a8f017199f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Movement'\nsubtitle: 'Welcome to #30DayMapChallenge 2022 day 23'\ndate: '2022-11-23'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2022/day23_movement/day23_movement.png'\nimage-alt: ''\ndescription: ''\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n\n# Overview\n\nMap of the Movements to Europe through the Mediterranean and Western Balkans migration routes, 2017 flows: `Italy overview`. DataSource: `@humdata`.\n\n\nSource\n\n- <https://data.world/iom/b8e28bd0-8bcb-47a5-bc90-775562d944a4/workspace/file?filename=2017-flows-to-europe-overview-dataset-3.xlsx>\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(sf)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# set the fonts\nlibrary(showtext)\nlibrary(sysfonts)\nlibrary(extrafont)\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi=320)\nfont_add_google(name=\"Averia Libre\",\n                family=\"Averia Libre\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\nX2017 <- read_excel(\"R_general_resources/30DayMapChallenge/2022/day23_movement/data/2017-flows-to-europe-overview-dataset-3.xlsx\", \n                    sheet = \"Origin Nationalites ITA-GRC-ESP\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nworld <- rnaturalearthdata::countries110                    \nitaly <- world_geo_data%>%\n  filter(sovereignt==\"Italy\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- X2017%>%\n  janitor::clean_names() %>%\n  left_join(world_geo_data,by=c(\"iso3_of_origin\"=\"sov_a3\"))\n\n\narrivals <- data%>%\n  group_by(iso3_of_origin) %>%\n  summarize(arrivals=sum(cumulative_arrivals))\n\ndata1 <- merge(arrivals,data) %>%\n  st_as_sf()\n\n\ndata_centroids <- data%>%\n  st_as_sf()%>%\n  st_centroid()\n\nitaly_centroid <- world_geo_data%>%\n  filter(sovereignt==\"Italy\")%>%\n  st_centroid()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstart_coords <- data_centroids%>%\n  st_coordinates()%>%\n  as.data.frame()%>%\n  filter(!X==\"NaN\")\n\nend_coords <- italy_centroid%>%\n  st_coordinates()%>%\n  as.data.frame()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- cbind(start_coords,end_coords)\n\nnames(df)<- c(\"lon_st\",\"lat_st\",\"lon_en\",\"lat_en\")\ndf%>%head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nen <- df %>%\n  st_as_sf(coords=c(\"lon_en\",\"lat_en\"),crs=4326)%>%\n  st_geometry()\n\nst <- df %>%\n  st_as_sf(coords=c(\"lon_st\",\"lat_st\"),crs=4326)%>%\n  st_geometry()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlines <- st_connect(st,en)\nst_bbox(world_geo_data)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(scico)\nggplot(world_geo_data)+\n  geom_sf(fill=\"grey90\",alpha=0.2)+\n  geom_sf(data=italy,fill=\"#c15a4f\")+\n  geom_sf(data=data1,aes(geometry=geometry,\n                         fill=arrivals,\n                         color=iso3_of_origin),\n          linewidth=0.1,\n          show.legend = T) +\n  guides(color=\"none\",alpha=\"none\") +\n  geom_sf(data= data1_centroids,\n          aes(color=iso3_of_origin),\n          size=0.05,\n          show.legend = FALSE)+\n  geom_sf(data=lines,\n          linewidth=0.01,\n          color=\"white\")+\n  coord_sf(xlim = c(-170,170),ylim = c(-80,80)) +\n  #scale_alpha_binned()+\n  scico::scale_color_scico_d(begin=0,end = 1)+\n  scico::scale_fill_scico(begin=0,end = 1,\n                          #alpha=0.5,\n                          palette = \"lisbon\",\n                          direction = 1)+\n  labs(title=\"Movements to Europe through the Mediterranean and Western Balkans migration routes\",\n       subtitle=\"2017 flows: Italy overview\",\n       fill=\"Arrivals\",\n       caption=\"#30DayMapChallenge 2022 Day 23: Movement\\nDataSource: @humdata | Map: Federica Gazzelloni (@fgazzelloni)\")+\n  ggthemes::theme_map() +\n  theme(text=element_text(family=\"Averia Libre\"),\n        plot.title = element_text(vjust = 2),\n        plot.caption = element_text(lineheight = 1.1,vjust = 2),\n        legend.background = element_blank(),\n        legend.position = c(0.05,0.1))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"day23_movement.png\",\n       bg=\"#89a5b9\",\n       width = 8.22,\n       height = 5.26,\n       dpi=280)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}