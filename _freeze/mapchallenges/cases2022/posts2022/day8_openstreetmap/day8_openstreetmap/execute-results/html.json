{
  "hash": "eff08280be131467adf8528eb5246681",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Data: OpenStreetMap'\nsubtitle: 'Welcome to #30DayMapChallenge 2022 day 8'\ndate: '2022-11-8'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2022/day8_openstreetmap/day8_openstreetmap.png'\nimage-alt: ''\ndescription: ''\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n\n# Overview\n\nMap of `Rome, Italy` city center with `military locations`.\n\n\n\n### Set the fonts\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(showtext)\nlibrary(sysfonts)\nlibrary(extrafont)\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi=320)\nfont_add_google(name=\"Gideon Roman\",\n                family=\"Gideon Roman\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# load libraries for data manipulation\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# search for data\nlibrary(osmdata)\n```\n:::\n\n\n\n\n\nSome important functions are: \n \n- getbb()             Get bounding box\n- opq()               Build an Overpass query\n- add_osm_feature()   Add a feature\n- osmdata_sf()        Return an object in sf format\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlocation <- \"Rome\"\ngetbb(location)\n\n# available_features()\nfeature <- \"military\"\navailable_tags(feature)\n\n# military points\nms <- opq(c(12.23447,41.65564,12.85576,42.14103)) %>% \n  add_osm_feature (key = \"military\") %>%\n  osmdata_sf (quiet = FALSE)\n\n# save(ms,file=\"ms.RData\")\nload(\"ms.RData\")\nms\n```\n:::\n\n\n\n\n\n\nTutorials\n\n- https://ggplot2tutor.com/tutorials/streetmaps\n- https://joshuamccrain.com/tutorials/maps/streets_tutorial.html\n- https://taraskaduk.com/posts/2021-01-18-print-street-maps/\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstreets <- opq(c(12.23447,41.65564,12.85576,42.14103)) %>% \n  add_osm_feature(key = \"highway\", \n                  value = c(\"motorway\", \"primary\", \n                            \"secondary\", \"tertiary\")) %>%\n  osmdata_sf()\n# save(streets,file=\"streets.RData\")\nload(\"streets.RData\")\nstreets\n\nsmall_streets <- opq(c(12.23447,41.65564,12.85576,42.14103)) %>% \n  add_osm_feature(key = \"highway\", \n                  value = c(\"residential\", \"living_street\",\n                            \"unclassified\",\n                            \"service\", \"footway\")) %>%\n  osmdata_sf()\n# save(small_streets,file=\"small_streets.RData\")\nload(\"small_streets.RData\")\nsmall_streets\n\nriver <- opq(c(12.23447,41.65564,12.85576,42.14103)) %>%\n  add_osm_feature(key = \"waterway\", value = \"river\") %>%\n  osmdata_sf()\n# save(river,file=\"river.RData\")\nload(\"river.RData\")\nriver\n```\n:::\n\n\n\n\n\nMake the map\n\nThe latitude of Rome, Italy is 41.902782, and the longitude is 12.496366\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = streets$osm_lines,\n          inherit.aes = FALSE,\n          color = \"black\",\n          linewidth = .1,\n          alpha = .8) +\n  geom_sf(data = small_streets$osm_lines,\n          inherit.aes = FALSE,\n          color = \"navy\",\n          linewidth = .1,\n          alpha = .8) +\n  geom_sf(data = river$osm_lines,\n          inherit.aes = FALSE,\n          color = \"#98c7d0\",# \"#33dbe7\",\n          linewidth = 1,\n          alpha = .8) +\n  geom_sf(data = ms$osm_points,\n          inherit.aes = FALSE,\n          color = \"grey40\",\n          shape=21,\n          stroke=0.1,\n          size = 1,\n          alpha = .8) +\n  geom_sf(data = ms$osm_points,\n          inherit.aes = FALSE,\n          color = \"red\",\n          size = 0.05,\n          alpha = .8) +\n  coord_sf(xlim=c(12.35,12.65),\n           ylim=c(41.78,42),\n           expand = FALSE) +\n  theme_void()+\n  theme(text=element_text(family=\"Gideon Roman\"),\n        plot.background = element_rect(fill=\"white\",linewidth=0.5),\n        panel.background = element_rect(fill=\"#dbd3c5\",linewidth=1),\n        plot.margin = margin(10,10,40,10,unit = \"pt\"))\n\n# save the base map\nggsave(\"base_map.png\", width = 6, height = 6)\n```\n:::\n\n\n\n\nDraw the map-viz\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cowplot)\n\nggdraw()+\n  draw_image(\"data/base_map.png\")+\n  draw_line(x=c(0.055,0.945),y=c(0.169,0.169),\n            size=25,color=\"#dedede\",alpha=0.7)+\n  draw_line(x=c(0.3,0.7),y=c(0.22,0.22),\n            size=1)+\n  draw_label(\"Rome\",\n             x=0.5,y=0.19,\n             size=14.5,\n             fontface = \"bold\",\n             fontfamily = \"Gideon Roman\")+\n  draw_label(\"41.9027°N/12.4964°E\",\n             x=0.5,y=0.149,\n             size=5,\n             fontfamily = \"Gideon Roman\") +\n  draw_label(\"OSM key: Military\",\n             x=0.5,y=0.125,\n             size=4,\n             fontfamily = \"Gideon Roman\") +\n  draw_label(\"#30DayMapChallenge 2022 Day 8: osmdata\\nDataSource: {osmdata}: Rome, Italy | Map: Federica Gazzelloni (@fgazzelloni)\",\n             x=0.5,y=0.07,\n             size=4,\n             lineheight = 1.8,\n             fontfamily = \"Gideon Roman\")\n\n# save final version\nggsave(\"day8_openstreetmap.png\", \n       dpi=150,\n       width = 5.8, \n       height = 6,\n       bg=\"white\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}