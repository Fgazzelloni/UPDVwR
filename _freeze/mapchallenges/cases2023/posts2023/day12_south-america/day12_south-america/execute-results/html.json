{
  "hash": "08f20fc4a53f07c3860c507e56c479b9",
  "result": {
    "markdown": "---\ntitle: 'South America'\nsubtitle: 'Welcome to #30DayMapChallenge 2023 day 12'\ndate: '2023-11-12'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2023/day12_south-america/day12_south-america.png'\nimage-alt: ''\ndescription: ''\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n# Overview\n\nFor this challenge I look back at day 8 Africa and the `total fertility rate` for replicating the steps for `South America`.\n\nDatasource: [Analyzing US Census Data: Methods, Maps, and Models in R](https://walker-data.com/census-r/working-with-census-data-outside-the-united-states.html?q=tfr#visualizing-idb-data), and the `{idbr}` package R Interface to the US Census Bureau International Data Base API.\n\n\nSource: \n<https://walker-data.com/census-r/working-with-census-data-outside-the-united-states.html>\n\n## Census Data with {idbr}\n\nNow you are all set to get ready downloading your favorite census data.   \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(idbr)\nlibrary(tidyverse)\n```\n:::\n\n\n### Get data for all countries\n\nHere the `tfr` variable is selected as interested in the differences in `total fertility rate` in 2021 in South America.\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- get_idb(\n  country = \"all\",\n  year = 2021,\n  variables = \"tfr\",\n  geometry = TRUE,\n)\n\ndata %>% head()\n```\n:::\n\n\n\n\nHave a look at the global total fertility rate in 2021.\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data, aes(fill = code)) + \n  theme_bw() + \n  geom_sf() + \n  coord_sf(crs = 'ESRI:54030') + \n  scale_fill_viridis_d()+\n  guides(fill=guide_legend(nrow = 10,title = \"\"))+\n  theme(legend.key.size = unit(2,units = \"pt\"),\n        legend.text = element_text(size=2),\n        legend.position = \"bottom\")\n```\n:::\n\n\n\n\n\n### Scrap the South America countries from Wikipedia:\n<https://en.wikipedia.org/wiki/South_America>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rvest)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsouth_america_data <- read_html(\"https://en.wikipedia.org/wiki/South_America\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsouth_america_countries <- south_america_data %>%\n  html_nodes(\"table\") %>%\n  .[[3]] %>%\n  html_table(fill = TRUE)\n\nsouth_america_countries %>% names()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsouth_america_countries <- south_america_countries%>%select('Country / Territory')%>%\n  unlist()\n```\n:::\n\n\n\n## Get the South America tfr data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsa <- get_idb(\n  country = south_america_countries,\n  year = 2021,\n  variables = \"tfr\",\n  geometry = TRUE,\n)\n\n\nsa %>% head()\n```\n:::\n\nCheck the range of the tfr:\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(sa$tfr)\n```\n:::\n\n\nSet a color range:\n\n::: {.cell}\n\n```{.r .cell-code}\ncol.range<- c(1,3)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(sa, aes(fill = tfr)) + \n  geom_sf(color=\"white\") + \n  geom_sf_text(aes(label=name),size=3,family=\"Roboto Condensed\")+\n  scale_fill_continuous(low = \"#006400\", \n                        high = \"#FF4500\",\n                        limits=col.range)+\n  ggtext::geom_richtext(x=0,y=0,\n                        hjust = 2,\n                        vjust=1.5,\n                        label=\"South<br>America\",\n                        fill = NA, \n                        label.color = NA,\n                        size=25,\n                        family = \"Gill Sans\")+\n    ggtext::geom_richtext(x=0,y=0,\n                        hjust = 1.4,\n                        vjust=-3,\n                        label=\"Total fertility rate by country in 2021\",\n                        fill = NA, \n                        label.color = NA,\n                        size=6,\n                        family = \"Gill Sans\")+\n  coord_sf(crs = 'ESRI:54030',clip = \"off\") + \n  labs(caption=\"#30DayMapChallenge 2023 - Day 12 South America\\nDataSource: wikipedia & {idbr} package | Map @fgazzelloni\\n\\n'Scale on map varies by more than 10%, scale bar may be inaccurate' {ggspatial}\",\n       fill=\"Total fertility rate (tfr)\")+\n  ggthemes::theme_map()+\n  theme(text=element_text(family = \"Gill Sans\"),\n        plot.caption = element_text(hjust=0),\n        legend.position = c(0.8,0.1),\n        legend.key.size = unit(10,units = \"pt\"),\n        legend.text = element_text(size=10),\n        legend.background = element_rect(color=\"#E6D2B8\",fill=\"#E6D2B8\"))+\n  ggspatial::annotation_scale()\n```\n:::\n\n\n\n### Save it!\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"day12_south-america.png\",\n       bg=\"#F4EBD9\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}