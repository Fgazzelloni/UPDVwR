{
  "hash": "b73e6eb7c57d730c0f9f0e08820bfd35",
  "result": {
    "markdown": "---\ntitle: 'OpenStreetMap'\nsubtitle: 'Welcome to #30DayMapChallenge 2023 day 15'\ndate: '2023-11-15'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2023/day15_openstreetmap/day15_openstreetmap.png'\nimage-alt: ''\ndescription: ''\noutput: html_document\nexecute: \n   eval: false\n   message: false\n   warning: false\n---\n\n\n\n# Overview\n\nOpenStreetMap data\n\n\nResources: <https://rspatialdata.github.io/osm.html>\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(osmdata)\nlibrary(ggmap)\n```\n:::\n\n\n\nLet's check available features, there are 263 features.\n\n::: {.cell}\n\n```{.r .cell-code}\navailable_features()\n```\n:::\n\n\n\n## Defining the bounding box\n\n?getbb\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvalencia_bb <- getbb(\"valencia\")\n```\n:::\n\n\n\n\n## Valencia Underground\n\n\n::: {.cell}\n\n```{.r .cell-code}\navailable_tags(\"location\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvalencia <-valencia_bb%>%\n  opq() %>%\n  add_osm_feature(key = \"location\",value=\"underground\") %>%\n  osmdata_sf()\n\nvalencia$osm_points%>%head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvalencia_map<- ggmap::get_map(location = \"Valencia\",\n                              maptype = \"stamen_terrain\",\n                              zoom=13)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggmap(valencia_map) +\n  geom_sf(\n    data = valencia$osm_polygons,\n    inherit.aes = FALSE,\n    colour = \"#cc161d\",\n    fill = \"#be2d42\",\n    size = 2\n  ) +\n    geom_sf(\n    data = valencia$osm_points,\n    inherit.aes = FALSE,\n    colour = \"#cc161d\",\n    fill = \"#be2d42\",\n    size = 0.2\n  ) +\n  labs(x = \"\", y = \"\")\n```\n:::\n\n\n\n## Vlencia Schools\n\n\n::: {.cell}\n\n```{.r .cell-code}\nosmdata::available_tags(\"amenity\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvalencia_schools <-\n  valencia_bb%>%\n  opq() %>%\n  add_osm_feature(key=\"amenity\",value=\"school\")%>%\n  osmdata_sf()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvalencia_map2<- ggmap::get_map(location = \"Valencia\",\n                              maptype = \"stamen_terrain_lines\",\n                              zoom=13)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggmap(valencia_map2) +\n  geom_sf(\n    data = valencia$osm_polygons,\n    inherit.aes = FALSE,\n    colour = \"#cc161d\",\n    fill = \"#be2d42\",\n    size = 2\n  ) +\n    geom_sf(\n    data = valencia$osm_points,\n    inherit.aes = FALSE,\n    colour = \"#cc161d\",\n    size = 0.2\n  ) +\n    geom_sf(\n    data = valencia_schools$osm_polygons,\n    inherit.aes = FALSE,\n    fill = \"#40E0D0\",color=\"#A0522D\",\n    size = 0.2\n  ) +\n  labs(title=\"València\")+\n  ggthemes::theme_map(base_size = 14,base_family = \"Gill Sans\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvalencia_streets <- valencia_bb %>%\n  opq() %>%\n  add_osm_feature(\"highway\", c(\"motorway\", \"primary\", \"secondary\", \"tertiary\")) %>%\n  osmdata_sf()\n\n# retrieving data of small streets in Lagos\nvalencia_small_streets <- valencia_bb %>%\n  opq() %>%\n  add_osm_feature(key = \"highway\", value = c(\"residential\", \"living_street\", \"unclassified\", \"service\", \"footway\")) %>%\n  osmdata_sf()\n\n# retrieving data of rivers in Lagos\nvalencia_rivers <- valencia_bb %>%\n  opq() %>%\n  add_osm_feature(key = \"waterway\", value = \"river\") %>%\n  osmdata_sf()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggmap(valencia_map2)+\n    geom_sf(data = valencia_streets$osm_lines, \n            inherit.aes = FALSE, \n            color = \"#ffbe7f\", linewidth = .2, alpha = .8) +\n  geom_sf(data = valencia_small_streets$osm_lines, \n          inherit.aes = FALSE, \n          color = \"#a6a6a6\", linewidth = .01, alpha = .8) +\n  geom_sf(data = valencia_rivers$osm_lines, \n          inherit.aes = FALSE, \n          color = \"#7fc0ff\", size = .8, alpha = .5)+\n  geom_sf(\n    data = valencia$osm_polygons,\n    inherit.aes = FALSE,\n    colour = \"#cc161d\",\n    fill = \"#be2d42\",\n    size = 2\n  ) +\n    geom_sf(\n    data = valencia$osm_points,\n    inherit.aes = FALSE,\n    aes(colour = \"#cc161d\"),\n    size = 0.2\n  ) +\n    geom_sf(\n    data = valencia_schools$osm_polygons,\n    inherit.aes = FALSE,\n    aes(fill = \"#40E0D0\",color=\"#A0522D\"),\n    size = 0.2,key_glyph = draw_key_pointrange\n  ) +\n    geom_sf(\n    data = valencia_schools$osm_polygons,\n    inherit.aes = FALSE,\n    color=\"#A0522D\",fill=NA,\n    size = 0.2,\n  ) +\n  scale_color_manual(values=c(\"#40E0D0\",\"#cc161d\"),labels=c(\"Schools\",\"Underground\"))+\n  scale_fill_manual(values=c(\"#40E0D0\"))+\n  guides(fill=\"none\",\n         color=guide_legend(title.position =\"left\"))+\n  coord_sf(clip=\"off\")+\n  labs(title=\"València, ES\",\n       subtitle=\"#30DayMapChallenge2023 Day 15 - OpenStreetMap\",\n       caption=\"DataSource: {osmdata} | Map: @fgazzelloni\",\n       color=\"\")+\n  ggthemes::theme_map(base_size = 14,base_family = \"Gill Sans\")+\n  theme(plot.title = element_text(hjust = 0.5,size=20),\n        plot.subtitle = element_text(size=10,hjust = 0.5),\n        plot.title.position = \"plot\",\n        legend.box.background = element_blank(),\n        #legend.background = element_blank(),\n        legend.position = c(0.8,0.05))+\n   ggspatial::annotation_scale(hjust=1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"day15_openstreetmap.png\",\n       scale = 0.5,\n       limitsize=F,\n       bg=\"#f0f0f0\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}