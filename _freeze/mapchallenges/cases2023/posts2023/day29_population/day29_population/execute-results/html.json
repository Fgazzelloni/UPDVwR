{
  "hash": "aa4f60f8b01534f449c9888844301f3a",
  "result": {
    "markdown": "---\ntitle: 'Population'\nsubtitle: 'Welcome to #30DayMapChallenge 2023 day 29'\ndate: '2023-11-29'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2023/day29_population/day29_population.png'\nimage-alt: ''\ndescription: ''\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n# Overview\n\nThis `Ireland Map` explore the population density in the area. Data is from the latest version of `Kontur Population` available at `United Nations Humanitarian Data Exchange (HDX)`. \n\n<center>\n![](https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2023/day29_population/day29_population.png)</center>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(R.utils)\nlibrary(httr)\nlibrary(sf)\n```\n:::\n\n\nDownload and unzip `kontur` data: 20231101\n\n::: {.cell}\n\n```{.r .cell-code}\nfile_name <- \"ireland-population.gpkg.gz\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <-\"https://geodata-eu-central-1-kontur-public.s3.amazonaws.com/kontur_datasets/kontur_population_IE_20231101.gpkg.gz\"\nget_population_data <- function() {\n    res <- httr::GET(\n        url,\n        write_disk(file_name),\n        progress()\n    )\n\n    R.utils::gunzip(file_name, remove = F)\n}\nget_population_data()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nload_file_name <- gsub(\".gz\", \"\", file_name)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nie_sf <- sf::st_read(load_file_name)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nie_sf_lonlat <- ie_sf%>%\n  st_as_sf(crs = \"+proj=utm +zone=29\") %>%\n  st_transform(crs = \"+proj=longlat +datum=WGS84\")  \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nie_sf_lonlat%>%\n  st_bbox()\n```\n:::\n\n\n\nFirst raw image: Ireland population data Kontur (2023-11-01)\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n    geom_sf(\n        data = ie_sf_lonlat,\n        aes(color = population),\n        lwd=0.1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nie_geo <- ie_sf_lonlat %>%\n  st_geometry()\n\n\nhexgrid <- st_make_grid(ie_geo,\n                        cellsize = 1e4, \n                        what = 'polygons',\n                        square = FALSE ## !\n                        ) %>%\n  st_as_sf(crs = \"+proj=utm +zone=29\")%>%\n  st_transform(crs = \"+proj=longlat +datum=WGS84\") \n\n\nhexgrid2 <- hexgrid[c(unlist(st_contains(ie_geo, hexgrid)), \n                        unlist(st_overlaps(ie_geo, hexgrid))) ,] \n```\n:::\n\n\n\nList of Cities, boroughs and towns up to 2014:\n\n- <https://simplemaps.com/data/ie-cities>\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nireland_cities_tb <- read.csv(\"data/ie.csv\")\nireland_cities_tb%>%head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nie_cities_sf <- ireland_cities_tb%>%\n  st_as_sf(coords=c(\"lng\",\"lat\"),crs=\"+proj=longlat +datum=WGS84\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nie_cities_sf%>%summary()\n\nie_cities_sf<-ie_cities_sf%>%\n  filter(!is.na(population))\n```\n:::\n\n\n\nFonts\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sysfonts)\nlibrary(showtext)\nsysfonts::font_add_google(\"Ubuntu Condensed\",\"Ubuntu Condensed\")\ntext<-\"Ubuntu Condensed\"\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi=320)\nlibrary(ggspatial)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(20231129)\np <- ggplot() +\n    geom_sf(data = ie_sf_lonlat,\n        mapping=aes(color = population),\n        lwd=0.1)+\n  scale_color_gradient(low = alpha(\"#cdbdcc\",0.01),\n                       high = \"#a60845\",\n                       guide = \"none\")+\n  ggnewscale::new_scale_color()+\n  geom_sf_text(data=ie_cities_sf,\n               mapping=aes(label=city,\n                           color=population,\n                           size=population),\n               show.legend = F,\n               family=text,\n               check_overlap = T)+\n  scale_color_gradient(low = alpha(\"#c2bfbf\",0.9),high = \"#a60845\",)+\n  coord_sf(clip=\"off\")+\n  ggthemes::theme_map()+\n  theme(text=element_text(family=text),\n        plot.caption = element_text(hjust = 0.5),\n        legend.background = element_blank(),\n        legend.position = \"none\",\n        legend.key.size = unit(7,units = \"pt\"),\n        legend.text = element_text(size=7))+\n    ggspatial::annotation_north_arrow(location = \"bl\", \n                         which_north = \"true\",\n                         pad_x = unit(-0.9, \"cm\"), \n                         pad_y = unit(0.4, \"cm\"),\n                         height = unit(0.8, \"cm\"),\n                         width = unit(0.8, \"cm\"),\n                         style = north_arrow_fancy_orienteering)+\n  ggspatial::annotation_scale(pad_x = unit(-0.9, \"cm\"),\n                              height = unit(0.18, \"cm\"),\n                              text_family=text,\n                              text_cex = 0.5)+\n  labs(caption=\"Cities by population density\")\np\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np1<- ggplot() +\n    geom_sf(data = ie_sf_lonlat,\n        mapping=aes(color = population),\n        lwd=0.5)+\n  scale_color_gradient(low = alpha(\"#cdbdcc\",0.01),high = \"#a60845\",guide=guide_colorbar(title = \"Population\"))+\n  labs(caption=\"Country population density\")+\n   ggthemes::theme_map()+\n    theme(text=element_text(family=text),\n          plot.caption = element_text(hjust = 0.5),\n          legend.background = element_blank(),\n          legend.position = c(0.95,0.1),\n          legend.key.size = unit(6,units = \"pt\"),\n          legend.title = element_text(size=6.1),\n          legend.text = element_text(size=7))\np1\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cowplot)\n\nggdraw()+\n  draw_plot(p,x=-0.2,y=0)+\n  draw_plot(p1,x=0.2,y=0)+\n  draw_label(label=\"Ireland\",\n             x=0.1,y=0.93,\n             size=25,\n             fontfamily=text,\n             fontface = \"bold\")+\n  draw_label(label=\"Kontur population density 2023-11-01\\n#30DayMapChallenge 2023 Day 29: Population\\nMap: @fgazzelloni\",\n             x=0.55,y=0.93,\n             size=5,\n             fontfamily=text,\n             fontface = \"bold\")\nggsave(\"day29_population.png\",bg=\"#f6f7f9\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}