{
  "hash": "c4b2fe052af270b33fc099700e6388a9",
  "result": {
    "markdown": "---\ntitle: 'Choropleth'\nsubtitle: 'Welcome to #30DayMapChallenge 2023 day 13'\ndate: '2023-11-13'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2023/day13_choropleth/day13_choropleth.png'\nimage-alt: ''\ndescription: ''\noutput: html_document\nexecute: \n   eval: false\n   message: false\n   warning: false\n---\n\n\n# Overview\n\nThis map shows the Epidemic transition of new HIV infections, metrics trend from 2010 to 2020. Percentage contribution of each country's change to the total change. Data is from the `Global data on HIV epidemiology and response` (aidsinfo.unaids.org)\n\n<center>![](https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2023/day13_choropleth/day13_choropleth.png)</center>\n\nAIDS: percentage contribution of each country's change to the total change\n\nDataSource: <https://aidsinfo.unaids.org/>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\naids <- read_csv(\"data/Epidemic transition metrics_Trend of new HIV infections.csv\")\n\naids%>%head\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\naids_avg <- aids %>%\n  select(!contains(\"Footnote\"))%>%\n  select(Country,'2010','2010_lower','2010_upper','2020','2020_lower','2020_upper')%>%\n  janitor::clean_names()%>%\n  mutate(x2010=as.numeric(str_extract(x2010,\"([0-9]+)\")),\n         x2010_lower=as.numeric(str_extract(x2010_lower,\"([0-9]+)\")),\n         x2010_upper=as.numeric(str_extract(x2010_upper,\"([0-9]+)\")),\n         avg_2010=(x2010_upper-x2010_lower)/2,\n         x2020=as.numeric(str_extract(x2010,\"([0-9]+)\")),\n         x2020_lower=as.numeric(str_extract(x2020_lower,\"([0-9]+)\")),\n         x2020_upper=as.numeric(str_extract(x2020_upper,\"([0-9]+)\")),\n         avg_2020=(x2020_upper-x2020_lower)/2,\n         aids_change=(avg_2020-avg_2010),\n         aids_change2=round(aids_change/sum(aids_change,na.rm = T),5))%>%\n  select(1,8,9,10,11)\n\naids_avg %>%\n  select(aids_change,aids_change2)%>%\n  summary()\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(tmap)\ndata(\"World\")\n\naids_map <- aids_avg%>%\n  left_join(World %>%select(country=name,geometry),by=\"country\")%>%\n  st_as_sf()%>%\n  st_transform(crs=\"ESRI:54030\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntext <- tibble(text=c(\"In dark/light grey are Countries whose Estimates were not available at the time of publication\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot()+\n  geom_sf(data=World,color=\"grey25\",fill=\"grey75\")+\n  geom_sf(data=aids_map,\n          mapping=aes(geometry=geometry,fill=aids_change),\n          color=\"red\")+\n  scale_fill_gradient(labels=scales::label_percent(),low=\"white\",high = \"red\")+\n  coord_sf(crs=\"ESRI:54030\",clip = \"off\")+\n  labs(title=\"Epidemic transition of new HIV infections\",\n       subtitle=\"Metrics Trend 2010-2020\",\n       caption=\"#30DayMapChallenge 2023 Day 13 - Choropleth\\nPercentage contribution of each country's change to the total change\\nDataSource: Global data on HIV epidemiology and response (aidsinfo.unaids.org)\\nMap: @fgazzelloni\",\n       fill=\"HIV Change (%)\\nIn dark/light grey are Countries\\nwhose Estimates were not available\\nat the time of publication\\nProj:ESRI:54030\")+\n  theme(text=element_text(face=\"bold\"),\n        panel.grid = element_line(color=\"grey25\"),\n        plot.title = element_text(size=20.5),\n        plot.subtitle = element_text(color=\"grey25\"),\n        plot.caption = element_text(color=\"grey25\"),\n        legend.title = element_text(size=4),\n        legend.text = element_text(size=8))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"day13_choropleth.png\",height = 5)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}