{
  "hash": "4521915cc8f28753f5de17f71a375e6f",
  "result": {
    "markdown": "---\ntitle: 'Red'\nsubtitle: 'Welcome to #30DayMapChallenge 2021 day 6'\ndate: '2021-11-6'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2021/day6_red/drought_red.gif'\nimage-alt: ''\ndescription: ''\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n# Overview\n\nThis `US Drought map` shows available values by County - Jan to July 2021, data is from `TidyTuesday` 2021 week 30.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\ntuesdata <- tidytuesdayR::tt_load(2021, week = 30)\n\ndrought <- tuesdata$drought\n\n\nintensity_impacts<- c(\"D0\"=\"Abnormally Dry\",\n                      \"D1\"=\"Moderate Drought\",\n                      \"D2\"=\"Severe Drought\",\n                      \"D3\"= \"Extreme Drought\",\n                      \"D4\"=\"Exceptional Drought\")\n\ndrought_short <- drought %>%\n  dplyr::select(-map_date,-stat_fmt) %>%\n  filter(!drought_lvl==\"None\",!area_pct==0)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(raster)\nlibrary(spData)\nlibrary(spDataLarge)\n\nlibrary(maps)\nlibrary(viridis)\nlibrary(ggthemes)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(zipcodeR)\nzipcodeR::download_zip_data()\n\ngeo_codes<- zipcodeR::search_state(drought_short$state_abb)%>%\n  dplyr::select(major_city,county,state,lat,lng,\n                population,population_density,\n                land_area_in_sqmi,water_area_in_sqmi,\n                housing_units,occupied_housing_units,\n                median_home_value,median_household_income) %>%\n  drop_na()\n\n\nmy_geo_codes_df<-geo_codes%>%\n  dplyr::select(state,lat,lng)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndrought_short_map <- drought_short %>%\n  arrange(valid_start)%>%\n  mutate(year=lubridate::year(valid_start),\n         month=lubridate::month(valid_start))%>%\n  filter(str_detect(valid_start,\"2021\")) %>%\n  #filter(month==c(1,2,3)) %>%\n  group_by(month,state_abb,drought_lvl) %>%\n  summarize(med_area_pct=round(median(area_pct),2))%>%\n  ungroup() %>%\n  filter(!med_area_pct==0) %>%\n  left_join(my_geo_codes_df,by=c(\"state_abb\"=\"state\")) %>%\n  mutate(month = month.name[month])\n\n\nmy_df <- drought_short_map%>%count(month,sort=T)%>%\n  dplyr::select(-n)%>%\n  mutate(month_id=row_number())%>%\n  inner_join(drought_short_map,by=\"month\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(extrafont)\n#loadfonts()\n#fonts()\n\ndroughts_family <- \"Roboto Condensed\"\n\nlibrary(gganimate)\nlibrary(cartography)\n\nred.pal<-c(\"red\", \"orangered\", \"firebrick1\", \"brown3\", \"firebrick\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nus_county_map <- map_data(\"county\")\nus_state_map <- map_data(\"state\")\n\nggplot() +\n  geom_point(data=subset(my_df,lat>25&lat<50),\n             aes(x=lng,y=lat,color=factor(drought_lvl)),\n             alpha=0.5,size=.4) +\n  \n  geom_polygon(data=us_county_map,aes(x=long,y=lat,group = group),\n               fill=NA,color = \"darkred\",size=0.2) +\n  \n  geom_polygon(data=us_state_map,aes(x=long,y=lat,group = group),\n               fill=NA,color = \"red\",size=0.4) +\n  \n  scale_color_manual(labels = intensity_impacts,\n                     values=red.pal) +\n  ggthemes::theme_map() +\n  theme(legend.position = \"none\",\n        legend.title = element_text(family = droughts_family),\n        legend.text = element_text(size=8,family =droughts_family),\n        legend.background = element_blank(),\n        legend.box.background = element_blank(),\n        legend.key = element_blank(),\n        strip.background = element_blank(),\n        strip.text = element_text(family = droughts_family),\n        plot.title =element_text(size=25,face=\"bold\",family =droughts_family,color=\"black\"),\n        plot.subtitle =element_text(size=12,face=\"bold\",family =droughts_family),\n        plot.caption =element_text(size=9,family =droughts_family,hjust = 0),\n        plot.caption.position = \"panel\",\n        plot.title.position = \"panel\") +\n\n# gganimate specific bits:\n       labs(title=\"US Drought variation - Month: {closest_state}\",\n       subtitle=\"\",\n       caption=\"US Drought map: available values by County - Jan to July 2021\\n\n       #30DayMapChallenge day6-red - graphic: Federica Gazzelloni\")+\n        transition_states(month) +\n        ease_aes('linear')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save at gif:\nanim_save(\"drought_red.gif\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}