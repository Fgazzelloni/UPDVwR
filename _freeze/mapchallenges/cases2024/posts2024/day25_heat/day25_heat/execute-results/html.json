{
  "hash": "87d1e4bda3dba479617f19aeb51594b6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Heat Map'\nsubtitle: 'Welcome to #30DayMapChallenge 2024 Day 25'\ndate: '2024-11-25'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2024/day25_heat/day25_heat.png'\nimage-alt: 'day25_heat'\ndescription: 'Heat Map'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n\n![Heat Map](https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2024/day25_heat/day25_heat.png)\n\nCreate a Heat Map with Spatial Data to make a map that shows the density of points.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(rnaturalearth)\nlibrary(sf)\nlibrary(geodata)\nlibrary(terra)\nlibrary(showtext)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nspain_boundaries <- rnaturalearth::ne_countries(scale = \"medium\", \n                                                country = \"Spain\", \n                                                returnclass = \"sf\")\nggplot() +\n  geom_sf(data = spain_boundaries, \n          fill = \"white\", color = \"black\") +\n  coord_sf(xlim = c(-10, 5), ylim = c(35, 45))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsp_bbox <- sf::st_bbox(spain_boundaries)\nsp_bbox\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(geodata)\nspain <- worldclim_country(\"Spain\", \n                           var=\"tmax\", \n                           path=tempdir())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nspain %>% plot()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- spain$ESP_wc2.1_30s_tmax_11\nplot(dat)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% class\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% terra::rast()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat_sp <- crop(dat, ext( c(-10, 3, 35.5, 45)))\ndat30 <- aggregate(dat_sp, fact = 1, fun = mean)\nplot(dat30)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat_sp %>%\n  as.data.frame(xy = TRUE) %>%\n  head()\n```\n:::\n\n\n\nSet the fonts:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add_google(name = 'Cormorant Garamond', \n                family = 'Garamond')\nshowtext_auto()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat_sp %>%\n  aggregate(dat_sp, fact = 9, fun = mean) %>%\n  as.data.frame(xy = TRUE) %>%\n  ggplot() +\n  geom_tile(aes(x = x, y = y, \n                fill = `ESP_wc2.1_30s_tmax_11`),\n                color= \"grey30\",\n                linewidth = 0.01) +\n  scale_fill_gradient2(low = \"green\",\n                       mid = \"gold\",\n                       high =\"red\",\n                       midpoint = 1,\n                       na.value = \"grey50\",\n                       transform = \"identity\",\n                       name = \"\") +\n  labs(title = \"November Heat Max - Spain\",\n       subtitle = \"Avg-Maximum Temperature\",\n       caption = \"Data: WorldClim | #30DayMapChallenge Day25 | @fgazzelloni\") +\n  coord_sf(clip = \"off\") +\n  ggthemes::theme_map() +\n  theme(text = element_text(family = \"Garamond\",\n                            color = \"grey90\"),\n        plot.title = element_text(size = 48, \n                                  hjust = 0.5,\n                                  face = \"bold\"),\n        plot.subtitle = element_text(size = 35, \n                                     hjust = 0.5,\n                                     face = \"bold\"),\n        plot.caption = element_text(size = 20, \n                                    face = \"italic\"),\n        \n        legend.position = c(0,-0.2),\n        legend.direction = \"horizontal\",\n        legend.text = element_text(size = 20),\n        legend.title = element_text(size = 0),\n        legend.key.size = unit(0.4, \"cm\"),\n        legend.background = element_rect(fill = \"transparent\"),\n        panel.grid = element_blank(),\n        panel.border = element_blank(),\n        axis.text = element_blank(),\n        axis.title = element_blank())\n\nggsave(\"day25_heat.png\", \n       bg = \"grey20\",\n       width = 8, height = 8, \n       units = \"cm\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}