{
  "hash": "0054f22165ef0e99f0c31776a98795d0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Only Circular Shapes Map'\nsubtitle: 'Welcome to #30DayMapChallenge 2024 Day 24'\ndate: '2024-11-24'\nimage: 'https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2024/day24_only_circular_shapes/day24_only_circular_shapes.png'\nimage-alt: 'day24_only_circular_shapes'\ndescription: 'Only Circular Shapes Map'\noutput: html_document\nexecute: \n   eval: false\n---\n\n\n\n\n![Only Circular Shapes Map](https://raw.githubusercontent.com/Fgazzelloni/30DayMapChallenge/master/2024/day24_only_circular_shapes/day24_only_circular_shapes.png)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncases <- read.csv(\"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv\")\ndeaths <- read.csv(\"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncases1 <- cases %>%\n  pivot_longer(cols = starts_with(\"X\"),\n               names_to = \"date\",\n               values_to = \"cases\") %>%\n  mutate(date = gsub(\"X\", \"\", date),\n         date = as.Date(date, format = \"%m.%d.%y\")) %>%\n  janitor::clean_names()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndeaths1 <- deaths %>%\n  pivot_longer(cols = starts_with(\"X\"),\n               names_to = \"date\",\n               values_to = \"deaths\") %>%\n  mutate(date = gsub(\"X\", \"\", date),\n         date = as.Date(date, format = \"%m.%d.%y\")) %>%\n  janitor::clean_names()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nCOVID19 <- cases1 %>%\n  left_join(deaths1, \n            by = c(\"province_state\", \n                   \"country_region\", \n                   \"lat\", \"long\", \"date\")) %>%\n  mutate(cases = ifelse(is.na(cases), 0, cases),\n         deaths = ifelse(is.na(deaths), 0, deaths)) %>%\n  group_by(country_region, date) %>%\n  mutate(cases = sum(cases),\n         deaths = sum(deaths),\n         cfr = round(deaths / cases, 3)) %>%\n  filter(cases > 0) %>%\n  arrange(country_region, date)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nworldmap <- map_data(\"world\") %>%\n  filter(!region == \"Antarctica\")\n\ncentroids <- COVID19 %>%\n  group_by(country_region, lat, long) %>%\n  reframe(tot_cases = sum(cases),\n          tot_deaths = sum(deaths),\n          avg_cfr = round(mean(cfr), 3)) %>%\n  distinct()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_polygon(data = worldmap,\n               aes(x = long, y = lat, group = group),\n               fill = \"grey\",\n               color = \"white\") +\n  geom_point(data = centroids,\n             aes(x = long, y = lat,\n             size = tot_cases,\n             color = log(avg_cfr)), \n             alpha = 0.5) +\n  scale_size_continuous(\n        labels = scales::unit_format(unit = \"M\", \n                                     scale = 1e-6)) +\n  scale_color_viridis_c() +\n  coord_quickmap() +\n  labs(title = \"COVID-19 Cases by Country\",\n       caption = \"Circle size: total cases, Color: average CFR\", \n      size= \"Total cases (M)\",\n      color= \"Average CFR (log scale)\",\n      x = \"\", y = \"\") +\n  theme(axis.text = element_blank(),\n        plot.subtitle = element_text(size = 8))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(viridis)\n\n# Clean and prepare the data (as in your original script)\ncases <- read.csv(\"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv\")\ndeaths <- read.csv(\"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv\")\n\ncases1 <- cases %>%\n  pivot_longer(cols = starts_with(\"X\"),\n               names_to = \"date\",\n               values_to = \"cases\") %>%\n  mutate(date = gsub(\"X\", \"\", date),\n         date = as.Date(date, format = \"%m.%d.%y\")) %>%\n  janitor::clean_names()\n\ndeaths1 <- deaths %>%\n  pivot_longer(cols = starts_with(\"X\"),\n               names_to = \"date\",\n               values_to = \"deaths\") %>%\n  mutate(date = gsub(\"X\", \"\", date),\n         date = as.Date(date, format = \"%m.%d.%y\")) %>%\n  janitor::clean_names()\n\nCOVID19 <- cases1 %>%\n  left_join(deaths1, \n            by = c(\"province_state\", \n                   \"country_region\", \n                   \"lat\", \"long\", \"date\")) %>%\n  mutate(cases = ifelse(is.na(cases), 0, cases),\n         deaths = ifelse(is.na(deaths), 0, deaths)) %>%\n  group_by(country_region, date) %>%\n  mutate(cases = sum(cases),\n         deaths = sum(deaths),\n         cfr = round(deaths / cases, 3)) %>%\n  filter(cases > 0) %>%\n  arrange(country_region, date)\n\ncentroids <- COVID19 %>%\n  group_by(country_region, lat, long) %>%\n  reframe(tot_cases = sum(cases),\n          tot_deaths = sum(deaths),\n          avg_cfr = round(mean(cfr), 3)) %>%\n  distinct()\n\n# Create the circular shapes map\nggplot() +\n  # Base layer with empty background\n  geom_point(data = centroids,\n             aes(x = long, y = lat,\n                 size = tot_cases,\n                 color = log(avg_cfr)), \n             alpha = 0.6) +\n  scale_size_continuous(\n    range = c(3, 15),  # Adjust size range for better visualization\n    labels = scales::unit_format(unit = \"M\", scale = 1e-6),\n    name = \"Total Cases (M)\"\n  ) +\n  scale_color_viridis_c(\n    option = \"magma\",  # Use a striking palette\n    name = \"Avg CFR (log scale)\"\n  ) +\n  coord_quickmap() +\n  labs(\n    title = \"Only Circular Shapes\",\n    subtitle = \"COVID-19 Cases by Country\",\n    caption = \"Size: Total cases | Color: Average CFR (log scale)\\n#30DayMapChallenge Day24 | @fgazzelloni\",\n    x = NULL, y = NULL\n  ) +\n  ggthemes::theme_map() +\n  theme(legend.position = \"none\",\n    panel.background = element_rect(fill = \"ghostwhite\", color = NA),  # Clean background\n    plot.background = element_rect(fill = \"white\", color = NA),\n    plot.title = element_text(size = 22, face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(size = 14, hjust = 0.5, color = \"gray40\"),\n    plot.caption = element_text(size = 10, hjust = 0))\n```\n:::\n\n\n\n\nSave it as png:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"day24_only_circular_shapes.png\", \n       bg = \"white\",\n       width = 8, height = 6, dpi = 300)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}