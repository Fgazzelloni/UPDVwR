# 3 state                          0  0
# 4 county_population              1  0.00000180
# 5 covid_cases_per_100k           0  0
# 6 GEOID                       4911  0.00884
# 7 NAME                        4911  0.00884
# 8 name                        4911  0.00884
# 9 variable                    4911  0.00884
# 10 estimate                    4987  0.00898
# 11 moe                         4987  0.00898
# 12 geometry                       0  0
# Load the library
library(tidyverse)
library(geojsonio)
library(sf)
# Set the fonts
library(showtext)
library(sysfonts)
library(extrafont)
showtext::showtext_auto()
showtext::showtext_opts(dpi=320)
font_add_google(name="Island Moments",
family="Island Moments")
us_covid <- read_csv("~/Documents/R/R_general_resources/EDA_and_maps/30DayMapChallenge/2022/day14_hexagons/covid_cases_by_County.csv")
covid_data <- us_covid%>%
select(county,
county_fips,
state,
county_population,
covid_cases_per_100k) %>%
distinct()
# source: https://walker-data.com/tidycensus/reference/get_decennial.html
library(tidycensus)
options(tigris_use_cache = TRUE)
# tarr <- get_acs(geography = "county",
#                 variables = "B19013_001",
#                 geometry = TRUE,
#                 year = 2020)
#
# save(tarr,file="data/tarr.RData")
load("~/Documents/R/R_general_resources/EDA_and_maps/30DayMapChallenge/2022/day14_hexagons/data/tarr.RData")
# tarr%>%count(NAME)
tarr2 <- tarr%>%
separate(NAME,into=c("county","name"),remove=F,sep=",")
coords <- tarr2%>%
st_centroid() %>%
st_coordinates()
# check the dimensions
# tarr2%>%dim
# coords%>%dim
# covid_data%>%dim
full <- cbind(tarr2,coords)
df <- covid_data%>%
left_join(full,by=c("county"="county")) %>%
distinct()%>%
mutate(county=as.factor(county))
df2 <- covid_data%>%
left_join(tarr2,by=c("county"="county")) %>%
distinct()
df3 <- df2%>%
st_as_sf()
# df%>%DataExplorer::profile_missing()
# A tibble: 12 × 3
# feature              num_missing pct_missing
# <fct>                      <int>       <dbl>
#   1 county                         0  0
# 2 county_fips                    0  0
# 3 state                          0  0
# 4 county_population              1  0.00000180
# 5 covid_cases_per_100k           0  0
# 6 GEOID                       4911  0.00884
# 7 NAME                        4911  0.00884
# 8 name                        4911  0.00884
# 9 variable                    4911  0.00884
# 10 estimate                    4987  0.00898
# 11 moe                         4987  0.00898
# 12 geometry                       0  0
ggplot()+
# geom_point(data= df, aes(X,Y),inherit.aes = F)+
stat_summary_hex(data= df, aes(x=X,y=Y,z=covid_cases_per_100k),
linewidth=0.01,
inherit.aes = F)+
geom_sf(data=tarr2,aes(geometry=geometry),
fill=NA,
linewidth=0.05)+
coord_sf(xlim = c(-125,-68),ylim = c(20,50))+
scale_fill_viridis_c(option = "H")+
labs(title="United States of America",
subtitle = "Covid Cases per 100k",
fill="Value",
caption="#30DayMapChallenge 2022 Day 14: Hexagons\nDataSource: CDC Covid data & Census data from {tidycensus}\nMap: Federica Gazzelloni (@fgazzelloni)")+
ggthemes::theme_map()+
theme(plot.caption = element_text(lineheight = 1.5,size=5),
plot.title = element_text(size=14),
legend.background = element_blank())
# write lines to add the image to each post's to page
library(stringr)
library(purrr)
library(readr)
dirs <- list.dirs("content/mapchallenge/cases2021/posts2021")
files <- list.files(dirs,pattern = ".qmd$",
full.names = TRUE)
files
for (f in files) {
# Read file
x <- readLines(f)
# Identify YAML boundaries (---)
yaml_start <- which(x == "---")[1]
yaml_end   <- which(x == "---")[2]
yaml <- x[yaml_start:yaml_end]
# Extract the image URL
image_line <- yaml[str_detect(yaml, "^image:")]
image_url <- str_extract(image_line, "https?://.*\\.png")
x <- readLines(f)
# Identify YAML boundaries (---)
yaml_start <- which(x == "---")[1]
yaml_end   <- which(x == "---")[2]
yaml <- x[yaml_start:yaml_end]
# Create markdown section to append
md_block <- c(
"",
paste0("<center>![](", image_url, ")</center>"),
"")
# Reassemble file: YAML + appended block + original body
new_content <- c(yaml,
md_block,
x[(yaml_end + 1):length(x)])
# Write back
writeLines(new_content, f)
message("Updated: ", f)
}
bookdown::publish_book()
path <- "content/chartchallenge/cases2021/posts2021"
dirs <- list.dirs(path, recursive = FALSE)
dirs
files <- list.files(dirs, full.names = TRUE)
files <- list.files(dirs, pattern = "\\.(jpg|png|jpeg)$", ,
full.names = TRUE)
files
files <- list.files(dirs, pattern = "\\.(jpg|png|jpeg|gif)$", ,
full.names = TRUE)
files
image_files <- list.files(dirs, pattern = "\\.(jpg|png|jpeg|gif)$", ,
full.names = TRUE)
image_files
# create a folder and put all images from a directory in r
dircreate("content/chartchallenge/cases2021/posts2021/images_folder")
# create a folder and put all images from a directory in r
dir.create("content/chartchallenge/cases2021/posts2021/images_folder")
file.copy(image_files, "content/chartchallenge/cases2021/posts2021/images_folder")
# create a folder and put all images from a directory in r
dir.create("content/chartchallenge/cases2022/posts2022/images_folder")
path <- "content/chartchallenge/cases2022/posts2022"
dirs <- list.dirs(path, recursive = FALSE)
dirs
image_files <- list.files(dirs, pattern = "\\.(jpg|png|jpeg|gif)$", ,
full.names = TRUE)
image_files
file.copy(image_files, "content/chartchallenge/cases2022/posts2022/images_folder")
# create a folder and put all images from a directory in r
dir.create("content/chartchallenge/cases2023/posts2023/images_folder")
path <- "content/chartchallenge/cases2023/posts2023"
path
dirs <- list.dirs(path, recursive = FALSE)
dirs
image_files <- list.files(dirs, pattern = "\\.(jpg|png|jpeg|gif)$", ,
full.names = TRUE)
image_files
file.copy(image_files, "content/chartchallenge/cases2023/posts2023/images_folder")
bookdown::publish_book()
dirs <- list.dirs("~/Documents/R/AAA_websites/UPDVwR/content/chartchallenge/cases2021/posts2021")
dirs
files <- list.files(dirs,
pattern = ".png$|.jpg$|.jpeg$|.gif$",
full.names = T)
files
file.remove(files)
dirs <- list.dirs("~/Documents/R/AAA_websites/UPDVwR/content/chartchallenge/cases2021/posts2021")
dirs
dirs <- list.dirs("~/Documents/R/AAA_websites/UPDVwR/content/chartchallenge/cases2021/posts2021")
dirs
files <- list.files(dirs,pattern = ".qmd$",
full.names = TRUE)
files
library(stringr)
library(purrr)
# Folder containing the .qmd files
root <- "~/Documents/R/AAA_websites/UPDVwR/content/chartchallenge/cases2021/posts2021"
files <- list.files(root, pattern = "\\.qmd$", full.names = TRUE)
files
dirs <- list.dirs(root)
dirs
files <- list.files(dirs, pattern = "\\.qmd$", full.names = TRUE)
files
# Base URL for RAW GitHub images
base_url <- "https://raw.githubusercontent.com/Fgazzelloni/30DayChartChallenge/refs/heads/main/data/Edition_2021/images/"
?tools::file_path_sans_ext
for (f in files) {
# Read file
x <- readLines(f)
# Locate YAML boundaries (---)
yaml_start <- which(x == "---")[1]
yaml_end   <- which(x == "---")[2]
# Extract filename without extension → used for the image name
fname <- basename(f)
stem <- tools::file_path_sans_ext(fname)
# Construct GitHub RAW URL
image_url <- paste0(base_url, stem, ".png")
# Replace (or add) the image: line inside YAML
x_yaml <- x[yaml_start:yaml_end]
has_image <- any(str_detect(x_yaml, "^image:"))
if (has_image) {
# Replace existing image line
x_yaml <- str_replace(
x_yaml,
"^image:.*",
paste0("image: '", image_url, "'")
)
} else {
# Insert new image line just before closing ---
x_yaml <- append(x_yaml, paste0("image: '", image_url, "'"), after = 1)
}
# Reassemble file
new_content <- c(
x[1:(yaml_start - 1)],
x_yaml,
x[(yaml_end + 1):length(x)]
)
# Write changes
writeLines(new_content, f)
message("Updated image URL in: ", fname)
}
library(tidytuesdayR)
library(tidyverse)
library(showtext)
library(ggtext)
library(scales)
library(extrafont)
library(patchwork)
library(cowplot)
library(ragg)
library(rmarkdown)
library(hrbrthemes)
library(wesanderson)
sephora <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-30/sephora.csv')
ulta <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-30/ulta.csv')
allCategories <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-30/allCategories.csv')
allShades <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-30/allShades.csv')
allNumbers <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-30/allNumbers.csv')
loadfonts()
font_add_google(name = "Amatic SC", family = "amatic-sc")
font_add_google("Cedarville Cursive", "cedarville")
showtext_auto(enable = TRUE)
palette <- c("#FF0000","#FF7070",
"#F09200","#FFBF1F","#00A08A",
"#2989A3","#5BBCD6","#A475D9")
sephora_sub<-sephora%>%
mutate(shop=rep("sephora",length(brand)),
brand=tolower(brand),
product=tolower(product),
name=tolower(name))%>%
select(brand,product,name)
ulta_sub<-ulta%>%
mutate(shop=rep("ulta",length(brand)),
brand=tolower(brand),
product=tolower(product),
name=tolower(name))%>%
select(brand,product,name)
shops<-rbind(sephora_sub,ulta_sub)
allCategories_sub<-allCategories%>%
mutate(brand=tolower(brand),
product=tolower(product),
name=tolower(name))%>%
separate_rows(categories, convert = TRUE) %>%
mutate(categories = fct_reorder(categories, lightness))  %>%
select(brand,product,name,hex,lightness,categories)
allShades_sub<-allShades%>%
mutate(brand=tolower(brand),
product=tolower(product),
name=tolower(name))%>%
select(brand,product,name,hex,hue,sat,lightness)
allNumbers_sub<-allNumbers%>%
mutate(brand=tolower(brand),
product=tolower(product),
name=tolower(name))%>%
select(brand,product,name,hex,lightness,lightToDark)
################### Full Join of the datasets ##############
make_up<-full_join(allCategories_sub,allShades_sub,by.x=hex,by.y=lightness)
allCategories_sub
make_up<-full_join(allCategories_sub,
allShades_sub)
make_up<-full_join(make_up,allNumbers_sub)
make_up_sub<-make_up%>%
select(brand,name,hex,hue,sat,lightness)%>%
filter(!is.na(hue))%>%
arrange(hex)
plyr::count(make_up$brand); #107
plyr::count(make_up$product);#328
plyr::count(make_up$name);#1,317
plyr::count(allCategories_sub$categories)#17
my_companies <- sort(c("shiseido","maybelline",
"mac","lancôme","l'oréal",
"guerlain","estée lauder",
"clinique","benefit cosmetics"),
decreasing = TRUE)
make_up_for_plot <- make_up_sub %>%
filter(brand %in% my_companies) %>%
select(brand, name,hex, hue,sat,lightness) %>%
mutate(brand=as.factor(brand)) %>%
group_by(brand) %>%
mutate(mean_lightness = mean(lightness)) %>%
ungroup() %>%
mutate(brand = fct_reorder(brand, mean_lightness))
library(ggfx)
library(gridExtra)
plot1<-make_up_for_plot%>%
ggplot(aes(brand,lightness,col=hex)) +
with_blur(
geom_boxplot(size=5,show.legend = FALSE)) +
geom_jitter(width = 0.15,height = 0.0,size = 1) +
scale_colour_identity() +
coord_polar() +
labs(title = "Shades of makeup from The Pudding",
subtitle = "All collected from the US versions of Sephora and Ulta’s websites",
caption = "107 brands, 328 products, 317 names and 17 categories",
tag = "The Pudding",
x = "Lightness",
y = "Brands)",
colour = "white")+
theme_void(base_family = "cedarville") +
theme(plot.background = element_rect(fill = "black",color="black"),
axis.text.x = element_text(size = 30, vjust = 2,color="white"),
plot.title = element_text(size = 56,hjust = 0.5,color="white"),
plot.subtitle = element_text(size = 46,hjust = 0.5,color="white"),
plot.caption = element_text(size = 36,hjust = 0.5,
margin = margin(t = 5, b = 10),color="white"),
plot.tag = element_text()
)
plot2<-make_up_for_plot%>%
ggplot(aes(brand,lightness,col=hex)) +
with_blur(
geom_point(show.legend = FALSE)) +
geom_jitter(width = 0.15,height = 0.0,size = 2) +
scale_colour_identity() +
coord_polar(direction=1) +
theme_void() +
theme(plot.background = element_rect(fill = "black")) +
facet_wrap(vars(brand))
library(ggimage)
require(magick)
main_plot <- plot1 + plot2
final <- main_plot +
labs(title = "Makeup - The naked truth",
subtitle = "combination for naming their shades",
caption = "TidyTuesday W14 - The Pudding - Viz - @fgazzelloni") +
scale_fill_manual(values = palette,
guide = guide_legend(title = NULL)) +
theme_void(base_family = "cedarville") +
theme(plot.background = element_rect(fill = "#FCEBDA",color = NA),
strip.text.x = element_text(color = NA),
axis.text.x = element_text(size = 20, vjust = 2),
panel.grid.major = element_line(size = 0.03, linetype = 'solid',colour = "black"),
plot.margin = margin(10, 10, 5, 10),
plot.title = element_text(size = 56,hjust = 0.5, margin = margin(t = 5, b = 10)),
plot.subtitle = element_text(size = 40,hjust = 0.5),
plot.caption = element_text(hjust = 0.5, size = 26))
ragg::agg_png("day1_part-to-whole.png",
res = 320, width = 14,
height = 8, units = "in")
final
dev.off()
tidy_logo <- image_read("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/static/plot_logo.png") %>%
image_resize("300x300")
The_Pudding_plot <- image_read(here::here("day1_part-to-whole.png"))
The_Pudding_plot <- image_read("day1_part-to-whole.png")
attached_logo <- image_composite(The_Pudding_plot, tidy_logo,
operator="atop",
gravity="southeast") # tell R where to put the logo
image_write(attached_logo,
path = "~/Documents/R/AAA_websites/UPDVwR/content/chartchallenge/cases2021/posts2021/day1_part-to-whole/day1_part-to-whole.png", format = "png") # save final plot
library(ggimage)
require(magick)
main_plot <- plot1 + plot2
final <- main_plot +
labs(title = "Makeup - The naked truth",
subtitle = "combination for naming their shades",
caption = "TidyTuesday W14 - The Pudding - Viz - @fgazzelloni") +
scale_fill_manual(values = palette,
guide = guide_legend(title = NULL)) +
theme_void(base_family = "cedarville") +
theme(plot.background = element_rect(fill = "#FCEBDA",color = NA),
strip.text.x = element_text(color = NA),
axis.text.x = element_text(size = 20, vjust = 2),
panel.grid.major = element_line(size = 0.03, linetype = 'solid',colour = "black"),
plot.margin = margin(10, 10, 5, 10),
plot.title = element_text(size = 56,hjust = 0.5, margin = margin(t = 5, b = 10)),
plot.subtitle = element_text(size = 40,hjust = 0.5),
plot.caption = element_text(hjust = 0.5, size = 26))
ragg::agg_png("day1_part-to-whole.png",
res = 320, width = 14,
height = 8, units = "in")
final
dev.off()
library(ggimage)
require(magick)
main_plot <- plot1 + plot2
final <- main_plot +
labs(title = "Makeup - The naked truth",
subtitle = "combination for naming their shades",
caption = "#30DayChartChallenge -Day1\nRemake of TidyTuesday W14 - The Pudding - Viz - @fgazzelloni") +
scale_fill_manual(values = palette,
guide = guide_legend(title = NULL)) +
theme_void(base_family = "cedarville") +
theme(plot.background = element_rect(fill = "#FCEBDA",color = NA),
strip.text.x = element_text(color = NA),
axis.text.x = element_text(size = 20, vjust = 2),
panel.grid.major = element_line(size = 0.03, linetype = 'solid',colour = "black"),
plot.margin = margin(10, 10, 5, 10),
plot.title = element_text(size = 56,hjust = 0.5, margin = margin(t = 5, b = 10)),
plot.subtitle = element_text(size = 40,hjust = 0.5),
plot.caption = element_text(hjust = 0.5, size = 26))
ragg::agg_png("day1_part-to-whole.png",
res = 320, width = 14,
height = 8, units = "in")
final
dev.off()
bookdown::publish_book()
---
title: 'Animation'
---
title: 'Animation'
bookdown::publish_book()
path <- "~/Documents/R/AAA_websites/UPDVwR/content/chartchallenge/cases2022/posts2022"
dirs <- list.dirs(path, recursive = FALSE)
dirs
image_files <- list.files(dirs, pattern = "\\.(jpg|png|jpeg|gif)$", ,
full.names = TRUE)
image_files
file.copy(image_files, "~/Documents/R/AAA_websites/UPDVwR/content/chartchallenge/cases2022/posts2022/images_folder")
dirs
files
dirs <- list.dirs("~/Documents/R/AAA_websites/UPDVwR/content/chartchallenge/cases2022/posts2022/")
dirs
dirs <- list.dirs("~/Documents/R/AAA_websites/UPDVwR/content/chartchallenge/cases2022/posts2022/")
dirs
dirs <- list.dirs("~/Documents/R/AAA_websites/UPDVwR/content/chartchallenge/cases2022/posts2022")
dirs
files <- list.files(dirs,pattern = ".qmd$",
full.names = TRUE)
files
name_files <- list.files(dirs,pattern = ".qmd$",
full.names = FALSE)
name_files
name_files <- list.files(dirs,pattern = ".qmd$",
full.names = FALSE)%>%
str_remove(".qmd")
name_files <- list.files(dirs,pattern = ".qmd$",
full.names = FALSE) |>
str_remove(".qmd")
name_files <- list.files(dirs,pattern = ".qmd$",
full.names = FALSE) |>
stringr::str_remove(".qmd")
name_files
# Extract the image URL
url <- paste0("https://raw.githubusercontent.com/Fgazzelloni/30DayChartChallenge/refs/heads/main/data/Edition_2022/images/", name_files,".png")
url
# write lines to add the image to each post's to page
library(stringr)
library(purrr)
library(readr)
# Extract the image URL
image_url <- paste0("https://raw.githubusercontent.com/Fgazzelloni/30DayChartChallenge/refs/heads/main/data/Edition_2022/images/", name_files,".png")
name_files <- list.files(dirs,pattern = ".qmd$",
full.names = FALSE)
name_files
# Extract the image URL
image_url <- paste0("https://raw.githubusercontent.com/Fgazzelloni/30DayChartChallenge/refs/heads/main/data/Edition_2022/images/", name_files)
image_url
# build the url
for (f in files) {
# Read file
x <- readLines(f)
# Identify YAML boundaries (---)
yaml_start <- which(x == "---")[1]
yaml_end   <- which(x == "---")[2]
# Extract YAML section
yaml <- x[yaml_start:yaml_end]
image_line <- yaml[str_detect(yaml, "^image:")]
# Extract the image URL
image_url <- paste0("https://raw.githubusercontent.com/Fgazzelloni/30DayChartChallenge/refs/heads/main/data/Edition_2022/images/", name_files)
x <- readLines(f)
# Identify YAML boundaries (---)
yaml_start <- which(x == "---")[1]
yaml_end   <- which(x == "---")[2]
yaml <- x[yaml_start:yaml_end]
# Replace image line in YAML
# ----------------------------------
yaml_new <- yaml
yaml_new[str_detect(yaml_new, "^image:")] <- paste0("image: '", image_url, "'")
# Create markdown section to append
md_block <- c(
"",
paste0("<center>![](", image_url, ")</center>"),
"")
# Reassemble file: YAML + appended block + original body
new_content <- c(yaml_new,
x[(yaml_end + 1):length(x)],
md_block)
# Write back
writeLines(new_content, f)
message("Updated: ", f)
}
warnings()
